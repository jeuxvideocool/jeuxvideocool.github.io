import{d as G,c as F,w as H,r as n,e as T,f as O}from"./loaders-CNHm-dlv.js";import{c as B,a as _}from"./input-CrBvr0XE.js";import{c as N}from"./loop-24SuRqx9.js";import{a as U,c as f,d as j}from"./index-niTdxgfr.js";const h="dodge",a=G(h),D=F(),y=D.find(t=>t.id===(a==null?void 0:a.themeId))||D[0];U();if(y){const t=document.documentElement.style;t.setProperty("--color-primary",y.colors.primary),t.setProperty("--color-secondary",y.colors.secondary),t.setProperty("--color-accent",y.colors.accent),t.setProperty("--color-text",y.colors.text),t.setProperty("--color-muted",y.colors.muted),document.body.style.background=y.gradient||document.body.style.background}const m=document.getElementById("game-canvas"),v=document.getElementById("ui"),s=m.getContext("2d"),u=B(),c=document.createElement("div");c.className="overlay";c.style.display="none";v.appendChild(c);const d={up:(a==null?void 0:a.input.keys.up)||"ArrowUp",down:(a==null?void 0:a.input.keys.down)||"ArrowDown",left:(a==null?void 0:a.input.keys.left)||"ArrowLeft",right:(a==null?void 0:a.input.keys.right)||"ArrowRight",dash:(a==null?void 0:a.input.keys.dash)||"Space"},I=_({container:document.body,input:u,mapping:{up:d.up,down:d.down,left:d.left,right:d.right,actionA:d.dash,actionALabel:"Dash"},autoShow:!1,showPad:!1}),P=new Image;P.src=new URL("data:image/svg+xml,%3csvg%20width='96'%20height='72'%20viewBox='0%200%2096%2072'%20xmlns='http://www.w3.org/2000/svg'%3e%3cdefs%3e%3clinearGradient%20id='ship'%20x1='0%25'%20y1='0%25'%20x2='100%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%23ff7b5f'/%3e%3cstop%20offset='100%25'%20stop-color='%23ffd166'/%3e%3c/linearGradient%3e%3c/defs%3e%3cpath%20d='M10%2036%20L36%2012%20L80%2036%20L36%2060%20Z'%20fill='url(%23ship)'%20stroke='%230b1020'%20stroke-width='4'%20stroke-linejoin='round'/%3e%3crect%20x='32'%20y='24'%20width='12'%20height='24'%20rx='6'%20fill='%230bd0ff'%20opacity='0.9'/%3e%3crect%20x='48'%20y='28'%20width='10'%20height='16'%20rx='5'%20fill='%230b1020'%20opacity='0.5'/%3e%3cpath%20d='M10%2036%20L0%2030%20L0%2042%20Z'%20fill='%23ff7b5f'%20opacity='0.7'/%3e%3c/svg%3e",import.meta.url).href;const k=new Image;k.src=new URL("data:image/svg+xml,%3csvg%20width='72'%20height='72'%20viewBox='0%200%2072%2072'%20xmlns='http://www.w3.org/2000/svg'%3e%3cdefs%3e%3clinearGradient%20id='rock'%20x1='0%25'%20y1='0%25'%20x2='100%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%231c2a4d'/%3e%3cstop%20offset='100%25'%20stop-color='%230b1020'/%3e%3c/linearGradient%3e%3c/defs%3e%3cpath%20d='M14%2018%20L36%206%20L58%2018%20L64%2036%20L52%2062%20L28%2066%20L10%2046%20Z'%20fill='url(%23rock)'%20stroke='%237af0ff'%20stroke-width='3'%20stroke-linejoin='round'/%3e%3ccircle%20cx='28'%20cy='30'%20r='4'%20fill='%237af0ff'%20opacity='0.6'/%3e%3ccircle%20cx='46'%20cy='44'%20r='5'%20fill='%23ff7b5f'%20opacity='0.7'/%3e%3c/svg%3e",import.meta.url).href;const C=new Image;C.src=new URL("data:image/svg+xml,%3csvg%20width='60'%20height='60'%20viewBox='0%200%2060%2060'%20xmlns='http://www.w3.org/2000/svg'%3e%3cdefs%3e%3clinearGradient%20id='core'%20x1='0%25'%20y1='0%25'%20x2='100%25'%20y2='100%25'%3e%3cstop%20offset='0%25'%20stop-color='%237af0ff'/%3e%3cstop%20offset='100%25'%20stop-color='%2364f4ac'/%3e%3c/linearGradient%3e%3c/defs%3e%3ccircle%20cx='30'%20cy='30'%20r='24'%20fill='url(%23core)'%20opacity='0.9'/%3e%3ccircle%20cx='30'%20cy='30'%20r='14'%20fill='%230b1020'%20opacity='0.4'/%3e%3cpath%20d='M30%2010%20L34%2026%20H46%20L36%2034%20L40%2050%20L30%2040%20L20%2050%20L24%2034%20L14%2026%20H26%20Z'%20fill='%23ffd166'%20opacity='0.9'/%3e%3c/svg%3e",import.meta.url).href;const e={running:!1,width:0,height:0,player:{x:0,y:0,r:14,dash:0,dashCooldown:0},invulnerable:0,dashIFrames:0,time:0,mode:"timed",runDuration:(a==null?void 0:a.difficultyParams.winTimeSeconds)??60,spawnTimer:0,powerupTimer:0,obstacles:[],powerups:[],stars:[]};function R(){m.width=window.innerWidth*devicePixelRatio,m.height=window.innerHeight*devicePixelRatio,m.style.width="100%",m.style.height="100%",e.width=m.width/devicePixelRatio,e.height=m.height/devicePixelRatio,z()}R();window.addEventListener("resize",R);const A=N({update:t=>q(t),render:Z,fps:60});function W(){if(!a){L("Config introuvable","Ajoute configs/games/dodge.config.json",!1);return}I.show();const t=document.getElementById("run-duration");if(t&&e.mode==="timed"){const i=Math.max(10,Math.min(999,Number(t.value)||e.runDuration));e.runDuration=i}e.running=!0,e.player.x=e.width*.15,e.player.y=e.height/2,e.player.dash=0,e.player.dashCooldown=0,e.time=0,e.invulnerable=0,e.spawnTimer=0,e.powerupTimer=0,e.obstacles=[],e.powerups=[],z(),c.style.display="none",f({type:"SESSION_START",gameId:h}),A.start()}function E(t){e.running=!1,A.stop(),I.hide();const i=Math.floor(e.time);f({type:t?"SESSION_WIN":"SESSION_FAIL",gameId:h,payload:{score:i}}),j(h,(a==null?void 0:a.saveSchemaVersion)??1,p=>{const g=p.state.bestTime||0;i>g&&(p.state.bestTime=i,p.bestScore=i)}),L(`${t?"Victoire !":"Touché !"} (${i}s)`,(a==null?void 0:a.uiText.help)||"Rejoue pour pousser ton record.")}function L(t,i,r=!0){I.hide(),c.style.display="grid",c.innerHTML=`
    <div class="panel">
      <p class="pill">Dodge Rush</p>
      <h2>${t}</h2>
      <p>${i}</p>
      <div class="mode-picker">
        <label><input type="radio" name="mode" value="timed" ${e.mode==="timed"?"checked":""}/> Mode chrono</label>
        <label><input type="radio" name="mode" value="endless" ${e.mode==="endless"?"checked":""}/> Mode infini</label>
        <div class="timed-only" style="display:${e.mode==="timed"?"block":"none"}; margin-top:8px;">
          <label>Durée (sec)
            <input id="run-duration" type="number" min="10" max="999" value="${e.runDuration}" />
          </label>
        </div>
      </div>
      <div style="display:flex; gap:10px; justify-content:center; margin-top:12px;">
        ${r?'<button class="btn" id="play-btn">Lancer</button>':""}
        <a class="btn secondary" href="${H("/apps/hub/")}">Hub</a>
      </div>
    </div>
  `;const o=document.getElementById("play-btn");o==null||o.addEventListener("click",W),K()}L((a==null?void 0:a.uiText.title)||"Dodge Rush",(a==null?void 0:a.uiText.help)||"");function q(t){if(!e.running||!a)return;e.time+=t,e.spawnTimer+=t*1e3,e.powerupTimer+=t*1e3;const i=a.difficultyParams.obstacleSpeed,r=(u.isDown(d.right)?1:0)+(u.isDown(d.left)?-1:0),o=(u.isDown(d.down)?1:0)+(u.isDown(d.up)?-1:0),p=d.dash,g=e.player.dashCooldown<=0;u.isDown(p)&&g&&(e.player.dash=.45,e.player.dashCooldown=2.5,e.dashIFrames=.35,f({type:"DASH_USED",gameId:h}));const M=e.player.dash>0?2.4:1;e.player.x+=r*a.difficultyParams.playerSpeed*M*(t*60),e.player.y+=o*a.difficultyParams.playerSpeed*M*(t*60),e.player.x=T(e.player.x,e.player.r,e.width-e.player.r),e.player.y=T(e.player.y,e.player.r,e.height-e.player.r),e.player.dash=Math.max(0,e.player.dash-t),e.player.dashCooldown=Math.max(0,e.player.dashCooldown-t),e.invulnerable=Math.max(0,e.invulnerable-t),e.dashIFrames=Math.max(0,e.dashIFrames-t),e.spawnTimer>=a.difficultyParams.spawnIntervalMs&&(e.spawnTimer=0,e.obstacles.push({x:e.width+n(10,60),y:n(40,e.height-40),size:n(12,22),speed:i*n(.9,1.2)})),e.powerupTimer>=1600&&(e.powerupTimer=0,O(a.difficultyParams.powerupChance)&&e.powerups.push({x:n(e.width*.4,e.width*.95),y:n(50,e.height-50),size:10,duration:2.5})),e.obstacles=e.obstacles.filter(l=>{if(l.x-=(l.speed+e.time*.02)*(t*60),l.x+l.size<0)return f({type:"OBSTACLE_DODGED",gameId:h}),!1;const w=l.x-e.player.x,x=l.y-e.player.y,S=Math.sqrt(w*w+x*x),$=e.invulnerable>0||e.player.dash>0||e.dashIFrames>0;return S<l.size+e.player.r?$?(f({type:"OBSTACLE_DODGED",gameId:h}),!1):(E(!1),!1):!0}),e.powerups=e.powerups.filter(l=>{l.x-=i*.5*(t*60);const w=l.x-e.player.x,x=l.y-e.player.y;return Math.sqrt(w*w+x*x)<l.size+e.player.r?(f({type:"POWERUP_COLLECTED",gameId:h}),e.invulnerable=Math.max(e.invulnerable,l.duration),e.dashIFrames=Math.max(e.dashIFrames,.35),e.player.dashCooldown=Math.max(0,e.player.dashCooldown-1),!1):l.x+l.size>0}),e.mode==="timed"&&e.time>=e.runDuration&&E(!0)}function Z(){s.save(),s.scale(devicePixelRatio,devicePixelRatio),s.clearRect(0,0,e.width,e.height),s.fillStyle="rgba(255,255,255,0.08)",e.stars.forEach(r=>{s.globalAlpha=r.alpha,s.fillRect(r.x,r.y,r.size,r.size),s.globalAlpha=1,r.x-=r.speed,r.x<-r.size&&(r.x=e.width+n(0,40),r.y=n(0,e.height))});const t=e.player.r*3,i=e.player.r*2.4;if(b(P,e.player.x-t/2,e.player.y-i/2,t,i),e.invulnerable>0||e.dashIFrames>0){const r=e.invulnerable>0?"rgba(122, 240, 255, 0.7)":"rgba(255, 255, 255, 0.5)";s.strokeStyle=r,s.lineWidth=3,s.beginPath(),s.arc(e.player.x,e.player.y,e.player.r*1.4,0,Math.PI*2),s.stroke()}e.obstacles.forEach(r=>{const o=r.size*2.2;b(k,r.x-o/2,r.y-o/2,o,o)}),e.powerups.forEach(r=>{const o=r.size*2.2;b(C,r.x-o/2,r.y-o/2,o,o)}),s.restore(),V()}function V(){v.innerHTML="",v.appendChild(c);const t=document.createElement("div");t.className="hud",t.innerHTML=`
    <div class="pill">Temps ${e.time.toFixed(1)}s</div>
    <div class="pill">Dash ${Math.max(0,e.player.dashCooldown).toFixed(1)}s</div>
    <div class="pill">Invuln ${e.invulnerable.toFixed(1)}s</div>
    <div class="pill">${e.mode==="endless"?"Mode infini":`Run ${e.runDuration}s`}</div>
  `,v.appendChild(t)}function b(t,i,r,o,p){t.complete?s.drawImage(t,i,r,o,p):(s.fillStyle="#fff",s.fillRect(i,r,o,p))}function z(){const t=Math.floor(e.width*e.height/12e3);e.stars=Array.from({length:t},()=>({x:n(0,e.width),y:n(0,e.height),size:n(1,3),speed:n(.6,1.6),alpha:n(.3,.8)}))}function K(){c.querySelectorAll('input[name="mode"]').forEach(i=>i.addEventListener("change",()=>{e.mode=i.value||"timed";const r=c.querySelector(".timed-only");r&&(r.style.display=e.mode==="timed"?"block":"none")}))}
