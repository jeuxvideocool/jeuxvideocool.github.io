import{m as _,e as q,f as j,l as X,p as E,w as Y,k as M,n as F,q as K,t as V}from"./index-D6AlT0_O.js";import{c as J,a as Q}from"./input-CrBvr0XE.js";import{c as Z}from"./loop-24SuRqx9.js";const u="snake",o=_(u),R=q(),d=R.find(t=>t.id===(o==null?void 0:o.themeId))||R[0];j();if(d){const t=document.documentElement.style;t.setProperty("--color-primary",d.colors.primary),t.setProperty("--color-secondary",d.colors.secondary),t.setProperty("--color-accent",d.colors.accent),t.setProperty("--color-text",d.colors.text),t.setProperty("--color-muted",d.colors.muted),document.body.style.background=d.gradient||d.colors.background}const f=document.getElementById("game-canvas"),m=document.getElementById("ui"),a=f.getContext("2d"),A=J(),y=document.createElement("div");y.className="overlay";y.style.display="none";m.appendChild(y);const G=new Image;G.src=new URL("data:image/svg+xml,%3csvg%20width='220'%20height='220'%20viewBox='0%200%20220%20220'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cdefs%3e%3cradialGradient%20id='core'%20cx='0'%20cy='0'%20r='1'%20gradientUnits='userSpaceOnUse'%20gradientTransform='translate(110%20110)%20rotate(90)%20scale(110)'%3e%3cstop%20stop-color='%237CFFE1'%20/%3e%3cstop%20offset='1'%20stop-color='%230A1A2E'%20/%3e%3c/radialGradient%3e%3clinearGradient%20id='rim'%20x1='40'%20y1='50'%20x2='180'%20y2='170'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%237CFFE1'%20stop-opacity='0.9'%20/%3e%3cstop%20offset='1'%20stop-color='%237B8CFF'%20stop-opacity='0.85'%20/%3e%3c/linearGradient%3e%3c/defs%3e%3ccircle%20cx='110'%20cy='110'%20r='98'%20fill='url(%23core)'%20/%3e%3ccircle%20cx='110'%20cy='110'%20r='98'%20stroke='url(%23rim)'%20stroke-width='10'%20/%3e%3ccircle%20cx='110'%20cy='90'%20r='34'%20fill='%23E9FFFA'%20fill-opacity='0.85'%20/%3e%3ccircle%20cx='138'%20cy='80'%20r='18'%20fill='%23E9FFFA'%20fill-opacity='0.65'%20/%3e%3cpath%20d='M110%2022c20%203%2035%2012%2045%2026-18-8-35-10-53-6%204-7%205-14%208-20z'%20fill='%236DF6D4'%20fill-opacity='0.8'%20/%3e%3c/svg%3e",import.meta.url).href;const B=new Image;B.src=new URL("data:image/svg+xml,%3csvg%20width='220'%20height='220'%20viewBox='0%200%20220%20220'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cdefs%3e%3clinearGradient%20id='prism-core'%20x1='30'%20y1='40'%20x2='190'%20y2='180'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%23FF7EE2'%20/%3e%3cstop%20offset='0.45'%20stop-color='%237B8CFF'%20/%3e%3cstop%20offset='1'%20stop-color='%237CFFE1'%20/%3e%3c/linearGradient%3e%3cradialGradient%20id='prism-glow'%20cx='0'%20cy='0'%20r='1'%20gradientUnits='userSpaceOnUse'%20gradientTransform='translate(110%20110)%20rotate(90)%20scale(110)'%3e%3cstop%20stop-color='%23ffffff'%20stop-opacity='0.7'%20/%3e%3cstop%20offset='1'%20stop-color='%23050712'%20/%3e%3c/radialGradient%3e%3c/defs%3e%3ccircle%20cx='110'%20cy='110'%20r='100'%20fill='url(%23prism-glow)'%20/%3e%3cpath%20d='M110%2018%20190%20110%20110%20202%2030%20110%20110%2018z'%20fill='url(%23prism-core)'%20/%3e%3cpath%20d='M110%2018%20190%20110%20110%20202%2030%20110%20110%2018z'%20stroke='%23ffffff'%20stroke-opacity='0.4'%20stroke-width='6'%20/%3e%3ccircle%20cx='110'%20cy='110'%20r='46'%20fill='%230A0F24'%20fill-opacity='0.5'%20/%3e%3ccircle%20cx='110'%20cy='110'%20r='38'%20stroke='%23ffffff'%20stroke-opacity='0.4'%20stroke-width='4'%20/%3e%3ccircle%20cx='110'%20cy='84'%20r='14'%20fill='%23ffffff'%20fill-opacity='0.6'%20/%3e%3c/svg%3e",import.meta.url).href;const z=new Image;z.src=new URL("data:image/svg+xml,%3csvg%20width='340'%20height='340'%20viewBox='0%200%20340%20340'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cdefs%3e%3clinearGradient%20id='glow'%20x1='0'%20y1='0'%20x2='1'%20y2='1'%3e%3cstop%20stop-color='%237CFFE1'%20stop-opacity='0.18'%20/%3e%3cstop%20offset='0.5'%20stop-color='%237B8CFF'%20stop-opacity='0.12'%20/%3e%3cstop%20offset='1'%20stop-color='%23FF7EE2'%20stop-opacity='0.14'%20/%3e%3c/linearGradient%3e%3c/defs%3e%3crect%20width='340'%20height='340'%20fill='%23050712'%20/%3e%3crect%20width='340'%20height='340'%20fill='url(%23glow)'%20/%3e%3cg%20stroke='%23a3b3ff'%20stroke-opacity='0.16'%20stroke-width='1'%3e%3cpath%20d='M20%200v340M40%200v340M60%200v340M80%200v340M100%200v340M120%200v340M140%200v340M160%200v340M180%200v340M200%200v340M220%200v340M240%200v340M260%200v340M280%200v340M300%200v340M320%200v340'%20/%3e%3cpath%20d='M0%2020h340M0%2040h340M0%2060h340M0%2080h340M0%20100h340M0%20120h340M0%20140h340M0%20160h340M0%20180h340M0%20200h340M0%20220h340M0%20240h340M0%20260h340M0%20280h340M0%20300h340M0%20320h340'%20/%3e%3c/g%3e%3crect%20x='1'%20y='1'%20width='338'%20height='338'%20stroke='%237CFFE1'%20stroke-opacity='0.14'%20stroke-width='2'%20/%3e%3c/svg%3e",import.meta.url).href;const S={up:(o==null?void 0:o.input.keys.up)||"ArrowUp",down:(o==null?void 0:o.input.keys.down)||"ArrowDown",left:(o==null?void 0:o.input.keys.left)||"ArrowLeft",right:(o==null?void 0:o.input.keys.right)||"ArrowRight",dash:(o==null?void 0:o.input.keys.dash)||"Space"};var I,$;const ee=typeof window<"u"&&((($=(I=window.matchMedia)==null?void 0:I.call(window,"(pointer: coarse)"))==null?void 0:$.matches)||navigator.maxTouchPoints>0),C=ee?Q({container:document.body,input:A,mapping:{up:S.up,down:S.down,left:S.left,right:S.right,actionA:S.dash,actionALabel:"Boost"},autoShow:!1,showPad:!0,gestureEnabled:!1,showOnDesktop:!1}):{show:()=>{},hide:()=>{},dispose:()=>{}},b={easy:{label:"Facile",boardSize:20,tickMs:170,speedRamp:.992,prismChance:.22,lengthTarget:36,boostSeconds:3.4,wallSolid:!0},medium:{label:"Moyen",boardSize:(o==null?void 0:o.difficultyParams.boardSize)??21,tickMs:(o==null?void 0:o.difficultyParams.baseTickMs)??140,speedRamp:(o==null?void 0:o.difficultyParams.speedRamp)??.985,prismChance:(o==null?void 0:o.difficultyParams.prismChance)??.18,lengthTarget:(o==null?void 0:o.difficultyParams.targetLength)??46,boostSeconds:((o==null?void 0:o.difficultyParams.boostDurationMs)??3200)/1e3,wallSolid:!!((o==null?void 0:o.difficultyParams.wallIsSolid)??1)},hard:{label:"Difficile",boardSize:19,tickMs:120,speedRamp:.982,prismChance:.14,lengthTarget:52,boostSeconds:2.6,wallSolid:!0},extreme:{label:"Extrême",boardSize:18,tickMs:105,speedRamp:.978,prismChance:.1,lengthTarget:60,boostSeconds:2.4,wallSolid:!0}};let w="medium";var L;const e={running:!1,boardSize:E((o==null?void 0:o.difficultyParams.boardSize)??20,12,32),cellSize:24,viewWidth:window.innerWidth,viewHeight:window.innerHeight,offsetX:0,offsetY:0,snake:[],dir:{x:1,y:0},pendingDir:{x:1,y:0},inputReady:!0,food:null,tickMs:(o==null?void 0:o.difficultyParams.baseTickMs)??140,timer:0,boost:0,score:0,best:((L=X().games[u])==null?void 0:L.bestScore)??0,streak:0,comboTimer:0,particles:[],flash:0,lengthTarget:(o==null?void 0:o.difficultyParams.targetLength)??42,wallSolid:!!((o==null?void 0:o.difficultyParams.wallIsSolid)??1),speedRamp:(o==null?void 0:o.difficultyParams.speedRamp)??.99,prismChance:(o==null?void 0:o.difficultyParams.prismChance)??.16,boostSeconds:((o==null?void 0:o.difficultyParams.boostDurationMs)??2600)/1e3,dpr:devicePixelRatio||1},D=Z({update:t=>ie(t),render:U,fps:60});function P(){e.dpr=devicePixelRatio||1,f.width=window.innerWidth*e.dpr,f.height=window.innerHeight*e.dpr,f.style.width="100%",f.style.height="100%",e.viewWidth=f.width/e.dpr,e.viewHeight=f.height/e.dpr;const t=Math.min(e.viewWidth,e.viewHeight)*.88;e.cellSize=E(Math.floor(t/e.boardSize),18,46);const s=e.cellSize*e.boardSize;e.offsetX=(e.viewWidth-s)/2,e.offsetY=(e.viewHeight-s)/2}P();window.addEventListener("resize",P);function te(){if(!o){x("Config manquante","Ajoute configs/games/snake.config.json",!1);return}C.show();const t=b[w]||b.medium;e.boardSize=E(t.boardSize,12,32),P(),e.running=!0,e.dir={x:1,y:0},e.pendingDir={x:1,y:0},e.inputReady=!0;const s=Math.floor(e.boardSize/2);e.snake=[{x:s-2,y:s},{x:s-1,y:s},{x:s,y:s}],e.score=e.snake.length,e.food=null,e.tickMs=t.tickMs,e.timer=0,e.boost=0,e.streak=0,e.comboTimer=0,e.particles=[],e.flash=.9,e.lengthTarget=t.lengthTarget,e.wallSolid=t.wallSolid,e.speedRamp=t.speedRamp,e.prismChance=t.prismChance,e.boostSeconds=t.boostSeconds,H(),y.style.display="none",f.style.pointerEvents="auto",m.style.pointerEvents="none",M({type:"SESSION_START",gameId:u}),D.start()}function T(t){e.running=!1,D.stop(),C.hide();const s=e.score;M({type:t?"SESSION_WIN":"SESSION_FAIL",gameId:u,payload:{score:s}}),V(u,(o==null?void 0:o.saveSchemaVersion)??1,c=>{const h=c.state.bestLength||0;c.state.bestLength=Math.max(h,e.snake.length);const l=c.bestScore||0;s>l&&(c.bestScore=s)}),e.best=Math.max(e.best,s),x(t?"Flow parfait":"Collision détectée",(o==null?void 0:o.uiText.help)||"",!0,s)}function H(){const t=new Set(e.snake.map(c=>`${c.x},${c.y}`));let s={x:0,y:0},i=0;do s={x:Math.floor(F(0,e.boardSize)),y:Math.floor(F(0,e.boardSize))},i+=1;while(t.has(`${s.x},${s.y}`)&&i<400);const r=K(e.prismChance);e.food={...s,type:r?"prism":"core"}}function v(t){!e.inputReady||t.x===-e.dir.x&&t.y===-e.dir.y||(e.pendingDir=t,e.inputReady=!1)}function oe(){if(!o)return;const t=o.input.keys,s=r=>r?A.isDown(r):!1;(s(t.left)||s(t.altLeft))&&v({x:-1,y:0}),(s(t.right)||s(t.altRight))&&v({x:1,y:0}),(s(t.up)||s(t.altUp))&&v({x:0,y:-1}),(s(t.down)||s(t.altDown))&&v({x:0,y:1});const i=t.dash||"Space";s(i)&&e.boost<=.1&&(e.boost=e.boostSeconds,e.flash=1)}function se(){e.dir=e.pendingDir;const t=e.snake[e.snake.length-1];let s={x:t.x+e.dir.x,y:t.y+e.dir.y};if(!e.wallSolid)s.x=(s.x+e.boardSize)%e.boardSize,s.y=(s.y+e.boardSize)%e.boardSize;else if(s.x<0||s.y<0||s.x>=e.boardSize||s.y>=e.boardSize){T(!1);return}if(e.snake.some(r=>r.x===s.x&&r.y===s.y)){T(!1);return}e.snake.push(s);let i=!1;e.food&&s.x===e.food.x&&s.y===e.food.y&&(i=!0,ae(e.food)),i||e.snake.shift(),e.inputReady=!0}function ae(t){e.flash=1,e.comboTimer=2.8,e.streak+=1,e.score=e.snake.length,M({type:t.type==="prism"?"PRISM_FRUIT_EATEN":"FRUIT_EATEN",gameId:u,payload:{score:e.score}}),t.type==="prism"&&(e.boost=Math.max(e.boost,e.boostSeconds),M({type:"STREAK_BONUS",gameId:u})),e.tickMs=Math.max(75,e.tickMs*e.speedRamp),H(),e.particles.push({x:t.x,y:t.y,r:e.cellSize*1.2,alpha:.65,decay:.9,color:t.type==="prism"?d.colors.accent:d.colors.primary}),e.snake.length>=e.lengthTarget&&T(!0)}function ie(t){if(!e.running)return;const s=e.boost>0?1.25:1;for(e.timer+=t*1e3*s,e.boost=Math.max(0,e.boost-t),e.flash=Math.max(0,e.flash-t*.8),e.comboTimer=Math.max(0,e.comboTimer-t),e.comboTimer===0&&(e.streak=0),oe();e.timer>=e.tickMs;)e.timer-=e.tickMs,se();e.particles=e.particles.map(i=>({...i,alpha:i.alpha-t*i.decay})).filter(i=>i.alpha>.02)}function k(t,s,i,r,c){a.beginPath(),a.moveTo(t+c,s),a.lineTo(t+i-c,s),a.quadraticCurveTo(t+i,s,t+i,s+c),a.lineTo(t+i,s+r-c),a.quadraticCurveTo(t+i,s+r,t+i-c,s+r),a.lineTo(t+c,s+r),a.quadraticCurveTo(t,s+r,t,s+r-c),a.lineTo(t,s+c),a.quadraticCurveTo(t,s,t+c,s),a.closePath()}function U(){a.save(),a.scale(e.dpr,e.dpr),a.clearRect(0,0,e.viewWidth,e.viewHeight);const t=a.createLinearGradient(0,0,e.viewWidth,e.viewHeight);t.addColorStop(0,"rgba(124,255,225,0.08)"),t.addColorStop(.5,"rgba(123,140,255,0.08)"),t.addColorStop(1,"rgba(255,126,226,0.08)"),a.fillStyle=t,a.fillRect(0,0,e.viewWidth,e.viewHeight),z.complete&&(a.globalAlpha=.16,a.drawImage(z,0,0,e.viewWidth,e.viewHeight),a.globalAlpha=1);const s=e.cellSize*e.boardSize,i=e.offsetX,r=e.offsetY,c=a.createLinearGradient(i,r,i,r+s);c.addColorStop(0,"rgba(255,255,255,0.04)"),c.addColorStop(1,"rgba(255,255,255,0.02)"),a.fillStyle=c,k(i,r,s,s,14),a.fill(),a.strokeStyle="rgba(255,255,255,0.08)",a.lineWidth=1.2,a.stroke(),a.strokeStyle="rgba(255,255,255,0.05)",a.lineWidth=.8;for(let l=1;l<e.boardSize;l++){const n=i+l*e.cellSize,p=r+l*e.cellSize;a.beginPath(),a.moveTo(n,r),a.lineTo(n,r+s),a.stroke(),a.beginPath(),a.moveTo(i,p),a.lineTo(i+s,p),a.stroke()}if(e.particles.forEach(l=>{const n=i+l.x*e.cellSize+e.cellSize/2,p=r+l.y*e.cellSize+e.cellSize/2,g=a.createRadialGradient(n,p,2,n,p,l.r);g.addColorStop(0,`${l.color}bf`),g.addColorStop(1,"transparent"),a.globalAlpha=l.alpha,a.fillStyle=g,a.beginPath(),a.arc(n,p,l.r,0,Math.PI*2),a.fill(),a.globalAlpha=1}),e.food){const l=i+e.food.x*e.cellSize,n=r+e.food.y*e.cellSize,p=e.food.type==="prism"?B:G;p.complete?a.drawImage(p,l,n,e.cellSize,e.cellSize):(a.fillStyle=e.food.type==="prism"?d.colors.accent:d.colors.primary,k(l+3,n+3,e.cellSize-6,e.cellSize-6,10),a.fill())}const h=e.snake.length;e.snake.forEach((l,n)=>{const p=i+l.x*e.cellSize+2,g=r+l.y*e.cellSize+2,O=n/Math.max(1,h-1),W=n===h-1?d.colors.primary:d.colors.secondary,N=n===h-1?.95:.55+O*.35;a.fillStyle=`${W}${Math.floor(N*255).toString(16).padStart(2,"0")}`,k(p,g,e.cellSize-4,e.cellSize-4,9),a.fill(),n===h-1&&(a.strokeStyle=d.colors.accent,a.lineWidth=2,a.beginPath(),a.arc(i+l.x*e.cellSize+e.cellSize/2,r+l.y*e.cellSize+e.cellSize/2,e.cellSize*.18+e.flash*4,0,Math.PI*2),a.stroke())}),a.restore(),re()}function re(){m.innerHTML="",m.appendChild(y);const t=document.createElement("div");t.className="hud",t.innerHTML=`
    <div class="chip">Score <strong>${e.score}/${e.lengthTarget}</strong></div>
    <div class="chip ghost">Vitesse <span>${(1e3/e.tickMs).toFixed(1)} t/s</span></div>
    <div class="chip ghost">Record <span>${e.best}</span></div>
  `,m.appendChild(t);const s=document.createElement("div");s.className="hud bottom",s.innerHTML=`
    <div class="pill ${e.boost>0?"glow":""}">Boost ${e.boost>0?"actif":"off"}</div>
    <div class="pill">Flow ${Math.max(1,e.streak)}x</div>
  `,m.appendChild(s)}function x(t,s,i=!0,r){var h;C.hide();const c=b[w]||b.medium;y.style.display="grid",m.style.pointerEvents="auto",f.style.pointerEvents="none",y.innerHTML=`
    <div class="panel">
      <p class="pill">Prism Snake · ${c.label}</p>
      <h2>${t}</h2>
      ${r!==void 0?`<p class="muted">Score ${r}/${e.lengthTarget}</p>`:""}
      <p class="muted">${s}</p>
      <div class="panel-actions panel-actions-scroll" style="justify-content:flex-start;">
        ${Object.entries(b).map(([l,n])=>`
              <button class="btn ghost diff-btn ${l===w?"active":""}" data-diff="${l}">
                ${n.label} · ${n.lengthTarget} segments
              </button>
            `).join("")}
      </div>
      <div class="panel-actions">
        ${i?'<button class="btn" id="start-btn">Lancer</button>':""}
        <a class="btn ghost" href="${Y("/")}">Hub</a>
      </div>
      <div class="inline-metrics">
        <div><span>Record</span><strong>${e.best}</strong></div>
        <div><span>Objectif</span><strong>${c.lengthTarget}</strong></div>
        <div><span>Cadence</span><strong>${(1e3/c.tickMs).toFixed(1)} t/s</strong></div>
      </div>
    </div>
  `,(h=document.getElementById("start-btn"))==null||h.addEventListener("click",te),document.querySelectorAll(".diff-btn").forEach(l=>{l.addEventListener("click",()=>{const n=l.dataset.diff;n&&b[n]&&(w=n,x(t,s,i,r))})})}x((o==null?void 0:o.uiText.title)||"Prism Snake",(o==null?void 0:o.uiText.help)||"Serpent néon premium.");U();
