import{d as D,c as M,w as L,e as b,r as c,f as R}from"./loaders-C6hX0A3C.js";import{c as z,a as A}from"./loop-H9o27inI.js";import{b as O,e as y,d as k}from"./index-DEUwev7d.js";const n="dodge",a=D(n),P=M(),o=P.find(t=>t.id===(a==null?void 0:a.themeId))||P[0];O();if(o){const t=document.documentElement.style;t.setProperty("--color-primary",o.colors.primary),t.setProperty("--color-secondary",o.colors.secondary),t.setProperty("--color-accent",o.colors.accent),t.setProperty("--color-text",o.colors.text),t.setProperty("--color-muted",o.colors.muted),document.body.style.background=o.gradient||document.body.style.background}const l=document.getElementById("game-canvas"),x=document.getElementById("ui"),r=l.getContext("2d"),f=z(),d=document.createElement("div");d.className="overlay";d.style.display="none";x.appendChild(d);const e={running:!1,width:0,height:0,player:{x:0,y:0,r:14,dash:0,dashCooldown:0},invulnerable:0,time:0,spawnTimer:0,powerupTimer:0,obstacles:[],powerups:[]};function E(){l.width=window.innerWidth*devicePixelRatio,l.height=window.innerHeight*devicePixelRatio,l.style.width="100%",l.style.height="100%",e.width=l.width/devicePixelRatio,e.height=l.height/devicePixelRatio}E();window.addEventListener("resize",E);const I=A({update:t=>G(t),render:_,fps:60});function $(){if(!a){g("Config introuvable","Ajoute configs/games/dodge.config.json",!1);return}e.running=!0,e.player.x=e.width*.15,e.player.y=e.height/2,e.player.dash=0,e.player.dashCooldown=0,e.time=0,e.invulnerable=0,e.spawnTimer=0,e.powerupTimer=0,e.obstacles=[],e.powerups=[],d.style.display="none",y({type:"SESSION_START",gameId:n}),I.start()}function S(t){e.running=!1,I.stop();const i=Math.floor(e.time);y({type:t?"SESSION_WIN":"SESSION_FAIL",gameId:n,payload:{score:i}}),k(n,(a==null?void 0:a.saveSchemaVersion)??1,u=>{const v=u.state.bestTime||0;i>v&&(u.state.bestTime=i,u.bestScore=i)}),g(`${t?"Victoire !":"Touch√© !"} (${i}s)`,(a==null?void 0:a.uiText.help)||"Rejoue pour pousser ton record.")}function g(t,i,w=!0){d.style.display="grid",d.innerHTML=`
    <div class="panel">
      <p class="pill">Dodge Rush</p>
      <h2>${t}</h2>
      <p>${i}</p>
      <div style="display:flex; gap:10px; justify-content:center; margin-top:12px;">
        ${w?'<button class="btn" id="play-btn">Lancer</button>':""}
        <a class="btn secondary" href="${L("/apps/hub/")}">Hub</a>
      </div>
    </div>
  `;const p=document.getElementById("play-btn");p==null||p.addEventListener("click",$)}g((a==null?void 0:a.uiText.title)||"Dodge Rush",(a==null?void 0:a.uiText.help)||"");function G(t){if(!e.running||!a)return;e.time+=t,e.spawnTimer+=t*1e3,e.powerupTimer+=t*1e3;const i=a.difficultyParams.obstacleSpeed,w=(f.isDown(a.input.keys.right||"ArrowRight")?1:0)+(f.isDown(a.input.keys.left||"ArrowLeft")?-1:0),p=(f.isDown(a.input.keys.down||"ArrowDown")?1:0)+(f.isDown(a.input.keys.up||"ArrowUp")?-1:0),u=a.input.keys.dash||"Space",v=e.player.dashCooldown<=0;f.isDown(u)&&v&&(e.player.dash=.45,e.player.dashCooldown=2.5,y({type:"DASH_USED",gameId:n}));const T=e.player.dash>0?2.4:1;e.player.x+=w*a.difficultyParams.playerSpeed*T*(t*60),e.player.y+=p*a.difficultyParams.playerSpeed*T*(t*60),e.player.x=b(e.player.x,e.player.r,e.width-e.player.r),e.player.y=b(e.player.y,e.player.r,e.height-e.player.r),e.player.dash=Math.max(0,e.player.dash-t),e.player.dashCooldown=Math.max(0,e.player.dashCooldown-t),e.invulnerable=Math.max(0,e.invulnerable-t),e.spawnTimer>=a.difficultyParams.spawnIntervalMs&&(e.spawnTimer=0,e.obstacles.push({x:e.width+c(10,60),y:c(40,e.height-40),size:c(12,22),speed:i*c(.9,1.2)})),e.powerupTimer>=1600&&(e.powerupTimer=0,R(a.difficultyParams.powerupChance)&&e.powerups.push({x:c(e.width*.4,e.width*.95),y:c(50,e.height-50),size:10,duration:2.5})),e.obstacles=e.obstacles.filter(s=>{if(s.x-=(s.speed+e.time*.02)*(t*60),s.x+s.size<0)return y({type:"OBSTACLE_DODGED",gameId:n}),!1;const h=s.x-e.player.x,m=s.y-e.player.y;return Math.sqrt(h*h+m*m)<s.size+e.player.r?e.invulnerable>0||e.player.dash>0?(y({type:"OBSTACLE_DODGED",gameId:n}),!1):(S(!1),!1):!0}),e.powerups=e.powerups.filter(s=>{s.x-=i*.5*(t*60);const h=s.x-e.player.x,m=s.y-e.player.y;return Math.sqrt(h*h+m*m)<s.size+e.player.r?(y({type:"POWERUP_COLLECTED",gameId:n}),e.invulnerable=s.duration,e.player.dashCooldown=Math.max(0,e.player.dashCooldown-1),!1):s.x+s.size>0}),e.time>=a.difficultyParams.winTimeSeconds&&S(!0)}function _(){r.save(),r.scale(devicePixelRatio,devicePixelRatio),r.clearRect(0,0,e.width,e.height),r.fillStyle=e.invulnerable>0?"#7cf5ff":"#ff5f6d",r.beginPath(),r.arc(e.player.x,e.player.y,e.player.r,0,Math.PI*2),r.fill(),r.fillStyle="rgba(255,255,255,0.8)",e.obstacles.forEach(t=>{r.beginPath(),r.rect(t.x-t.size,t.y-t.size,t.size*2,t.size*2),r.fill()}),r.fillStyle="#7cf5ff",e.powerups.forEach(t=>{r.beginPath(),r.arc(t.x,t.y,t.size,0,Math.PI*2),r.fill()}),r.restore(),H()}function H(){x.innerHTML="",x.appendChild(d);const t=document.createElement("div");t.className="hud",t.innerHTML=`
    <div class="pill">Temps ${e.time.toFixed(1)}s</div>
    <div class="pill">Dash ${Math.max(0,e.player.dashCooldown).toFixed(1)}s</div>
    <div class="pill">Invuln ${e.invulnerable.toFixed(1)}s</div>
  `,x.appendChild(t)}
