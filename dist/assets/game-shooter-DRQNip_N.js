import{d as G,c as M,w as C,e as x,r as I}from"./loaders-CNHm-dlv.js";import{c as B,a as D}from"./input-xiSeUQqn.js";import{c as H}from"./loop-24SuRqx9.js";import{a as U,c as m,d as $}from"./index-niTdxgfr.js";const c="shooter",t=G(c),L=M(),l=L.find(o=>o.id===(t==null?void 0:t.themeId))||L[0];U();const v=new Image;v.src=new URL("data:image/svg+xml,%3csvg%20width='120'%20height='140'%20viewBox='0%200%20120%20140'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cdefs%3e%3clinearGradient%20id='shipBody'%20x1='0'%20y1='0'%20x2='1'%20y2='1'%3e%3cstop%20stop-color='%237CFFE1'%20/%3e%3cstop%20offset='1'%20stop-color='%237B8CFF'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='shipGlow'%20x1='0'%20y1='0'%20x2='1'%20y2='1'%3e%3cstop%20stop-color='%23ffffff'%20stop-opacity='0.8'%20/%3e%3cstop%20offset='1'%20stop-color='%23ffffff'%20stop-opacity='0.1'%20/%3e%3c/linearGradient%3e%3c/defs%3e%3cpath%20d='M60%208L92%20120H28L60%208Z'%20fill='url(%23shipBody)'%20stroke='%230AF0FF'%20stroke-width='4'%20/%3e%3cpath%20d='M60%2024L78%20118H42L60%2024Z'%20fill='url(%23shipGlow)'%20/%3e%3ccircle%20cx='60'%20cy='86'%20r='10'%20fill='%230A1224'%20/%3e%3cpath%20d='M44%20122h32l-16%2012-16-12Z'%20fill='%230A1224'%20opacity='0.8'%20/%3e%3c/svg%3e",import.meta.url).href;const g=new Image;g.src=new URL("data:image/svg+xml,%3csvg%20width='120'%20height='120'%20viewBox='0%200%20120%20120'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cdefs%3e%3cradialGradient%20id='eye'%20cx='0'%20cy='0'%20r='1'%20gradientUnits='userSpaceOnUse'%20gradientTransform='translate(60%2060)%20scale(52)'%3e%3cstop%20stop-color='%23FF7EE2'/%3e%3cstop%20offset='1'%20stop-color='%23320726'/%3e%3c/radialGradient%3e%3c/defs%3e%3ccircle%20cx='60'%20cy='60'%20r='54'%20fill='url(%23eye)'%20stroke='%23FF7EE2'%20stroke-width='6'%20/%3e%3crect%20x='40'%20y='32'%20width='40'%20height='56'%20rx='12'%20fill='%230A0F1F'%20stroke='%23FFB6F2'%20stroke-width='4'/%3e%3crect%20x='52'%20y='46'%20width='16'%20height='28'%20rx='8'%20fill='%2300F5A0'/%3e%3crect%20x='22'%20y='54'%20width='8'%20height='12'%20rx='4'%20fill='%23FF7EE2'/%3e%3crect%20x='90'%20y='54'%20width='8'%20height='12'%20rx='4'%20fill='%23FF7EE2'/%3e%3c/svg%3e",import.meta.url).href;const b=new Image;b.src=new URL("data:image/svg+xml,%3csvg%20width='24'%20height='38'%20viewBox='0%200%2024%2038'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cdefs%3e%3clinearGradient%20id='bolt'%20x1='0'%20y1='0'%20x2='0'%20y2='1'%3e%3cstop%20stop-color='%237CFFE1'/%3e%3cstop%20offset='1'%20stop-color='%237B8CFF'/%3e%3c/linearGradient%3e%3c/defs%3e%3crect%20x='6'%20y='2'%20width='12'%20height='30'%20rx='6'%20fill='url(%23bolt)'%20stroke='%230AF0FF'%20stroke-width='2'/%3e%3crect%20x='10'%20y='26'%20width='4'%20height='10'%20rx='2'%20fill='%23ffffff'%20fill-opacity='0.8'/%3e%3c/svg%3e",import.meta.url).href;if(l){const o=document.documentElement.style;o.setProperty("--color-primary",l.colors.primary),o.setProperty("--color-secondary",l.colors.secondary),o.setProperty("--color-accent",l.colors.accent),o.setProperty("--color-text",l.colors.text),o.setProperty("--color-muted",l.colors.muted),document.body.style.background=l.gradient||document.body.style.background}const w=document.getElementById("game-canvas"),u=document.getElementById("ui"),s=w.getContext("2d"),A=B(),y=document.createElement("div");y.className="overlay";y.style.display="none";u.appendChild(y);const a={up:(t==null?void 0:t.input.keys.up)||"ArrowUp",down:(t==null?void 0:t.input.keys.down)||"ArrowDown",left:(t==null?void 0:t.input.keys.left)||"ArrowLeft",right:(t==null?void 0:t.input.keys.right)||"ArrowRight",shoot:(t==null?void 0:t.input.keys.shoot)||"Space",altUp:"ArrowUp",altDown:"ArrowDown",altLeft:"ArrowLeft",altRight:"ArrowRight",altShoot:"Space"};D({container:document.body,input:A,mapping:{up:a.up,down:a.down,left:a.left,right:a.right,actionA:a.shoot,actionALabel:"Tir"}});const e={running:!1,width:0,height:0,player:{x:0,y:0,r:14},bullets:[],enemies:[],score:0,combo:0,comboTimer:0,lastShot:0,spawnTimer:0,wave:1,waveTimer:(t==null?void 0:t.difficultyParams.waveLength)??30,lives:3};function R(){w.width=window.innerWidth*devicePixelRatio,w.height=window.innerHeight*devicePixelRatio,e.width=w.width/devicePixelRatio,e.height=w.height/devicePixelRatio}R();window.addEventListener("resize",R);const k=H({update:o=>_(o),render:N,fps:60});function f(...o){return o.some(i=>i?A.isDown(i):!1)}function K(){if(!t){S("Config manquante","Ajoute configs/games/shooter.config.json",!1);return}e.running=!0,e.player.x=e.width/2,e.player.y=e.height*.75,e.bullets=[],e.enemies=[],e.score=0,e.combo=0,e.comboTimer=0,e.spawnTimer=0,e.wave=1,e.waveTimer=t.difficultyParams.waveLength,e.lives=3,y.style.display="none",m({type:"SESSION_START",gameId:c}),k.start()}function P(o){e.running=!1,k.stop(),m({type:o?"SESSION_WIN":"SESSION_FAIL",gameId:c,payload:{score:e.score}}),$(c,(t==null?void 0:t.saveSchemaVersion)??1,n=>{const d=n.state.bestScore||0;e.score>d&&(n.state.bestScore=e.score,n.bestScore=e.score)}),S(o?"Vagues nettoyées":"Drone détruit",(t==null?void 0:t.uiText.help)||"")}function S(o,i,n=!0){y.style.display="grid",y.innerHTML=`
    <div class="panel">
      <p class="pill">Pixel Shooter</p>
      <h2>${o}</h2>
      <p>${i}</p>
      <div style="display:flex; gap:10px; justify-content:center; margin-top:12px;">
        ${n?'<button class="btn" id="play-btn">Lancer</button>':""}
        <a class="btn secondary" href="${C("/apps/hub/")}">Hub</a>
      </div>
    </div>
  `;const d=document.getElementById("play-btn");d==null||d.addEventListener("click",K)}S((t==null?void 0:t.uiText.title)||"Pixel Shooter",(t==null?void 0:t.uiText.help)||"");function _(o){if(!e.running||!t)return;if(e.lastShot+=o,e.spawnTimer+=o*1e3,e.comboTimer=Math.max(0,e.comboTimer-o),e.comboTimer<=0&&(e.combo=0),e.waveTimer-=o,e.waveTimer<=0){if(m({type:"WAVE_CLEARED",gameId:c}),e.wave+=1,e.wave>t.difficultyParams.wavesToWin){P(!0);return}e.waveTimer=t.difficultyParams.waveLength,e.spawnTimer=0}const i=(f(a.right,a.altRight,"KeyD")?1:0)+(f(a.left,a.altLeft,"KeyQ","KeyA")?-1:0),n=(f(a.down,a.altDown,"KeyS")?1:0)+(f(a.up,a.altUp,"KeyZ","KeyW")?-1:0);e.player.x+=i*t.difficultyParams.playerSpeed*(o*60),e.player.y+=n*t.difficultyParams.playerSpeed*(o*60),e.player.x=x(e.player.x,e.player.r,e.width-e.player.r),e.player.y=x(e.player.y,e.height*.35,e.height-e.player.r);const d=a.shoot;if(f(d,a.altShoot)&&e.lastShot>.18&&(e.bullets.push({x:e.player.x,y:e.player.y-8,speed:t.difficultyParams.bulletSpeed}),e.lastShot=0),e.spawnTimer>=t.difficultyParams.enemySpawnIntervalMs){e.spawnTimer=0;const r=I(e.player.x-60,e.player.x+60);e.enemies.push({x:x(r,20,e.width-20),y:-20,speed:t.difficultyParams.enemySpeed+e.wave*.2,vx:I(-.4,.4)})}e.bullets=e.bullets.map(r=>({...r,y:r.y-r.speed})).filter(r=>r.y>-10),e.enemies=e.enemies.filter(r=>{r.y+=r.speed,r.x+=r.vx,(r.x<10||r.x>e.width-10)&&(r.vx*=-1);const h=r.x-e.player.x,p=r.y-e.player.y;return Math.sqrt(h*h+p*p)<e.player.r+14?(e.lives-=1,m({type:"PLAYER_HIT",gameId:c}),e.lives>0):r.y<e.height+20});for(let r=e.enemies.length-1;r>=0;r--){const h=e.enemies[r];for(let p=e.bullets.length-1;p>=0;p--){const E=e.bullets[p],T=h.x-E.x,F=h.y-E.y;if(Math.sqrt(T*T+F*F)<16){e.enemies.splice(r,1),e.bullets.splice(p,1),e.score+=5*(1+Math.floor(e.combo/3)),e.combo+=1,e.comboTimer=2,m({type:"ENEMY_KILLED",gameId:c}),e.combo>0&&e.combo%5===0&&m({type:"COMBO_REACHED",gameId:c,payload:{combo:e.combo}});break}}}e.lives<=0&&P(!1)}function N(){s.save(),s.scale(devicePixelRatio,devicePixelRatio),s.clearRect(0,0,e.width,e.height);const o=e.player.r*3;v.complete?s.drawImage(v,e.player.x-o/2,e.player.y-o/2,o,o):(s.fillStyle=l.colors.primary,s.beginPath(),s.arc(e.player.x,e.player.y,e.player.r,0,Math.PI*2),s.fill()),e.bullets.forEach(i=>{b.complete?s.drawImage(b,i.x-8,i.y-18,16,30):(s.fillStyle=l.colors.secondary,s.fillRect(i.x-3,i.y-10,6,12))}),e.enemies.forEach(i=>{g.complete?s.drawImage(g,i.x-16,i.y-16,32,32):(s.fillStyle="#ff5afc",s.fillRect(i.x-12,i.y-12,24,24))}),s.restore(),O()}function O(){u.innerHTML="",u.appendChild(y);const o=document.createElement("div");o.className="hud",o.innerHTML=`
    <div class="pill">Score ${e.score}</div>
    <div class="pill">Wave ${e.wave}/${(t==null?void 0:t.difficultyParams.wavesToWin)??0}</div>
    <div class="pill">Combo ${e.combo} (${e.comboTimer.toFixed(1)}s)</div>
    <div class="pill">Vies ${e.lives}</div>
  `,u.appendChild(o)}
