import{d as A,c as M,w as R,e as w,r as g}from"./loaders-CNHm-dlv.js";import{c as D,a as k}from"./input-BV31AzWF.js";import{c as C}from"./loop-24SuRqx9.js";import{a as $,c as m,d as H}from"./index-niTdxgfr.js";const l="shooter",t=A(l),P=M(),a=P.find(o=>o.id===(t==null?void 0:t.themeId))||P[0];$();if(a){const o=document.documentElement.style;o.setProperty("--color-primary",a.colors.primary),o.setProperty("--color-secondary",a.colors.secondary),o.setProperty("--color-accent",a.colors.accent),o.setProperty("--color-text",a.colors.text),o.setProperty("--color-muted",a.colors.muted),document.body.style.background=a.gradient||document.body.style.background}const h=document.getElementById("game-canvas"),f=document.getElementById("ui"),r=h.getContext("2d"),y=D(),p=document.createElement("div");p.className="overlay";p.style.display="none";f.appendChild(p);const i={up:(t==null?void 0:t.input.keys.up)||"ArrowUp",down:(t==null?void 0:t.input.keys.down)||"ArrowDown",left:(t==null?void 0:t.input.keys.left)||"ArrowLeft",right:(t==null?void 0:t.input.keys.right)||"ArrowRight",shoot:(t==null?void 0:t.input.keys.shoot)||"Space"};k({container:document.body,input:y,mapping:{up:i.up,down:i.down,left:i.left,right:i.right,actionA:i.shoot,actionALabel:"Tir"}});const e={running:!1,width:0,height:0,player:{x:0,y:0,r:14},bullets:[],enemies:[],score:0,combo:0,comboTimer:0,lastShot:0,spawnTimer:0,wave:1,waveTimer:(t==null?void 0:t.difficultyParams.waveLength)??30,lives:3};function I(){h.width=window.innerWidth*devicePixelRatio,h.height=window.innerHeight*devicePixelRatio,e.width=h.width/devicePixelRatio,e.height=h.height/devicePixelRatio}I();window.addEventListener("resize",I);const L=C({update:o=>N(o),render:W,fps:60});function _(){if(!t){b("Config manquante","Ajoute configs/games/shooter.config.json",!1);return}e.running=!0,e.player.x=e.width/2,e.player.y=e.height*.75,e.bullets=[],e.enemies=[],e.score=0,e.combo=0,e.comboTimer=0,e.spawnTimer=0,e.wave=1,e.waveTimer=t.difficultyParams.waveLength,e.lives=3,p.style.display="none",m({type:"SESSION_START",gameId:l}),L.start()}function E(o){e.running=!1,L.stop(),m({type:o?"SESSION_WIN":"SESSION_FAIL",gameId:l,payload:{score:e.score}}),H(l,(t==null?void 0:t.saveSchemaVersion)??1,n=>{const c=n.state.bestScore||0;e.score>c&&(n.state.bestScore=e.score,n.bestScore=e.score)}),b(o?"Vagues nettoyées":"Drone détruit",(t==null?void 0:t.uiText.help)||"")}function b(o,v,n=!0){p.style.display="grid",p.innerHTML=`
    <div class="panel">
      <p class="pill">Pixel Shooter</p>
      <h2>${o}</h2>
      <p>${v}</p>
      <div style="display:flex; gap:10px; justify-content:center; margin-top:12px;">
        ${n?'<button class="btn" id="play-btn">Lancer</button>':""}
        <a class="btn secondary" href="${R("/apps/hub/")}">Hub</a>
      </div>
    </div>
  `;const c=document.getElementById("play-btn");c==null||c.addEventListener("click",_)}b((t==null?void 0:t.uiText.title)||"Pixel Shooter",(t==null?void 0:t.uiText.help)||"");function N(o){if(!e.running||!t)return;if(e.lastShot+=o,e.spawnTimer+=o*1e3,e.comboTimer=Math.max(0,e.comboTimer-o),e.comboTimer<=0&&(e.combo=0),e.waveTimer-=o,e.waveTimer<=0){if(m({type:"WAVE_CLEARED",gameId:l}),e.wave+=1,e.wave>t.difficultyParams.wavesToWin){E(!0);return}e.waveTimer=t.difficultyParams.waveLength,e.spawnTimer=0}const v=(y.isDown(i.right)?1:0)+(y.isDown(i.left)?-1:0),n=(y.isDown(i.down)?1:0)+(y.isDown(i.up)?-1:0);e.player.x+=v*t.difficultyParams.playerSpeed*(o*60),e.player.y+=n*t.difficultyParams.playerSpeed*(o*60),e.player.x=w(e.player.x,e.player.r,e.width-e.player.r),e.player.y=w(e.player.y,e.height*.35,e.height-e.player.r);const c=i.shoot;if(y.isDown(c)&&e.lastShot>.18&&(e.bullets.push({x:e.player.x,y:e.player.y-8,speed:t.difficultyParams.bulletSpeed}),e.lastShot=0),e.spawnTimer>=t.difficultyParams.enemySpawnIntervalMs){e.spawnTimer=0;const s=g(e.player.x-60,e.player.x+60);e.enemies.push({x:w(s,20,e.width-20),y:-20,speed:t.difficultyParams.enemySpeed+e.wave*.2,vx:g(-.4,.4)})}e.bullets=e.bullets.map(s=>({...s,y:s.y-s.speed})).filter(s=>s.y>-10),e.enemies=e.enemies.filter(s=>{s.y+=s.speed,s.x+=s.vx,(s.x<10||s.x>e.width-10)&&(s.vx*=-1);const u=s.x-e.player.x,d=s.y-e.player.y;return Math.sqrt(u*u+d*d)<e.player.r+14?(e.lives-=1,m({type:"PLAYER_HIT",gameId:l}),e.lives>0):s.y<e.height+20});for(let s=e.enemies.length-1;s>=0;s--){const u=e.enemies[s];for(let d=e.bullets.length-1;d>=0;d--){const x=e.bullets[d],T=u.x-x.x,S=u.y-x.y;if(Math.sqrt(T*T+S*S)<16){e.enemies.splice(s,1),e.bullets.splice(d,1),e.score+=5*(1+Math.floor(e.combo/3)),e.combo+=1,e.comboTimer=2,m({type:"ENEMY_KILLED",gameId:l}),e.combo>0&&e.combo%5===0&&m({type:"COMBO_REACHED",gameId:l,payload:{combo:e.combo}});break}}}e.lives<=0&&E(!1)}function W(){r.save(),r.scale(devicePixelRatio,devicePixelRatio),r.clearRect(0,0,e.width,e.height),r.fillStyle=a.colors.primary,r.beginPath(),r.arc(e.player.x,e.player.y,e.player.r,0,Math.PI*2),r.fill(),r.strokeStyle=a.colors.accent,r.lineWidth=2,r.stroke(),r.fillStyle=a.colors.secondary,e.bullets.forEach(o=>{r.fillRect(o.x-3,o.y-10,6,12)}),r.fillStyle="#ff5afc",e.enemies.forEach(o=>{r.beginPath(),r.rect(o.x-12,o.y-12,24,24),r.fill()}),r.restore(),G()}function G(){f.innerHTML="",f.appendChild(p);const o=document.createElement("div");o.className="hud",o.innerHTML=`
    <div class="pill">Score ${e.score}</div>
    <div class="pill">Wave ${e.wave}/${(t==null?void 0:t.difficultyParams.wavesToWin)??0}</div>
    <div class="pill">Combo ${e.combo} (${e.comboTimer.toFixed(1)}s)</div>
    <div class="pill">Vies ${e.lives}</div>
  `,f.appendChild(o)}
