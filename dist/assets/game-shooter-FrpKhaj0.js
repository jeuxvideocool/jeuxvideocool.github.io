import{d as L,c as k,w as D,e as v,r as S}from"./loaders-C6hX0A3C.js";import{c as M,a as R}from"./loop-H9o27inI.js";import{b as C,e as p,d as $}from"./index-DEUwev7d.js";const r="shooter",t=L(r),T=k(),o=T.find(s=>s.id===(t==null?void 0:t.themeId))||T[0];C();if(o){const s=document.documentElement.style;s.setProperty("--color-primary",o.colors.primary),s.setProperty("--color-secondary",o.colors.secondary),s.setProperty("--color-accent",o.colors.accent),s.setProperty("--color-text",o.colors.text),s.setProperty("--color-muted",o.colors.muted),document.body.style.background=o.gradient||document.body.style.background}const u=document.getElementById("game-canvas"),f=document.getElementById("ui"),i=u.getContext("2d"),m=M(),d=document.createElement("div");d.className="overlay";d.style.display="none";f.appendChild(d);const e={running:!1,width:0,height:0,player:{x:0,y:0,r:14},bullets:[],enemies:[],score:0,combo:0,comboTimer:0,lastShot:0,spawnTimer:0,wave:1,waveTimer:(t==null?void 0:t.difficultyParams.waveLength)??30,lives:3};function E(){u.width=window.innerWidth*devicePixelRatio,u.height=window.innerHeight*devicePixelRatio,e.width=u.width/devicePixelRatio,e.height=u.height/devicePixelRatio}E();window.addEventListener("resize",E);const I=R({update:s=>H(s),render:_,fps:60});function A(){if(!t){b("Config manquante","Ajoute configs/games/shooter.config.json",!1);return}e.running=!0,e.player.x=e.width/2,e.player.y=e.height*.75,e.bullets=[],e.enemies=[],e.score=0,e.combo=0,e.comboTimer=0,e.spawnTimer=0,e.wave=1,e.waveTimer=t.difficultyParams.waveLength,e.lives=3,d.style.display="none",p({type:"SESSION_START",gameId:r}),I.start()}function P(s){e.running=!1,I.stop(),p({type:s?"SESSION_WIN":"SESSION_FAIL",gameId:r,payload:{score:e.score}}),$(r,(t==null?void 0:t.saveSchemaVersion)??1,l=>{const n=l.state.bestScore||0;e.score>n&&(l.state.bestScore=e.score,l.bestScore=e.score)}),b(s?"Vagues nettoyées":"Drone détruit",(t==null?void 0:t.uiText.help)||"")}function b(s,h,l=!0){d.style.display="grid",d.innerHTML=`
    <div class="panel">
      <p class="pill">Pixel Shooter</p>
      <h2>${s}</h2>
      <p>${h}</p>
      <div style="display:flex; gap:10px; justify-content:center; margin-top:12px;">
        ${l?'<button class="btn" id="play-btn">Lancer</button>':""}
        <a class="btn secondary" href="${D("/apps/hub/")}">Hub</a>
      </div>
    </div>
  `;const n=document.getElementById("play-btn");n==null||n.addEventListener("click",A)}b((t==null?void 0:t.uiText.title)||"Pixel Shooter",(t==null?void 0:t.uiText.help)||"");function H(s){if(!e.running||!t)return;if(e.lastShot+=s,e.spawnTimer+=s*1e3,e.comboTimer=Math.max(0,e.comboTimer-s),e.comboTimer<=0&&(e.combo=0),e.waveTimer-=s,e.waveTimer<=0){if(p({type:"WAVE_CLEARED",gameId:r}),e.wave+=1,e.wave>t.difficultyParams.wavesToWin){P(!0);return}e.waveTimer=t.difficultyParams.waveLength,e.spawnTimer=0}const h=(m.isDown(t.input.keys.right||"KeyD")?1:0)+(m.isDown(t.input.keys.left||"KeyQ")?-1:0),l=(m.isDown(t.input.keys.down||"KeyS")?1:0)+(m.isDown(t.input.keys.up||"KeyZ")?-1:0);e.player.x+=h*t.difficultyParams.playerSpeed*(s*60),e.player.y+=l*t.difficultyParams.playerSpeed*(s*60),e.player.x=v(e.player.x,e.player.r,e.width-e.player.r),e.player.y=v(e.player.y,e.height*.35,e.height-e.player.r);const n=t.input.keys.shoot||"Space";if(m.isDown(n)&&e.lastShot>.18&&(e.bullets.push({x:e.player.x,y:e.player.y-8,speed:t.difficultyParams.bulletSpeed}),e.lastShot=0),e.spawnTimer>=t.difficultyParams.enemySpawnIntervalMs){e.spawnTimer=0;const a=S(e.player.x-60,e.player.x+60);e.enemies.push({x:v(a,20,e.width-20),y:-20,speed:t.difficultyParams.enemySpeed+e.wave*.2,vx:S(-.4,.4)})}e.bullets=e.bullets.map(a=>({...a,y:a.y-a.speed})).filter(a=>a.y>-10),e.enemies=e.enemies.filter(a=>{a.y+=a.speed,a.x+=a.vx,(a.x<10||a.x>e.width-10)&&(a.vx*=-1);const y=a.x-e.player.x,c=a.y-e.player.y;return Math.sqrt(y*y+c*c)<e.player.r+14?(e.lives-=1,p({type:"PLAYER_HIT",gameId:r}),e.lives>0):a.y<e.height+20});for(let a=e.enemies.length-1;a>=0;a--){const y=e.enemies[a];for(let c=e.bullets.length-1;c>=0;c--){const w=e.bullets[c],x=y.x-w.x,g=y.y-w.y;if(Math.sqrt(x*x+g*g)<16){e.enemies.splice(a,1),e.bullets.splice(c,1),e.score+=5*(1+Math.floor(e.combo/3)),e.combo+=1,e.comboTimer=2,p({type:"ENEMY_KILLED",gameId:r}),e.combo>0&&e.combo%5===0&&p({type:"COMBO_REACHED",gameId:r,payload:{combo:e.combo}});break}}}e.lives<=0&&P(!1)}function _(){i.save(),i.scale(devicePixelRatio,devicePixelRatio),i.clearRect(0,0,e.width,e.height),i.fillStyle=o.colors.primary,i.beginPath(),i.arc(e.player.x,e.player.y,e.player.r,0,Math.PI*2),i.fill(),i.strokeStyle=o.colors.accent,i.lineWidth=2,i.stroke(),i.fillStyle=o.colors.secondary,e.bullets.forEach(s=>{i.fillRect(s.x-3,s.y-10,6,12)}),i.fillStyle="#ff5afc",e.enemies.forEach(s=>{i.beginPath(),i.rect(s.x-12,s.y-12,24,24),i.fill()}),i.restore(),K()}function K(){f.innerHTML="",f.appendChild(d);const s=document.createElement("div");s.className="hud",s.innerHTML=`
    <div class="pill">Score ${e.score}</div>
    <div class="pill">Wave ${e.wave}/${(t==null?void 0:t.difficultyParams.wavesToWin)??0}</div>
    <div class="pill">Combo ${e.combo} (${e.comboTimer.toFixed(1)}s)</div>
    <div class="pill">Vies ${e.lives}</div>
  `,f.appendChild(s)}
