import{d as C,c as k,w as G,e as v,r as u}from"./loaders-CNHm-dlv.js";import{c as D,a as B}from"./input-xiSeUQqn.js";import{c as H}from"./loop-24SuRqx9.js";import{a as W,c as m,d as $}from"./index-niTdxgfr.js";const n="shooter",t=C(n),F=k(),c=F.find(r=>r.id===(t==null?void 0:t.themeId))||F[0];W();const g=new Image;g.src=new URL("data:image/svg+xml,%3csvg%20width='120'%20height='140'%20viewBox='0%200%20120%20140'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cdefs%3e%3clinearGradient%20id='shipBody'%20x1='0'%20y1='0'%20x2='1'%20y2='1'%3e%3cstop%20stop-color='%237CFFE1'%20/%3e%3cstop%20offset='1'%20stop-color='%237B8CFF'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='shipGlow'%20x1='0'%20y1='0'%20x2='1'%20y2='1'%3e%3cstop%20stop-color='%23ffffff'%20stop-opacity='0.8'%20/%3e%3cstop%20offset='1'%20stop-color='%23ffffff'%20stop-opacity='0.1'%20/%3e%3c/linearGradient%3e%3c/defs%3e%3cpath%20d='M60%208L92%20120H28L60%208Z'%20fill='url(%23shipBody)'%20stroke='%230AF0FF'%20stroke-width='4'%20/%3e%3cpath%20d='M60%2024L78%20118H42L60%2024Z'%20fill='url(%23shipGlow)'%20/%3e%3ccircle%20cx='60'%20cy='86'%20r='10'%20fill='%230A1224'%20/%3e%3cpath%20d='M44%20122h32l-16%2012-16-12Z'%20fill='%230A1224'%20opacity='0.8'%20/%3e%3c/svg%3e",import.meta.url).href;const b=new Image;b.src=new URL("data:image/svg+xml,%3csvg%20width='120'%20height='120'%20viewBox='0%200%20120%20120'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cdefs%3e%3cradialGradient%20id='eye'%20cx='0'%20cy='0'%20r='1'%20gradientUnits='userSpaceOnUse'%20gradientTransform='translate(60%2060)%20scale(52)'%3e%3cstop%20stop-color='%23FF7EE2'/%3e%3cstop%20offset='1'%20stop-color='%23320726'/%3e%3c/radialGradient%3e%3c/defs%3e%3ccircle%20cx='60'%20cy='60'%20r='54'%20fill='url(%23eye)'%20stroke='%23FF7EE2'%20stroke-width='6'%20/%3e%3crect%20x='40'%20y='32'%20width='40'%20height='56'%20rx='12'%20fill='%230A0F1F'%20stroke='%23FFB6F2'%20stroke-width='4'/%3e%3crect%20x='52'%20y='46'%20width='16'%20height='28'%20rx='8'%20fill='%2300F5A0'/%3e%3crect%20x='22'%20y='54'%20width='8'%20height='12'%20rx='4'%20fill='%23FF7EE2'/%3e%3crect%20x='90'%20y='54'%20width='8'%20height='12'%20rx='4'%20fill='%23FF7EE2'/%3e%3c/svg%3e",import.meta.url).href;const E=new Image;E.src=new URL("data:image/svg+xml,%3csvg%20width='24'%20height='38'%20viewBox='0%200%2024%2038'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cdefs%3e%3clinearGradient%20id='bolt'%20x1='0'%20y1='0'%20x2='0'%20y2='1'%3e%3cstop%20stop-color='%237CFFE1'/%3e%3cstop%20offset='1'%20stop-color='%237B8CFF'/%3e%3c/linearGradient%3e%3c/defs%3e%3crect%20x='6'%20y='2'%20width='12'%20height='30'%20rx='6'%20fill='url(%23bolt)'%20stroke='%230AF0FF'%20stroke-width='2'/%3e%3crect%20x='10'%20y='26'%20width='4'%20height='10'%20rx='2'%20fill='%23ffffff'%20fill-opacity='0.8'/%3e%3c/svg%3e",import.meta.url).href;if(c){const r=document.documentElement.style;r.setProperty("--color-primary",c.colors.primary),r.setProperty("--color-secondary",c.colors.secondary),r.setProperty("--color-accent",c.colors.accent),r.setProperty("--color-text",c.colors.text),r.setProperty("--color-muted",c.colors.muted),document.body.style.background=c.gradient||document.body.style.background}const w=document.getElementById("game-canvas"),x=document.getElementById("ui"),i=w.getContext("2d"),A=D(),h=document.createElement("div");h.className="overlay";h.style.display="none";x.appendChild(h);const s={up:(t==null?void 0:t.input.keys.up)||"ArrowUp",down:(t==null?void 0:t.input.keys.down)||"ArrowDown",left:(t==null?void 0:t.input.keys.left)||"ArrowLeft",right:(t==null?void 0:t.input.keys.right)||"ArrowRight",shoot:(t==null?void 0:t.input.keys.shoot)||"Space",altUp:"ArrowUp",altDown:"ArrowDown",altLeft:"ArrowLeft",altRight:"ArrowRight",altShoot:"Space"};B({container:document.body,input:A,mapping:{up:s.up,down:s.down,left:s.left,right:s.right,actionA:s.shoot,actionALabel:"Tir"}});const e={running:!1,width:0,height:0,player:{x:0,y:0,r:14},bullets:[],enemies:[],hearts:[],score:0,combo:0,comboTimer:0,lastShot:0,fireCooldown:.28,spawnTimer:0,wave:1,waveTimer:(t==null?void 0:t.difficultyParams.waveLength)??30,lives:3,maxLives:5,maxWave:(t==null?void 0:t.difficultyParams.wavesToWin)??3};function M(){w.width=window.innerWidth*devicePixelRatio,w.height=window.innerHeight*devicePixelRatio,e.width=w.width/devicePixelRatio,e.height=w.height/devicePixelRatio}M();window.addEventListener("resize",M);const R=H({update:r=>_(r),render:K,fps:60});function f(...r){return r.some(a=>a?A.isDown(a):!1)}function U(){if(!t){S("Config manquante","Ajoute configs/games/shooter.config.json",!1);return}e.running=!0,e.player.x=e.width/2,e.player.y=e.height*.75,e.bullets=[],e.enemies=[],e.hearts=[],e.score=0,e.combo=0,e.comboTimer=0,e.spawnTimer=0,e.wave=1,e.waveTimer=t.difficultyParams.waveLength,e.maxWave=t.difficultyParams.wavesToWin??3,e.lives=3,h.style.display="none",m({type:"SESSION_START",gameId:n}),R.start()}function P(r){e.running=!1,R.stop(),m({type:r?"SESSION_WIN":"SESSION_FAIL",gameId:n,payload:{score:e.score}}),$(n,(t==null?void 0:t.saveSchemaVersion)??1,p=>{const y=p.state.bestScore||0;e.score>y&&(p.state.bestScore=e.score,p.bestScore=e.score)}),S(r?"Vagues nettoyées":"Drone détruit",(t==null?void 0:t.uiText.help)||"")}function S(r,a,p=!0){h.style.display="grid",h.innerHTML=`
    <div class="panel">
      <p class="pill">Pixel Shooter</p>
      <h2>${r}</h2>
      <p>${a}</p>
      <div style="display:flex; gap:10px; justify-content:center; margin-top:12px;">
        ${p?'<button class="btn" id="play-btn">Lancer</button>':""}
        <a class="btn secondary" href="${G("/apps/hub/")}">Hub</a>
      </div>
    </div>
  `;const y=document.getElementById("play-btn");y==null||y.addEventListener("click",U)}S((t==null?void 0:t.uiText.title)||"Pixel Shooter",(t==null?void 0:t.uiText.help)||"");function _(r){if(!e.running||!t)return;if(e.lastShot+=r,e.spawnTimer+=r*1e3,e.comboTimer=Math.max(0,e.comboTimer-r),e.comboTimer<=0&&(e.combo=0),e.waveTimer-=r,e.waveTimer<=0){if(m({type:"WAVE_CLEARED",gameId:n}),e.wave+=1,e.wave>e.maxWave){P(!0);return}e.waveTimer=t.difficultyParams.waveLength,e.spawnTimer=0}const a=(f(s.right,s.altRight,"KeyD")?1:0)+(f(s.left,s.altLeft,"KeyQ","KeyA")?-1:0),p=(f(s.down,s.altDown,"KeyS")?1:0)+(f(s.up,s.altUp,"KeyZ","KeyW")?-1:0);e.player.x+=a*t.difficultyParams.playerSpeed*(r*60),e.player.y+=p*t.difficultyParams.playerSpeed*(r*60),e.player.x=v(e.player.x,e.player.r,e.width-e.player.r),e.player.y=v(e.player.y,e.height*.35,e.height-e.player.r);const y=s.shoot;if(f(y,s.altShoot)&&e.lastShot>e.fireCooldown&&(e.bullets.push({x:e.player.x,y:e.player.y-8,speed:t.difficultyParams.bulletSpeed}),e.lastShot=0),e.spawnTimer>=t.difficultyParams.enemySpawnIntervalMs){e.spawnTimer=0;const o=u(e.player.x-60,e.player.x+60);e.enemies.push({x:v(o,20,e.width-20),y:-20,speed:t.difficultyParams.enemySpeed+e.wave*.2,vx:u(-.4,.4)})}Math.random()<.0018*r*60&&e.hearts.push({x:u(20,e.width-20),y:-20,vy:u(.6,1.1)}),e.bullets=e.bullets.map(o=>({...o,y:o.y-o.speed})).filter(o=>o.y>-10),e.enemies=e.enemies.filter(o=>{o.y+=o.speed,o.x+=o.vx,(o.x<10||o.x>e.width-10)&&(o.vx*=-1);const d=o.x-e.player.x,l=o.y-e.player.y;return Math.sqrt(d*d+l*l)<e.player.r+14?(e.lives=Math.max(0,e.lives-1),m({type:"PLAYER_HIT",gameId:n}),!1):o.y<e.height+20}),e.hearts=e.hearts.filter(o=>{o.y+=o.vy;const d=o.x-e.player.x,l=o.y-e.player.y;return Math.sqrt(d*d+l*l)<e.player.r+14?(e.lives=Math.min(e.maxLives,e.lives+1),m({type:"ITEM_COLLECTED",gameId:n,payload:{type:"heart"}}),!1):o.y<e.height+30});for(let o=e.enemies.length-1;o>=0;o--){const d=e.enemies[o];for(let l=e.bullets.length-1;l>=0;l--){const T=e.bullets[l],L=d.x-T.x,I=d.y-T.y;if(Math.sqrt(L*L+I*I)<16){e.enemies.splice(o,1),e.bullets.splice(l,1),e.score+=5*(1+Math.floor(e.combo/3)),e.combo+=1,e.comboTimer=2,m({type:"ENEMY_KILLED",gameId:n}),e.combo>0&&e.combo%5===0&&m({type:"COMBO_REACHED",gameId:n,payload:{combo:e.combo}});break}}}e.lives<=0&&P(!1)}function K(){i.save(),i.scale(devicePixelRatio,devicePixelRatio),i.clearRect(0,0,e.width,e.height);const r=e.player.r*3;g.complete?i.drawImage(g,e.player.x-r/2,e.player.y-r/2,r,r):(i.fillStyle=c.colors.primary,i.beginPath(),i.arc(e.player.x,e.player.y,e.player.r,0,Math.PI*2),i.fill()),e.bullets.forEach(a=>{E.complete?i.drawImage(E,a.x-8,a.y-18,16,30):(i.fillStyle=c.colors.secondary,i.fillRect(a.x-3,a.y-10,6,12))}),e.enemies.forEach(a=>{b.complete?i.drawImage(b,a.x-16,a.y-16,32,32):(i.fillStyle="#ff5afc",i.fillRect(a.x-12,a.y-12,24,24))}),i.restore(),O()}function O(){x.innerHTML="",x.appendChild(h);const r=document.createElement("div");r.className="hud",r.innerHTML=`
    <div class="pill">Score ${e.score}</div>
    <div class="pill">Wave ${e.wave}/${e.maxWave}</div>
    <div class="pill">Combo ${e.combo} (${e.comboTimer.toFixed(1)}s)</div>
    <div class="pill">Vies ${e.lives}/${e.maxLives}</div>
  `,x.appendChild(r)}
