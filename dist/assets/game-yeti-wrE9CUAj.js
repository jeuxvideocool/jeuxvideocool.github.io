import{d as X,c as $,l as T,w as j,r as g,e as x}from"./loaders-Bj0CnEmo.js";import{c as k,a as D}from"./input-CrBvr0XE.js";import{c as H}from"./loop-24SuRqx9.js";import{a as O,l as U,d as I,f as Z}from"./index-D5lPzJ7_.js";const f="yeti",o=X(f),w=$(),d=o&&w.find(t=>t.id===o.themeId)||w[0];O();var R,Y;const N=((Y=(R=U().games)==null?void 0:R[f])==null?void 0:Y.bestScore)??0;if(d){const t=document.documentElement.style;t.setProperty("--color-primary",d.colors.primary),t.setProperty("--color-secondary",d.colors.secondary),t.setProperty("--color-accent",d.colors.accent),t.setProperty("--color-text",d.colors.text),t.setProperty("--color-muted",d.colors.muted),document.body.style.background=d.gradient||document.body.style.background}const M=new Image;M.src=new URL("data:image/svg+xml,%3csvg%20width='160'%20height='160'%20viewBox='0%200%20160%20160'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cdefs%3e%3clinearGradient%20id='body'%20x1='36'%20y1='20'%20x2='120'%20y2='144'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%230B1E35'/%3e%3cstop%20offset='1'%20stop-color='%2313395C'/%3e%3c/linearGradient%3e%3clinearGradient%20id='belly'%20x1='64'%20y1='54'%20x2='104'%20y2='126'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%23F9FCFF'/%3e%3cstop%20offset='1'%20stop-color='%23E5EFFA'/%3e%3c/linearGradient%3e%3clinearGradient%20id='shine'%20x1='54'%20y1='26'%20x2='82'%20y2='70'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%237BE0FF'%20stop-opacity='0.9'/%3e%3cstop%20offset='1'%20stop-color='%237BE0FF'%20stop-opacity='0'/%3e%3c/linearGradient%3e%3c/defs%3e%3cpath%20d='M80%2018c-28%200-50%2026-50%2058%200%2026%2012%2053%2050%2078%2038-25%2050-52%2050-78%200-32-22-58-50-58Z'%20fill='url(%23body)'%20stroke='%230AF0FF'%20stroke-width='4'%20stroke-linejoin='round'%20/%3e%3cpath%20d='M80%2034c-17%200-30%2016-30%2036%200%2016%208%2034%2030%2050%2022-16%2030-34%2030-50%200-20-13-36-30-36Z'%20fill='url(%23belly)'%20/%3e%3cellipse%20cx='80'%20cy='64'%20rx='22'%20ry='24'%20fill='url(%23shine)'%20/%3e%3cpath%20d='M68%20106c-8%2010-26%2010-30%204%202-6%2012-10%2022-10%204%200%206%202%208%206Z'%20fill='%23FFB157'%20opacity='0.9'%20/%3e%3cpath%20d='M92%20106c8%2010%2026%2010%2030%204-2-6-12-10-22-10-4%200-6%202-8%206Z'%20fill='%23FFB157'%20opacity='0.9'%20/%3e%3cpath%20d='M80%2068c6%200%2012%204%2012%206s-6%204-12%204-12-2-12-4%206-6%2012-6Z'%20fill='%23F2A950'%20/%3e%3ccircle%20cx='66'%20cy='54'%20r='8'%20fill='%230A0F1F'%20/%3e%3ccircle%20cx='94'%20cy='54'%20r='8'%20fill='%230A0F1F'%20/%3e%3ccircle%20cx='64'%20cy='52'%20r='3'%20fill='%23fff'%20/%3e%3ccircle%20cx='92'%20cy='52'%20r='3'%20fill='%23fff'%20/%3e%3cpath%20d='M80%2078c-6%206-12%2010-12%2016%200%203%204%208%2012%208s12-5%2012-8c0-6-6-10-12-16Z'%20fill='%23FFB157'%20opacity='0.9'%20/%3e%3cpath%20d='M58%2086c-6-4-12-10-14-18%202-6%208-12%2014-14-6%208-6%2024%200%2032Z'%20fill='%230AF0FF'%20opacity='0.55'%20/%3e%3cpath%20d='M102%2086c6-4%2012-10%2014-18-2-6-8-12-14-14%206%208%206%2024%200%2032Z'%20fill='%230AF0FF'%20opacity='0.55'%20/%3e%3c/svg%3e",import.meta.url).href;const y=document.getElementById("game-canvas"),v=document.getElementById("ui"),n=y.getContext("2d"),P=k(),h=document.createElement("div");h.className="overlay";h.style.display="none";v.appendChild(h);const F={action:(o==null?void 0:o.input.keys.swing)||"Space",restart:(o==null?void 0:o.input.keys.restart)||"KeyR"},A=D({container:document.body,input:P,mapping:{actionA:F.action,actionALabel:"Frapper"},autoShow:!1,showPad:!1}),r=(o==null?void 0:o.difficultyParams)??{},m=r.minAngle??20,b=r.maxAngle??68,e={phase:"angle",running:!1,width:0,height:0,groundY:0,startX:120,cameraX:0,angle:T(m,b,.5),power:.5,angleTimer:0,powerTimer:0,distance:0,best:N,wind:0,penguin:{x:0,y:0,vx:0,vy:0,rotation:0},objects:[],particles:[],actionHeld:!1,lastBoost:0};function C(){y.width=window.innerWidth*devicePixelRatio,y.height=window.innerHeight*devicePixelRatio,e.width=y.width/devicePixelRatio,e.height=y.height/devicePixelRatio,e.groundY=e.height*.72}C();window.addEventListener("resize",C);const L=H({update:t=>q(t),render:se,fps:60});function _(){const t=r.courseLength??4200,a=Math.max(3,Math.floor(r.mineCount??6)),i=Math.max(2,Math.floor(r.trapCount??4)),s=[...Array(a).fill("mine"),...Array(i).fill("trap")];let l=260;return s.map(c=>{const u=t/s.length;return l+=g(u*.4,u*1.25),{x:l+e.startX,type:c,triggered:!1}}).filter(c=>c.x<t+e.startX+200)}function z(){e.phase="angle",e.angleTimer=0,e.powerTimer=0,e.angle=T(m,b,.5),e.power=.5,e.distance=0,e.cameraX=0,e.penguin.x=e.startX,e.penguin.y=e.groundY-12,e.penguin.vx=0,e.penguin.vy=0,e.penguin.rotation=0,e.wind=g(-(r.windMax??42),r.windMax??42),e.objects=_(),e.particles=[],e.lastBoost=0,e.actionHeld=!1}function G(){if(!o){B("Config à compléter","Ajoute configs/games/yeti.config.json",!1);return}z(),A.show(),h.style.display="none",e.running=!0,e.phase="angle",I({type:"SESSION_START",gameId:f}),L.start()}function S(t,a){e.running=!1,e.phase="end",L.stop(),A.hide();const i=Math.floor(e.distance);I({type:t?"SESSION_WIN":"SESSION_FAIL",gameId:f,payload:{score:i}}),o&&Z(f,o.saveSchemaVersion,c=>{const u=c.state.bestDistance||0;e.distance>u&&(c.state.bestDistance=i,c.bestScore=i)}),e.best=Math.max(e.best,i);const l=a??(o==null?void 0:o.uiText.help)??"";B(t?"Vol record !":"Fin du vol",`${l}<br/><strong>${i} m</strong> atteints.`)}function B(t,a,i=!0){A.hide(),h.style.display="grid",h.innerHTML=`
    <div class="panel">
      <p class="pill">Yeti Launch</p>
      <h2>${t}</h2>
      <p>${a}</p>
      <div class="cta-row">
        ${i?'<button class="btn" id="play-btn">Frapper</button>':""}
        <a class="btn secondary" href="${j("/apps/hub/")}">Hub</a>
      </div>
    </div>
  `;const s=document.getElementById("play-btn");s==null||s.addEventListener("click",G)}B((o==null?void 0:o.uiText.title)||"Lance le pingouin",(o==null?void 0:o.uiText.help)||"Appuie sur Espace pour figer l'angle, puis une seconde fois pour verrouiller la puissance. Les mines relancent ton vol, évite les pieux.");function E(t,a,i,s,l){for(let c=0;c<s;c++){const u=g(-Math.PI/2-.8,-Math.PI/2+.8);e.particles.push({x:t,y:a,vx:Math.cos(u)*g(l*.5,l),vy:Math.sin(u)*g(l*.5,l),life:g(.4,.9),color:i})}}function V(t){const a=r.mineLift??1200,i=r.mineBoost??260;e.penguin.vy=-a*g(.92,1.1),e.penguin.vx+=i*g(.85,1.2),e.lastBoost=.5,E(t.x,e.groundY-4,"rgba(255,255,255,0.9)",24,520),I({type:"MINE_BOOST",gameId:f})}function W(t){E(t.x,e.groundY-8,"rgba(255,116,116,0.9)",16,360),e.penguin.vx=0,e.penguin.vy=0,e.penguin.rotation=0,S(!1,"Le pingouin est stoppé net par un piège !")}function K(){for(const t of e.objects){if(t.triggered)continue;const a=t.x-e.penguin.x;if(Math.abs(a)<26){t.triggered=!0,t.type==="mine"?V(t):W(t);return}}}function q(t){if(!o||e.phase==="end")return;if(P.isDown(F.restart)&&!e.running){G();return}const i=P.isDown(F.action),s=i&&!e.actionHeld;if(e.actionHeld=i,!!e.running){if(e.phase==="angle"){e.angleTimer+=t*(r.aimSpeed??2.4);const l=(Math.sin(e.angleTimer)+1)/2;e.angle=T(m,b,l),s&&(e.phase="power",e.powerTimer=0)}else e.phase==="power"?(e.powerTimer+=t*(r.powerSpeed??3.1),e.power=(Math.sin(e.powerTimer)+1)/2,s&&J()):e.phase==="flight"&&(Q(t),s&&e.penguin.y>=e.groundY-40&&e.penguin.vy>-60&&(e.penguin.vy=-220,e.penguin.vx+=40));e.lastBoost>0&&(e.lastBoost=Math.max(0,e.lastBoost-t))}}function J(){const t=r.basePower??900,a=e.angle*Math.PI/180,i=t*(.45+e.power*.75);e.penguin.vx=Math.cos(a)*i+e.wind*.8,e.penguin.vy=-Math.sin(a)*i,e.phase="flight"}function Q(t){const a=r.gravity??1700,i=r.airDrag??60,s=r.groundDrag??220;e.penguin.vy+=a*t;const l=Math.sign(e.penguin.vx)*i*t;e.penguin.vx=Math.sign(e.penguin.vx)*Math.max(0,Math.abs(e.penguin.vx)-Math.abs(l)),e.penguin.vx+=e.wind/8*t,e.penguin.vx=Math.max(0,e.penguin.vx),e.penguin.x+=e.penguin.vx*t,e.penguin.y+=e.penguin.vy*t;let c=!1;if(e.penguin.y>=e.groundY){e.penguin.y=e.groundY,c=!0;const p=Math.abs(e.penguin.vy);if(p>240?(e.penguin.vy=-p*(r.bounceFactor??.58),e.penguin.vx*=.98,E(e.penguin.x,e.groundY-2,"rgba(255,255,255,0.8)",10,280)):(e.penguin.vy=0,e.penguin.vx=Math.max(0,e.penguin.vx-s*t)),K(),!e.running)return}e.distance=Math.max(0,e.penguin.x-e.startX),e.cameraX=Math.max(0,e.penguin.x-e.width*.35),e.penguin.rotation=Math.atan2(e.penguin.vy,e.penguin.vx);const u=e.phase==="flight"?.01:0;if(e.wind=x(e.wind+g(-1,1)*u,-(r.windMax??42),r.windMax??42),e.penguin.x-e.startX>(r.courseLength??4200)+400){S(!0,"Tu as dépassé toute la zone de jeu !");return}if(c&&e.lastBoost<=.05&&Math.abs(e.penguin.vx)<12&&Math.abs(e.penguin.vy)<10){const p=r.winDistance??900;S(e.distance>=p)}e.particles=e.particles.map(p=>({...p,life:p.life-t,x:p.x+p.vx*t,y:p.y+p.vy*t+18*t})).filter(p=>p.life>.05)}function ee(){const t=n.createLinearGradient(0,0,0,e.height);t.addColorStop(0,"rgba(108, 190, 255, 0.4)"),t.addColorStop(.5,"rgba(23, 49, 87, 0.6)"),t.addColorStop(1,"rgba(8, 18, 33, 1)"),n.fillStyle=t,n.fillRect(0,0,e.width,e.height),n.save(),n.translate(-e.cameraX*.15,0);const a=e.height*.42;n.fillStyle="rgba(255,255,255,0.14)",n.beginPath(),n.moveTo(-200,a+20);for(let i=0;i<6;i++){const s=i*240+60;n.lineTo(s,a+g(-40,30))}n.lineTo(e.width+400,a+60),n.lineTo(e.width+400,e.height),n.lineTo(-200,e.height),n.closePath(),n.fill(),n.restore()}function te(){n.save(),n.translate(-e.cameraX,0),n.fillStyle="rgba(15, 32, 50, 0.9)",n.fillRect(-400,e.groundY,e.width+800,e.height-e.groundY),n.fillStyle="rgba(255,255,255,0.6)";for(let t=-2;t<40;t++){const a=t*140;n.fillRect(a,e.groundY-6,80,2)}n.restore()}function ne(){n.save(),n.translate(-e.cameraX,0);for(const t of e.objects)t.type==="mine"?(n.fillStyle=t.triggered?"rgba(255,255,255,0.4)":"rgba(255,255,255,0.9)",n.beginPath(),n.arc(t.x,e.groundY-6,14,0,Math.PI*2),n.fill(),n.fillStyle="rgba(91, 179, 255, 0.9)",n.fillRect(t.x-10,e.groundY-20,20,8)):(n.fillStyle="rgba(255,116,116,0.9)",n.beginPath(),n.moveTo(t.x-10,e.groundY),n.lineTo(t.x,e.groundY-30),n.lineTo(t.x+10,e.groundY),n.closePath(),n.fill());n.restore()}function ae(){var i;n.save(),n.translate(-e.cameraX,0);const t=e.startX-48,a=e.groundY-46;n.fillStyle="rgba(255,255,255,0.85)",n.beginPath(),n.roundRect(t-12,a,52,58,12),n.fill(),n.fillStyle="rgba(0,0,0,0.4)",n.fillRect(t+12,a+10,18,10),n.strokeStyle=((i=d==null?void 0:d.colors)==null?void 0:i.accent)||"#4dddbb",n.lineWidth=5,n.beginPath(),n.moveTo(t-6,a+10),n.lineTo(t+40,a-18),n.stroke(),n.restore()}function ie(){n.save(),n.translate(-e.cameraX+e.penguin.x,e.penguin.y),n.rotate(e.penguin.rotation);const t=56;M.complete?n.drawImage(M,-t/2,-t/2,t,t):(n.fillStyle="rgba(255,255,255,0.9)",n.beginPath(),n.arc(0,0,t/3,0,Math.PI*2),n.fill()),n.restore()}function oe(){n.save(),n.translate(-e.cameraX,0);for(const t of e.particles)n.globalAlpha=x(t.life,0,1),n.fillStyle=t.color,n.beginPath(),n.arc(t.x,t.y,3,0,Math.PI*2),n.fill();n.globalAlpha=1,n.restore()}function se(){n.save(),n.scale(devicePixelRatio,devicePixelRatio),n.clearRect(0,0,e.width,e.height),ee(),te(),ne(),ae(),ie(),oe(),n.restore(),re()}function re(){v.innerHTML="",v.appendChild(h);const t=document.createElement("div");t.className="hud";const a=e.phase==="angle"?"Choisis l'angle":e.phase==="power"?"Charge la frappe":e.phase==="flight"?"En vol":"Pause",i=x((e.angle-m)/(b-m),0,1)*100,s=x(e.power,0,1)*100;t.innerHTML=`
    <div class="pill">Distance ${Math.floor(e.distance)} m</div>
    <div class="pill">Record ${Math.floor(e.best)} m</div>
    <div class="pill">Vent ${e.wind.toFixed(0)} km/h</div>
    <div class="pill">${a}</div>
    <div class="meters">
      <div class="meter">
        <div class="label">Angle</div>
        <div class="bar"><span style="width:${i}%"></span></div>
        <small>${e.angle.toFixed(0)}°</small>
      </div>
      <div class="meter">
        <div class="label">Puissance</div>
        <div class="bar"><span style="width:${s}%"></span></div>
        <small>${Math.round(s)}%</small>
      </div>
    </div>
  `,v.appendChild(t)}
