import{d as R,c as B,w as $,e as T,r as u}from"./loaders-CNHm-dlv.js";import{c as D,a as H}from"./input-xiSeUQqn.js";import{c as W}from"./loop-24SuRqx9.js";import{a as _,c as m,d as O}from"./index-niTdxgfr.js";const n="shooter",o=R(n),M=B(),d=M.find(s=>s.id===(o==null?void 0:o.themeId))||M[0];_();const F=new Image;F.src=new URL("data:image/svg+xml,%3csvg%20width='120'%20height='140'%20viewBox='0%200%20120%20140'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cdefs%3e%3clinearGradient%20id='shipBody'%20x1='0'%20y1='0'%20x2='1'%20y2='1'%3e%3cstop%20stop-color='%237CFFE1'%20/%3e%3cstop%20offset='1'%20stop-color='%237B8CFF'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='shipGlow'%20x1='0'%20y1='0'%20x2='1'%20y2='1'%3e%3cstop%20stop-color='%23ffffff'%20stop-opacity='0.8'%20/%3e%3cstop%20offset='1'%20stop-color='%23ffffff'%20stop-opacity='0.1'%20/%3e%3c/linearGradient%3e%3c/defs%3e%3cpath%20d='M60%208L92%20120H28L60%208Z'%20fill='url(%23shipBody)'%20stroke='%230AF0FF'%20stroke-width='4'%20/%3e%3cpath%20d='M60%2024L78%20118H42L60%2024Z'%20fill='url(%23shipGlow)'%20/%3e%3ccircle%20cx='60'%20cy='86'%20r='10'%20fill='%230A1224'%20/%3e%3cpath%20d='M44%20122h32l-16%2012-16-12Z'%20fill='%230A1224'%20opacity='0.8'%20/%3e%3c/svg%3e",import.meta.url).href;const E=new Image;E.src=new URL("data:image/svg+xml,%3csvg%20width='120'%20height='120'%20viewBox='0%200%20120%20120'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cdefs%3e%3cradialGradient%20id='eye'%20cx='0'%20cy='0'%20r='1'%20gradientUnits='userSpaceOnUse'%20gradientTransform='translate(60%2060)%20scale(52)'%3e%3cstop%20stop-color='%23FF7EE2'/%3e%3cstop%20offset='1'%20stop-color='%23320726'/%3e%3c/radialGradient%3e%3c/defs%3e%3ccircle%20cx='60'%20cy='60'%20r='54'%20fill='url(%23eye)'%20stroke='%23FF7EE2'%20stroke-width='6'%20/%3e%3crect%20x='40'%20y='32'%20width='40'%20height='56'%20rx='12'%20fill='%230A0F1F'%20stroke='%23FFB6F2'%20stroke-width='4'/%3e%3crect%20x='52'%20y='46'%20width='16'%20height='28'%20rx='8'%20fill='%2300F5A0'/%3e%3crect%20x='22'%20y='54'%20width='8'%20height='12'%20rx='4'%20fill='%23FF7EE2'/%3e%3crect%20x='90'%20y='54'%20width='8'%20height='12'%20rx='4'%20fill='%23FF7EE2'/%3e%3c/svg%3e",import.meta.url).href;const I=new Image;I.src=new URL("data:image/svg+xml,%3csvg%20width='24'%20height='38'%20viewBox='0%200%2024%2038'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cdefs%3e%3clinearGradient%20id='bolt'%20x1='0'%20y1='0'%20x2='0'%20y2='1'%3e%3cstop%20stop-color='%237CFFE1'/%3e%3cstop%20offset='1'%20stop-color='%237B8CFF'/%3e%3c/linearGradient%3e%3c/defs%3e%3crect%20x='6'%20y='2'%20width='12'%20height='30'%20rx='6'%20fill='url(%23bolt)'%20stroke='%230AF0FF'%20stroke-width='2'/%3e%3crect%20x='10'%20y='26'%20width='4'%20height='10'%20rx='2'%20fill='%23ffffff'%20fill-opacity='0.8'/%3e%3c/svg%3e",import.meta.url).href;const P=new Image;P.src=new URL("data:image/svg+xml,%3csvg%20width='120'%20height='110'%20viewBox='0%200%20120%20110'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cdefs%3e%3clinearGradient%20id='heartGrad'%20x1='0'%20y1='0'%20x2='1'%20y2='1'%3e%3cstop%20stop-color='%23FF7EE2'/%3e%3cstop%20offset='1'%20stop-color='%23FFB6BF'/%3e%3c/linearGradient%3e%3c/defs%3e%3cpath%20d='M60%20102S12%2074%2012%2042c0-14%2010-26%2024-26%2012%200%2020%208%2024%2016%204-8%2012-16%2024-16%2014%200%2024%2012%2024%2026%200%2032-48%2060-48%2060Z'%20fill='url(%23heartGrad)'%20stroke='%23FFE4F3'%20stroke-width='4'%20/%3e%3c/svg%3e",import.meta.url).href;const L=new Image;L.src=new URL("data:image/svg+xml,%3csvg%20width='120'%20height='120'%20viewBox='0%200%20120%20120'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cdefs%3e%3clinearGradient%20id='boostGrad'%20x1='0'%20y1='0'%20x2='1'%20y2='1'%3e%3cstop%20stop-color='%237CFFE1'/%3e%3cstop%20offset='1'%20stop-color='%237B8CFF'/%3e%3c/linearGradient%3e%3c/defs%3e%3ccircle%20cx='60'%20cy='60'%20r='52'%20fill='%230A0F24'%20stroke='%237CFFE1'%20stroke-width='4'/%3e%3cpath%20d='M64%2018%2094%2060H64l18%2042-46-48h28L40%2018h24Z'%20fill='url(%23boostGrad)'%20stroke='%230AF0FF'%20stroke-width='4'/%3e%3c/svg%3e",import.meta.url).href;if(d){const s=document.documentElement.style;s.setProperty("--color-primary",d.colors.primary),s.setProperty("--color-secondary",d.colors.secondary),s.setProperty("--color-accent",d.colors.accent),s.setProperty("--color-text",d.colors.text),s.setProperty("--color-muted",d.colors.muted),document.body.style.background=d.gradient||document.body.style.background}const v=document.getElementById("game-canvas"),g=document.getElementById("ui"),a=v.getContext("2d"),k=D(),x=document.createElement("div");x.className="overlay";x.style.display="none";g.appendChild(x);const c={up:(o==null?void 0:o.input.keys.up)||"ArrowUp",down:(o==null?void 0:o.input.keys.down)||"ArrowDown",left:(o==null?void 0:o.input.keys.left)||"ArrowLeft",right:(o==null?void 0:o.input.keys.right)||"ArrowRight",shoot:(o==null?void 0:o.input.keys.shoot)||"Space",altLeft:"ArrowLeft",altRight:"ArrowRight",altShoot:"Space"};H({container:document.body,input:k,mapping:{up:c.up,down:c.down,left:c.left,right:c.right,actionA:c.shoot,actionALabel:"Tir"}});const e={running:!1,width:0,height:0,player:{x:0,y:0,r:14},bullets:[],enemies:[],hearts:[],boosts:[],score:0,combo:0,comboTimer:0,lastShot:0,fireCooldown:.28,cooldownPaused:0,spawnTimer:0,wave:1,waveTimer:(o==null?void 0:o.difficultyParams.waveLength)??30,lives:3,maxLives:5,maxWave:(o==null?void 0:o.difficultyParams.wavesToWin)??3};function C(){v.width=window.innerWidth*devicePixelRatio,v.height=window.innerHeight*devicePixelRatio,e.width=v.width/devicePixelRatio,e.height=v.height/devicePixelRatio}C();window.addEventListener("resize",C);const G=W({update:s=>q(s),render:N,fps:60});function b(...s){return s.some(r=>r?k.isDown(r):!1)}function U(){if(!o){S("Config manquante","Ajoute configs/games/shooter.config.json",!1);return}e.running=!0,e.player.x=e.width/2,e.player.y=e.height*.78,e.bullets=[],e.enemies=[],e.hearts=[],e.boosts=[],e.score=0,e.combo=0,e.comboTimer=0,e.spawnTimer=0,e.wave=1,e.waveTimer=o.difficultyParams.waveLength,e.maxWave=o.difficultyParams.wavesToWin??3,e.lives=3,e.cooldownPaused=0,x.style.display="none",m({type:"SESSION_START",gameId:n}),G.start()}function A(s){e.running=!1,G.stop(),m({type:s?"SESSION_WIN":"SESSION_FAIL",gameId:n,payload:{score:e.score}}),O(n,(o==null?void 0:o.saveSchemaVersion)??1,f=>{const w=f.state.bestScore||0;e.score>w&&(f.state.bestScore=e.score,f.bestScore=e.score)}),S(s?"Vagues nettoyées":"Drone détruit",(o==null?void 0:o.uiText.help)||"")}function S(s,r,f=!0){x.style.display="grid",x.innerHTML=`
    <div class="panel">
      <p class="pill">Pixel Shooter</p>
      <h2>${s}</h2>
      <p>${r}</p>
      <div style="display:flex; gap:10px; justify-content:center; margin-top:12px;">
        ${f?'<button class="btn" id="play-btn">Lancer</button>':""}
        <a class="btn secondary" href="${$("/apps/hub/")}">Hub</a>
      </div>
    </div>
  `;const w=document.getElementById("play-btn");w==null||w.addEventListener("click",U)}S((o==null?void 0:o.uiText.title)||"Pixel Shooter",(o==null?void 0:o.uiText.help)||"");function q(s){if(!e.running||!o)return;if(e.lastShot+=s,e.cooldownPaused=Math.max(0,e.cooldownPaused-s),e.spawnTimer+=s*1e3,e.comboTimer=Math.max(0,e.comboTimer-s),e.comboTimer<=0&&(e.combo=0),e.waveTimer-=s,e.waveTimer<=0){if(m({type:"WAVE_CLEARED",gameId:n}),e.wave+=1,e.wave>e.maxWave){A(!0);return}e.waveTimer=o.difficultyParams.waveLength,e.spawnTimer=0}const r=(b(c.right,c.altRight,"KeyD")?1:0)+(b(c.left,c.altLeft,"KeyQ","KeyA")?-1:0);e.player.x+=r*o.difficultyParams.playerSpeed*(s*60),e.player.x=T(e.player.x,e.player.r,e.width-e.player.r),e.player.y=e.height*.78;const f=c.shoot,w=e.cooldownPaused>0?0:e.fireCooldown;if(b(f,c.altShoot)&&e.lastShot>w&&(e.bullets.push({x:e.player.x,y:e.player.y-8,speed:o.difficultyParams.bulletSpeed}),e.lastShot=0),e.spawnTimer>=o.difficultyParams.enemySpawnIntervalMs){e.spawnTimer=0;const t=u(e.player.x-60,e.player.x+60);e.enemies.push({x:T(t,20,e.width-20),y:-20,speed:o.difficultyParams.enemySpeed+e.wave*.2,vx:u(-.4,.4)})}Math.random()<.0018*s*60&&e.hearts.push({x:u(20,e.width-20),y:-20,vy:u(.6,1.1)}),Math.random()<.001*s*60&&e.boosts.push({x:u(20,e.width-20),y:-20,vy:u(.7,1.2),duration:u(2,10)}),e.bullets=e.bullets.map(t=>({...t,y:t.y-t.speed})).filter(t=>t.y>-10),e.enemies=e.enemies.filter(t=>{t.y+=t.speed,t.x+=t.vx,(t.x<10||t.x>e.width-10)&&(t.vx*=-1);const i=t.x-e.player.x,l=t.y-e.player.y;return Math.sqrt(i*i+l*l)<e.player.r+14?(e.lives=Math.max(0,e.lives-1),m({type:"PLAYER_HIT",gameId:n}),!1):t.y<e.height+20}),e.hearts=e.hearts.filter(t=>{t.y+=t.vy;const i=t.x-e.player.x,l=t.y-e.player.y;return Math.sqrt(i*i+l*l)<e.player.r+14?(e.lives=Math.min(e.maxLives,e.lives+1),m({type:"ITEM_COLLECTED",gameId:n,payload:{type:"heart"}}),!1):t.y<e.height+30}),e.boosts=e.boosts.filter(t=>{t.y+=t.vy;const i=t.x-e.player.x,l=t.y-e.player.y;return Math.sqrt(i*i+l*l)<e.player.r+14?(e.cooldownPaused=Math.max(e.cooldownPaused,t.duration),m({type:"ITEM_COLLECTED",gameId:n,payload:{type:"cooldown"}}),!1):t.y<e.height+30});for(let t=e.enemies.length-1;t>=0;t--){const i=e.enemies[t];for(let l=e.bullets.length-1;l>=0;l--){const p=e.bullets[l],h=i.x-p.x,y=i.y-p.y;if(Math.sqrt(h*h+y*y)<16){e.enemies.splice(t,1),e.bullets.splice(l,1),e.score+=5*(1+Math.floor(e.combo/3)),e.combo+=1,e.comboTimer=2,m({type:"ENEMY_KILLED",gameId:n}),e.combo>0&&e.combo%5===0&&m({type:"COMBO_REACHED",gameId:n,payload:{combo:e.combo}});break}}}for(let t=e.hearts.length-1;t>=0;t--){const i=e.hearts[t];for(let l=e.bullets.length-1;l>=0;l--){const p=e.bullets[l],h=i.x-p.x,y=i.y-p.y;if(Math.sqrt(h*h+y*y)<18){e.hearts.splice(t,1),e.bullets.splice(l,1);break}}}for(let t=e.boosts.length-1;t>=0;t--){const i=e.boosts[t];for(let l=e.bullets.length-1;l>=0;l--){const p=e.bullets[l],h=i.x-p.x,y=i.y-p.y;if(Math.sqrt(h*h+y*y)<18){e.boosts.splice(t,1),e.bullets.splice(l,1);break}}}e.lives<=0&&A(!1)}function N(){a.save(),a.scale(devicePixelRatio,devicePixelRatio),a.clearRect(0,0,e.width,e.height);const s=e.player.r*3;F.complete?a.drawImage(F,e.player.x-s/2,e.player.y-s/2,s,s):(a.fillStyle=d.colors.primary,a.beginPath(),a.arc(e.player.x,e.player.y,e.player.r,0,Math.PI*2),a.fill()),e.bullets.forEach(r=>{I.complete?a.drawImage(I,r.x-8,r.y-18,16,30):(a.fillStyle=d.colors.secondary,a.fillRect(r.x-3,r.y-10,6,12))}),e.enemies.forEach(r=>{E.complete?a.drawImage(E,r.x-16,r.y-16,32,32):(a.fillStyle="#ff5afc",a.fillRect(r.x-12,r.y-12,24,24))}),e.hearts.forEach(r=>{P.complete?a.drawImage(P,r.x-14,r.y-12,28,24):(a.fillStyle="#ff7ee2",a.beginPath(),a.arc(r.x,r.y,10,0,Math.PI*2),a.fill())}),e.boosts.forEach(r=>{L.complete?a.drawImage(L,r.x-14,r.y-14,28,28):(a.fillStyle="#7cffe1",a.beginPath(),a.rect(r.x-12,r.y-12,24,24),a.fill())}),a.restore(),j()}function j(){g.innerHTML="",g.appendChild(x);const s=document.createElement("div");s.className="hud",s.innerHTML=`
    <div class="pill">Score ${e.score}</div>
    <div class="pill">Wave ${e.wave}/${e.maxWave}</div>
    <div class="pill">Combo ${e.combo} (${e.comboTimer.toFixed(1)}s)</div>
    <div class="pill">Vies ${e.lives}/${e.maxLives}</div>
    ${e.cooldownPaused>0?`<div class="pill">Cooldown off ${e.cooldownPaused.toFixed(1)}s</div>`:""}
  `,g.appendChild(s)}
