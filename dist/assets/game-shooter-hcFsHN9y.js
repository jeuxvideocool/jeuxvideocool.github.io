import{l as W,e as _,f as j,p as F,w as U,n as y,m as x,s as q}from"./index-CK9lGSzJ.js";/* empty css                    */import{c as N,a as K}from"./input-C49DsMBr.js";import{c as Z}from"./loop-24SuRqx9.js";const f="shooter",t=W(f),D=_(),p=D.find(a=>a.id===(t==null?void 0:t.themeId))||D[0];j();const M=new Image;M.src=new URL("data:image/svg+xml,%3csvg%20width='120'%20height='140'%20viewBox='0%200%20120%20140'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cdefs%3e%3clinearGradient%20id='shipBody'%20x1='0'%20y1='0'%20x2='1'%20y2='1'%3e%3cstop%20stop-color='%237CFFE1'%20/%3e%3cstop%20offset='1'%20stop-color='%237B8CFF'%20/%3e%3c/linearGradient%3e%3clinearGradient%20id='shipGlow'%20x1='0'%20y1='0'%20x2='1'%20y2='1'%3e%3cstop%20stop-color='%23ffffff'%20stop-opacity='0.8'%20/%3e%3cstop%20offset='1'%20stop-color='%23ffffff'%20stop-opacity='0.1'%20/%3e%3c/linearGradient%3e%3c/defs%3e%3cpath%20d='M60%208L92%20120H28L60%208Z'%20fill='url(%23shipBody)'%20stroke='%230AF0FF'%20stroke-width='4'%20/%3e%3cpath%20d='M60%2024L78%20118H42L60%2024Z'%20fill='url(%23shipGlow)'%20/%3e%3ccircle%20cx='60'%20cy='86'%20r='10'%20fill='%230A1224'%20/%3e%3cpath%20d='M44%20122h32l-16%2012-16-12Z'%20fill='%230A1224'%20opacity='0.8'%20/%3e%3c/svg%3e",import.meta.url).href;const $=new Image;$.src=new URL("data:image/svg+xml,%3csvg%20width='120'%20height='120'%20viewBox='0%200%20120%20120'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cdefs%3e%3cradialGradient%20id='eye'%20cx='0'%20cy='0'%20r='1'%20gradientUnits='userSpaceOnUse'%20gradientTransform='translate(60%2060)%20scale(52)'%3e%3cstop%20stop-color='%23FF7EE2'/%3e%3cstop%20offset='1'%20stop-color='%23320726'/%3e%3c/radialGradient%3e%3c/defs%3e%3ccircle%20cx='60'%20cy='60'%20r='54'%20fill='url(%23eye)'%20stroke='%23FF7EE2'%20stroke-width='6'%20/%3e%3crect%20x='40'%20y='32'%20width='40'%20height='56'%20rx='12'%20fill='%230A0F1F'%20stroke='%23FFB6F2'%20stroke-width='4'/%3e%3crect%20x='52'%20y='46'%20width='16'%20height='28'%20rx='8'%20fill='%2300F5A0'/%3e%3crect%20x='22'%20y='54'%20width='8'%20height='12'%20rx='4'%20fill='%23FF7EE2'/%3e%3crect%20x='90'%20y='54'%20width='8'%20height='12'%20rx='4'%20fill='%23FF7EE2'/%3e%3c/svg%3e",import.meta.url).href;const C=new Image;C.src=new URL("data:image/svg+xml,%3csvg%20width='24'%20height='38'%20viewBox='0%200%2024%2038'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cdefs%3e%3clinearGradient%20id='bolt'%20x1='0'%20y1='0'%20x2='0'%20y2='1'%3e%3cstop%20stop-color='%237CFFE1'/%3e%3cstop%20offset='1'%20stop-color='%237B8CFF'/%3e%3c/linearGradient%3e%3c/defs%3e%3crect%20x='6'%20y='2'%20width='12'%20height='30'%20rx='6'%20fill='url(%23bolt)'%20stroke='%230AF0FF'%20stroke-width='2'/%3e%3crect%20x='10'%20y='26'%20width='4'%20height='10'%20rx='2'%20fill='%23ffffff'%20fill-opacity='0.8'/%3e%3c/svg%3e",import.meta.url).href;const A=new Image;A.src=new URL("data:image/svg+xml,%3csvg%20width='120'%20height='110'%20viewBox='0%200%20120%20110'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cdefs%3e%3clinearGradient%20id='heartGrad'%20x1='0'%20y1='0'%20x2='1'%20y2='1'%3e%3cstop%20stop-color='%23FF7EE2'/%3e%3cstop%20offset='1'%20stop-color='%23FFB6BF'/%3e%3c/linearGradient%3e%3c/defs%3e%3cpath%20d='M60%20102S12%2074%2012%2042c0-14%2010-26%2024-26%2012%200%2020%208%2024%2016%204-8%2012-16%2024-16%2014%200%2024%2012%2024%2026%200%2032-48%2060-48%2060Z'%20fill='url(%23heartGrad)'%20stroke='%23FFE4F3'%20stroke-width='4'%20/%3e%3c/svg%3e",import.meta.url).href;const k=new Image;k.src=new URL("data:image/svg+xml,%3csvg%20width='120'%20height='120'%20viewBox='0%200%20120%20120'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cdefs%3e%3clinearGradient%20id='boostGrad'%20x1='0'%20y1='0'%20x2='1'%20y2='1'%3e%3cstop%20stop-color='%237CFFE1'/%3e%3cstop%20offset='1'%20stop-color='%237B8CFF'/%3e%3c/linearGradient%3e%3c/defs%3e%3ccircle%20cx='60'%20cy='60'%20r='52'%20fill='%230A0F24'%20stroke='%237CFFE1'%20stroke-width='4'/%3e%3cpath%20d='M64%2018%2094%2060H64l18%2042-46-48h28L40%2018h24Z'%20fill='url(%23boostGrad)'%20stroke='%230AF0FF'%20stroke-width='4'/%3e%3c/svg%3e",import.meta.url).href;if(p){const a=document.documentElement.style;a.setProperty("--color-primary",p.colors.primary),a.setProperty("--color-secondary",p.colors.secondary),a.setProperty("--color-accent",p.colors.accent),a.setProperty("--color-text",p.colors.text),a.setProperty("--color-muted",p.colors.muted),document.body.style.background=p.gradient||document.body.style.background}const E=document.getElementById("game-canvas"),S=document.getElementById("ui"),l=E.getContext("2d"),G=N(),v=document.createElement("div");v.className="launch-overlay";v.style.display="none";S.appendChild(v);const u={up:(t==null?void 0:t.input.keys.up)||"ArrowUp",down:(t==null?void 0:t.input.keys.down)||"ArrowDown",left:(t==null?void 0:t.input.keys.left)||"ArrowLeft",right:(t==null?void 0:t.input.keys.right)||"ArrowRight",shoot:(t==null?void 0:t.input.keys.shoot)||"Space",altLeft:"ArrowLeft",altRight:"ArrowRight",altShoot:"Space"},L=K({gameId:f,container:document.body,input:G,touch:{mapping:{left:u.left,right:u.right,actionA:u.shoot,actionALabel:"Tir"},showPad:!1,gestureEnabled:!0},motion:{input:G,axis:{x:{negative:u.left,positive:u.right}},actions:[{code:u.shoot,trigger:"tiltForward",mode:"hold",threshold:14}]},hints:{touch:"Tactile : glisse pour bouger, bouton Tir.",motion:"Gyro : incline pour bouger, penche vers l'avant pour tirer."}}),b={easy:{label:"Facile",waves:10,lives:5,heartRate:.003,boostRate:.002},medium:{label:"Moyen",waves:20,lives:4,heartRate:.002,boostRate:.0014},hard:{label:"Difficile",waves:30,lives:3,heartRate:.001,boostRate:9e-4},extreme:{label:"Extrême",waves:50,lives:1,heartRate:0,boostRate:0},endless:{label:"Infini",waves:1/0,lives:3,heartRate:.0012,boostRate:9e-4}};let T="medium";const e={running:!1,width:0,height:0,player:{x:0,y:0,r:14},bullets:[],enemies:[],hearts:[],boosts:[],score:0,combo:0,comboTimer:0,lastShot:0,fireCooldown:.28,cooldownPaused:0,heat:0,overheat:!1,spawnTimer:0,wave:1,waveTimer:(t==null?void 0:t.difficultyParams.waveLength)??30,lives:3,maxLives:5,maxWave:(t==null?void 0:t.difficultyParams.wavesToWin)??3,heartSpawnRate:.0018,boostSpawnRate:.001};function B(){const a=E.getBoundingClientRect(),h=devicePixelRatio||1;E.width=a.width*h,E.height=a.height*h,e.width=a.width,e.height=a.height}B();window.addEventListener("resize",B);const H=Z({update:a=>z(a),render:X,fps:60});function P(...a){return a.some(h=>h?G.isDown(h):!1)}function V(){if(!t){R("Config manquante","Ajoute configs/games/shooter.config.json",!1);return}L.show();const a=b[T]||b.medium;e.running=!0,e.player.x=e.width/2,e.player.y=e.height*.78,e.bullets=[],e.enemies=[],e.hearts=[],e.boosts=[],e.score=0,e.combo=0,e.comboTimer=0,e.spawnTimer=0,e.wave=1,e.waveTimer=t.difficultyParams.waveLength,e.maxWave=a.waves,e.lives=a.lives,e.maxLives=a.lives,e.heartSpawnRate=a.heartRate,e.boostSpawnRate=a.boostRate,e.cooldownPaused=0,e.heat=0,e.overheat=!1,v.style.display="none",y({type:"SESSION_START",gameId:f}),H.start()}function O(a){e.running=!1,H.stop(),L.hide(),y({type:a?"SESSION_WIN":"SESSION_FAIL",gameId:f,payload:{score:e.score}}),q(f,(t==null?void 0:t.saveSchemaVersion)??1,d=>{const i=d.state.bestScore||0;e.score>i&&(d.state.bestScore=e.score,d.bestScore=e.score)}),R(a?"Vagues nettoyées":"Drone détruit",(t==null?void 0:t.uiText.help)||"")}function R(a,h,d=!0){L.hide(),v.style.display="grid";const i=(t==null?void 0:t.uiText.shortDescription)||"",g=h||(t==null?void 0:t.uiText.help)||"",w=((t==null?void 0:t.uiText.controls)||[]).map(n=>`<span class="launch-chip">${n}</span>`).join(""),I=b[T]||b.medium,r=`
    <div class="launch-rows">
      <div class="launch-row">
        <span class="launch-row-label">Difficulté</span>
        <div class="launch-row-value launch-options">
          ${Object.entries(b).map(([n,c])=>`
        <button class="launch-option diff-btn ${n===T?"is-active":""}" data-diff="${n}">
          <span class="launch-option-title">${c.label}</span>
          <span class="launch-option-meta">${c.waves===1/0?"∞":c.waves} vagues · ${c.lives} vie${c.lives>1?"s":""}</span>
        </button>
      `).join("")}
        </div>
      </div>
      <div class="launch-row">
        <span class="launch-row-label">Objectif</span>
        <div class="launch-row-value">
          <span class="launch-chip">${I.waves===1/0?"Infini":`${I.waves} vagues`}</span>
        </div>
      </div>
    </div>
  `;v.innerHTML=`
    <div class="launch-card">
      <div class="launch-head">
        <div class="launch-brand">
          <span class="launch-badge">Arcade Galaxy</span>
          <span class="launch-badge ghost">${(t==null?void 0:t.uiText.title)||"Pixel Shooter"}</span>
        </div>
        <h2 class="launch-title">${a}</h2>
        ${i?`<p class="launch-subtitle">${i}</p>`:""}
      </div>
      <div class="launch-grid">
        <section class="launch-section">
          <h3 class="launch-section-title">Briefing</h3>
          <p class="launch-text">${g}</p>
        </section>
        <section class="launch-section">
          <h3 class="launch-section-title">Paramètres</h3>
          ${r}
        </section>
        <section class="launch-section">
          <h3 class="launch-section-title">Contrôles</h3>
          <div class="launch-chips">
            ${w||'<span class="launch-chip muted">Contrôles à définir</span>'}
          </div>
        </section>
      </div>
      <div class="launch-actions">
        ${d?'<button class="launch-btn primary" id="launch-start">Lancer</button>':""}
        <a class="launch-btn ghost" href="${U("/")}">Hub</a>
      </div>
    </div>
  `,L.attachOverlay(v);const o=document.getElementById("launch-start");o==null||o.addEventListener("click",V),document.querySelectorAll(".diff-btn").forEach(n=>{n.addEventListener("click",()=>{const c=n.dataset.diff;c&&b[c]&&(T=c,R(a,h,d))})})}R((t==null?void 0:t.uiText.title)||"Pixel Shooter",(t==null?void 0:t.uiText.help)||"");function z(a){if(!e.running||!t)return;e.lastShot+=a,e.cooldownPaused=Math.max(0,e.cooldownPaused-a);const h=.35;if(e.heat=F(e.heat-h*a,0,1.2),e.overheat&&e.heat<.2&&(e.overheat=!1),e.spawnTimer+=a*1e3,e.comboTimer=Math.max(0,e.comboTimer-a),e.comboTimer<=0&&(e.combo=0),e.waveTimer-=a,e.waveTimer<=0){if(y({type:"WAVE_CLEARED",gameId:f}),e.wave+=1,e.wave>e.maxWave){O(!0);return}e.waveTimer=t.difficultyParams.waveLength,e.spawnTimer=0}const d=(P(u.right,u.altRight,"KeyD")?1:0)+(P(u.left,u.altLeft,"KeyQ","KeyA")?-1:0);e.player.x+=d*t.difficultyParams.playerSpeed*(a*60),e.player.x=F(e.player.x,e.player.r,e.width-e.player.r),e.player.y=e.height*.78;const i=u.shoot,g=P(i,u.altShoot),w=e.fireCooldown,I=e.overheat;if(g&&!I&&e.lastShot>w&&(e.bullets.push({x:e.player.x,y:e.player.y-8,speed:t.difficultyParams.bulletSpeed}),e.lastShot=0,e.cooldownPaused<=0&&(e.heat=F(e.heat+.18,0,1.2),e.heat>=1&&(e.overheat=!0))),e.spawnTimer>=t.difficultyParams.enemySpawnIntervalMs){e.spawnTimer=0;const s=x(e.player.x-60,e.player.x+60);e.enemies.push({x:F(s,20,e.width-20),y:-20,speed:t.difficultyParams.enemySpeed+e.wave*.2,vx:x(-.4,.4)})}e.heartSpawnRate>0&&Math.random()<e.heartSpawnRate*a*60&&e.hearts.push({x:x(20,e.width-20),y:-20,vy:x(.6,1.1)}),e.boostSpawnRate>0&&Math.random()<e.boostSpawnRate*a*60&&e.boosts.push({x:x(20,e.width-20),y:-20,vy:x(.7,1.2),duration:x(2,10)}),e.bullets=e.bullets.map(s=>({...s,y:s.y-s.speed})).filter(s=>s.y>-10),e.enemies=e.enemies.filter(s=>{s.y+=s.speed,s.x+=s.vx,(s.x<10||s.x>e.width-10)&&(s.vx*=-1);const r=s.x-e.player.x,o=s.y-e.player.y;return Math.sqrt(r*r+o*o)<e.player.r+14?(e.lives=Math.max(0,e.lives-1),y({type:"PLAYER_HIT",gameId:f}),!1):s.y<e.height+20}),e.hearts=e.hearts.filter(s=>{s.y+=s.vy;const r=s.x-e.player.x,o=s.y-e.player.y;return Math.sqrt(r*r+o*o)<e.player.r+14?(e.lives=Math.min(e.maxLives,e.lives+1),y({type:"ITEM_COLLECTED",gameId:f,payload:{type:"heart"}}),!1):s.y<e.height+30}),e.boosts=e.boosts.filter(s=>{s.y+=s.vy;const r=s.x-e.player.x,o=s.y-e.player.y;return Math.sqrt(r*r+o*o)<e.player.r+14?(e.cooldownPaused=Math.max(e.cooldownPaused,s.duration),y({type:"ITEM_COLLECTED",gameId:f,payload:{type:"cooldown"}}),!1):s.y<e.height+30});for(let s=e.enemies.length-1;s>=0;s--){const r=e.enemies[s];for(let o=e.bullets.length-1;o>=0;o--){const n=e.bullets[o],c=r.x-n.x,m=r.y-n.y;if(Math.sqrt(c*c+m*m)<16){e.enemies.splice(s,1),e.bullets.splice(o,1),e.score+=5*(1+Math.floor(e.combo/3)),e.combo+=1,e.comboTimer=2,y({type:"ENEMY_KILLED",gameId:f}),e.combo>0&&e.combo%5===0&&y({type:"COMBO_REACHED",gameId:f,payload:{combo:e.combo}});break}}}for(let s=e.hearts.length-1;s>=0;s--){const r=e.hearts[s];for(let o=e.bullets.length-1;o>=0;o--){const n=e.bullets[o],c=r.x-n.x,m=r.y-n.y;if(Math.sqrt(c*c+m*m)<18){e.hearts.splice(s,1),e.bullets.splice(o,1);break}}}for(let s=e.boosts.length-1;s>=0;s--){const r=e.boosts[s];for(let o=e.bullets.length-1;o>=0;o--){const n=e.bullets[o],c=r.x-n.x,m=r.y-n.y;if(Math.sqrt(c*c+m*m)<18){e.boosts.splice(s,1),e.bullets.splice(o,1);break}}}e.lives<=0&&O(!1)}function X(){const a=Math.round(E.clientWidth),h=Math.round(E.clientHeight);(a!==Math.round(e.width)||h!==Math.round(e.height))&&B(),l.save(),l.scale(devicePixelRatio,devicePixelRatio),l.clearRect(0,0,e.width,e.height);const d=e.player.r*3;M.complete?l.drawImage(M,e.player.x-d/2,e.player.y-d/2,d,d):(l.fillStyle=p.colors.primary,l.beginPath(),l.arc(e.player.x,e.player.y,e.player.r,0,Math.PI*2),l.fill()),e.bullets.forEach(i=>{const g=F(e.heat,0,1);if(C.complete){const w=g>.7?p.colors.accent:p.colors.primary;l.filter=`drop-shadow(0 0 10px ${w})`,l.drawImage(C,i.x-8,i.y-18,16,30),l.filter="none"}else{const w=g>.7?p.colors.accent:p.colors.secondary;l.fillStyle=w,l.fillRect(i.x-3,i.y-10,6,12)}}),e.enemies.forEach(i=>{$.complete?l.drawImage($,i.x-16,i.y-16,32,32):(l.fillStyle="#ff5afc",l.fillRect(i.x-12,i.y-12,24,24))}),e.hearts.forEach(i=>{A.complete?l.drawImage(A,i.x-14,i.y-12,28,24):(l.fillStyle="#ff7ee2",l.beginPath(),l.arc(i.x,i.y,10,0,Math.PI*2),l.fill())}),e.boosts.forEach(i=>{k.complete?l.drawImage(k,i.x-14,i.y-14,28,28):(l.fillStyle="#7cffe1",l.beginPath(),l.rect(i.x-12,i.y-12,24,24),l.fill())}),l.restore(),Y()}function Y(){S.innerHTML="",S.appendChild(v);const a=document.createElement("div");a.className="hud";const h=e.maxWave===1/0?"∞":e.maxWave,d=Math.round(e.heat*100);a.innerHTML=`
    <div class="pill">Score ${e.score}</div>
    <div class="pill">Wave ${e.wave}/${h}</div>
    <div class="pill">Combo ${e.combo} (${e.comboTimer.toFixed(1)}s)</div>
    <div class="pill">Vies ${e.lives}/${e.maxLives}</div>
    ${e.cooldownPaused>0?`<div class="pill">Chaleur figée ${e.cooldownPaused.toFixed(1)}s</div>`:""}
    <div class="pill ${e.overheat?"danger":""}">Chaleur ${d}%${e.overheat?" (Overheat)":""}</div>
  `,S.appendChild(a)}
