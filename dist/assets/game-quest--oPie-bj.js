import{l as Y,e as z,f as W,w as X,n as b,m as h,p as x,s as Q}from"./index-CK9lGSzJ.js";/* empty css                    */import{c as V,a as K}from"./input-C49DsMBr.js";import{c as J}from"./loop-24SuRqx9.js";const m="quest",t=Y(m),O=z(),p=O.find(s=>s.id===(t==null?void 0:t.themeId))||O[0];W();const C=new Image;C.src=new URL("data:image/svg+xml,%3csvg%20width='140'%20height='160'%20viewBox='0%200%20140%20160'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cdefs%3e%3clinearGradient%20id='cloak'%20x1='0'%20y1='0'%20x2='1'%20y2='1'%3e%3cstop%20stop-color='%237CFFE1'/%3e%3cstop%20offset='1'%20stop-color='%237B8CFF'/%3e%3c/linearGradient%3e%3c/defs%3e%3cpath%20d='M70%2014c18%200%2032%2014%2032%2032v16l10%2016-10%2010v30c0%2010-8%2018-18%2018H56c-10%200-18-8-18-18v-30l-10-10%2010-16V46c0-18%2014-32%2032-32Z'%20fill='url(%23cloak)'%20stroke='%230AF0FF'%20stroke-width='4'/%3e%3ccircle%20cx='70'%20cy='54'%20r='18'%20fill='%230A0F1F'%20stroke='%23E9F5FF'%20stroke-width='4'/%3e%3crect%20x='54'%20y='96'%20width='32'%20height='36'%20rx='12'%20fill='%230A0F1F'%20opacity='0.8'/%3e%3ccircle%20cx='60'%20cy='52'%20r='5'%20fill='%23E9F5FF'/%3e%3ccircle%20cx='80'%20cy='52'%20r='5'%20fill='%23E9F5FF'/%3e%3c/svg%3e",import.meta.url).href;const I=new Image;I.src=new URL("data:image/svg+xml,%3csvg%20width='80'%20height='80'%20viewBox='0%200%2080%2080'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cdefs%3e%3cradialGradient%20id='orb'%20cx='0'%20cy='0'%20r='1'%20gradientUnits='userSpaceOnUse'%20gradientTransform='translate(40%2040)%20scale(38)'%3e%3cstop%20stop-color='%237B8CFF'/%3e%3cstop%20offset='1'%20stop-color='%230A0F24'/%3e%3c/radialGradient%3e%3c/defs%3e%3ccircle%20cx='40'%20cy='40'%20r='34'%20fill='url(%23orb)'%20stroke='%23B6C4FF'%20stroke-width='4'/%3e%3ccircle%20cx='40'%20cy='34'%20r='12'%20fill='%23E9F5FF'%20fill-opacity='0.75'/%3e%3c/svg%3e",import.meta.url).href;const P=new Image;P.src=new URL("data:image/svg+xml,%3csvg%20width='90'%20height='70'%20viewBox='0%200%2090%2070'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3crect%20x='6'%20y='28'%20width='78'%20height='20'%20rx='6'%20fill='%232D0A12'%20stroke='%23FF5F6D'%20stroke-width='4'/%3e%3cpath%20d='M10%2048%2018%2022l10%2026%2010-26%2010%2026%2010-26%2010%2026%2010-26%206%2026'%20stroke='%23FFB6BF'%20stroke-width='4'%20stroke-linecap='round'/%3e%3c/svg%3e",import.meta.url).href;const S=new Image;S.src=new URL("data:image/svg+xml,%3csvg%20width='90'%20height='140'%20viewBox='0%200%2090%20140'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3crect%20x='18'%20y='8'%20width='54'%20height='124'%20rx='10'%20fill='%230A0F1F'%20stroke='%237CFFE1'%20stroke-width='4'/%3e%3crect%20x='26'%20y='16'%20width='38'%20height='108'%20rx='8'%20fill='%230A162E'%20stroke='%2300D9F5'%20stroke-width='3'/%3e%3ccircle%20cx='45'%20cy='70'%20r='10'%20fill='%2300F5A0'/%3e%3c/svg%3e",import.meta.url).href;const D=new Image;D.src=new URL("data:image/svg+xml,%3csvg%20width='120'%20height='120'%20viewBox='0%200%20120%20120'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cdefs%3e%3clinearGradient%20id='body'%20x1='20'%20y1='12'%20x2='96'%20y2='110'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%231A0B1F'/%3e%3cstop%20offset='0.5'%20stop-color='%232B0F23'/%3e%3cstop%20offset='1'%20stop-color='%233E1020'/%3e%3c/linearGradient%3e%3clinearGradient%20id='scar'%20x1='28'%20y1='36'%20x2='76'%20y2='92'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%23FF3D6A'/%3e%3cstop%20offset='1'%20stop-color='%23FF9B55'/%3e%3c/linearGradient%3e%3cradialGradient%20id='eyeGlow'%20cx='0'%20cy='0'%20r='1'%20gradientUnits='userSpaceOnUse'%20gradientTransform='matrix(12%200%200%2010%2060%2058)'%3e%3cstop%20stop-color='%23FF7A9E'%20stop-opacity='0.9'/%3e%3cstop%20offset='1'%20stop-color='%23FF3D6A'%20stop-opacity='0'/%3e%3c/radialGradient%3e%3clinearGradient%20id='fang'%20x1='0'%20y1='0'%20x2='0'%20y2='12'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%23FFF4CC'/%3e%3cstop%20offset='1'%20stop-color='%23FFDAC2'/%3e%3c/linearGradient%3e%3cfilter%20id='shadow'%20x='-10%25'%20y='-10%25'%20width='120%25'%20height='130%25'%20color-interpolation-filters='sRGB'%3e%3cfeDropShadow%20dx='0'%20dy='10'%20stdDeviation='8'%20flood-color='%23FF3D6A'%20flood-opacity='0.22'/%3e%3cfeDropShadow%20dx='0'%20dy='4'%20stdDeviation='6'%20flood-color='%23000'%20flood-opacity='0.45'/%3e%3c/filter%3e%3c/defs%3e%3cg%20filter='url(%23shadow)'%3e%3cpath%20d='M60%208c-11%207-22%208-33%203l-7%2020c-5%2013-6%2028-2%2041%205%2018%2018%2032%2034%2037%203%201%207%201%2010%200%2016-5%2029-19%2034-37%204-13%203-28-2-41l-7-20c-11%205-22%204-33-3Z'%20fill='url(%23body)'%20stroke='%23FF4D74'%20stroke-width='3'%20stroke-linejoin='round'/%3e%3cpath%20d='M38%2016%2022%206l6%2024'%20stroke='%23FF4D74'%20stroke-width='4'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M82%2016%2098%206l-6%2024'%20stroke='%23FF4D74'%20stroke-width='4'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M32%2096c14%2010%2042%2010%2056%200'%20stroke='%237A1F2D'%20stroke-width='4'%20stroke-linecap='round'/%3e%3cpath%20d='M30%2044c8-6%2016-8%2024-7'%20stroke='url(%23scar)'%20stroke-width='4'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M78%2036c-4%206-5%2012-3%2018'%20stroke='url(%23scar)'%20stroke-width='4'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cellipse%20cx='44'%20cy='58'%20rx='14'%20ry='12'%20fill='%230A0710'%20stroke='%23FF6385'%20stroke-width='2'/%3e%3cellipse%20cx='76'%20cy='58'%20rx='14'%20ry='12'%20fill='%230A0710'%20stroke='%23FF6385'%20stroke-width='2'/%3e%3ccircle%20cx='44'%20cy='58'%20r='9'%20fill='url(%23eyeGlow)'/%3e%3ccircle%20cx='76'%20cy='58'%20r='9'%20fill='url(%23eyeGlow)'/%3e%3cellipse%20cx='44'%20cy='58'%20rx='6'%20ry='7'%20fill='%23FF9B55'/%3e%3cellipse%20cx='76'%20cy='58'%20rx='6'%20ry='7'%20fill='%23FF9B55'/%3e%3crect%20x='42'%20y='52'%20width='4'%20height='12'%20rx='2'%20fill='%230A0710'/%3e%3crect%20x='74'%20y='52'%20width='4'%20height='12'%20rx='2'%20fill='%230A0710'/%3e%3cpath%20d='M42%2083c5%208%2031%208%2036%200'%20stroke='%23FFD6B4'%20stroke-width='3.5'%20stroke-linecap='round'/%3e%3cpath%20d='M48%2083%2044%2094%2052%2083Z'%20fill='url(%23fang)'%20stroke='%23FF3D6A'%20stroke-width='1'/%3e%3cpath%20d='M60%2084%2056%2095%2064%2084Z'%20fill='url(%23fang)'%20stroke='%23FF3D6A'%20stroke-width='1'/%3e%3cpath%20d='M72%2083%2068%2094%2076%2083Z'%20fill='url(%23fang)'%20stroke='%23FF3D6A'%20stroke-width='1'/%3e%3cpath%20d='M54%2070c4%202%208%202%2012%200'%20stroke='%232E2E2E'%20stroke-width='3'%20stroke-linecap='round'/%3e%3c/g%3e%3c/svg%3e",import.meta.url).href;if(p){const s=document.documentElement.style;s.setProperty("--color-primary",p.colors.primary),s.setProperty("--color-secondary",p.colors.secondary),s.setProperty("--color-accent",p.colors.accent),s.setProperty("--color-text",p.colors.text),s.setProperty("--color-muted",p.colors.muted),document.body.style.background=p.gradient||document.body.style.background}const A=document.getElementById("game-canvas"),T=document.getElementById("ui"),i=A.getContext("2d"),g=V(),v=document.createElement("div");v.className="launch-overlay";v.style.display="none";T.appendChild(v);const G=10,ee=3;var q,H,j,_;const d={up:(t==null?void 0:t.input.keys.up)||"ArrowUp",down:(t==null?void 0:t.input.keys.down)||"ArrowDown",left:(t==null?void 0:t.input.keys.left)||"ArrowLeft",right:(t==null?void 0:t.input.keys.right)||"ArrowRight",attack:((H=(q=t==null?void 0:t.input)==null?void 0:q.keys)==null?void 0:H.attack)||((_=(j=t==null?void 0:t.input)==null?void 0:j.keys)==null?void 0:_.interact)||"Space"},M=K({gameId:m,container:document.body,input:g,touch:{mapping:{up:d.up,down:d.down,left:d.left,right:d.right,actionA:d.attack,actionALabel:"Frappe"},showPad:!1,gestureEnabled:!0},motion:{input:g,axis:{x:{negative:d.left,positive:d.right},y:{negative:d.up,positive:d.down}},actions:[{code:d.attack,trigger:"shake"}]},hints:{touch:"Tactile : glisse pour bouger, bouton Frappe.",motion:"Gyro : incline pour bouger, secoue pour frapper."}}),e={running:!1,width:0,height:0,player:{x:0,y:0,r:12},items:[],traps:[],enemies:[],gate:{x:0,y:0,open:!1},timer:(t==null?void 0:t.difficultyParams.timeLimitSeconds)??60,collected:0,enemySpeed:(t==null?void 0:t.difficultyParams.enemySpeed)??1.5,invulnerable:0,level:1,baseTime:(t==null?void 0:t.difficultyParams.timeLimitSeconds)??60,timeDecay:5,baseItemCount:(t==null?void 0:t.difficultyParams.itemCount)??6,baseTrapCount:(t==null?void 0:t.difficultyParams.trapCount)??4,baseEnemyCount:(t==null?void 0:t.difficultyParams.enemyCount)??3,baseEnemySpeed:(t==null?void 0:t.difficultyParams.enemySpeed)??1.5,attackTimer:0,chaseTimer:0,chaseActive:!1};function L(){const s=A.getBoundingClientRect(),c=devicePixelRatio||1;A.width=s.width*c,A.height=s.height*c,e.width=s.width,e.height=s.height}L();window.addEventListener("resize",L);const N=J({update:s=>re(s),render:ce,fps:60});function te(){if(!t){B("Config manquante","Ajoute configs/games/quest.config.json",!1);return}M.show(),e.running=!0,e.baseTime=(t==null?void 0:t.difficultyParams.timeLimitSeconds)??60,e.timeDecay=5,e.level=1,e.invulnerable=0,e.attackTimer=0,e.chaseTimer=0,e.chaseActive=!1,Z(),v.style.display="none",b({type:"SESSION_START",gameId:m}),N.start()}function Z(){e.player.x=e.width*.15,e.player.y=e.height/2,e.items=[],e.traps=[],e.enemies=[],e.collected=0,e.gate={x:e.width*.85,y:e.height/2,open:!1};const s=Math.max(10,e.baseTime-(e.level-1)*e.timeDecay);e.timer=s;const c=e.level-1,o=e.baseItemCount,y=e.baseTrapCount+Math.min(c,4),r=e.baseEnemyCount+Math.min(c,6),a=t.difficultyParams.playerSpeed,l=Math.max(.5,a*.9);e.enemySpeed=Math.min(e.baseEnemySpeed+c*.2,l),e.attackTimer=0,e.chaseTimer=0,e.chaseActive=!1,ae(o),se(y),ie(r)}function ae(s){for(let c=0;c<s;c++)e.items.push({x:h(e.width*.25,e.width*.8),y:h(50,e.height-50),collected:!1})}function se(s){for(let c=0;c<s;c++)e.traps.push({x:h(e.width*.2,e.width*.8),y:h(60,e.height-60),active:!0})}function ie(s){for(let c=0;c<s;c++){const o=h(0,Math.PI*2);e.enemies.push({x:h(e.width*.3,e.width*.8),y:h(80,e.height-80),vx:h(-1,1)||.5,vy:h(-.6,.6),wx:Math.cos(o),wy:Math.sin(o),wt:h(1.2,3)})}}function E(s){e.running=!1,N.stop(),M.hide(),b({type:"SESSION_FAIL",gameId:m,payload:{remaining:e.timer}}),Q(m,(t==null?void 0:t.saveSchemaVersion)??1,o=>{o.state.bestTime}),B("Temps écoulé",(t==null?void 0:t.uiText.help)||"")}function B(s,c,o=!0){M.hide();const y=c&&c.trim().length?c:"Récupère les artefacts, esquive les pièges et repousse les monstres pour atteindre la porte.",r=d.attack===" "?"Espace":d.attack,a=(t==null?void 0:t.uiText.shortDescription)||"",l=((t==null?void 0:t.uiText.controls)||[]).map(k=>`<span class="launch-chip">${k}</span>`).join(""),n=(t==null?void 0:t.difficultyParams.timeLimitSeconds)??90,w=(t==null?void 0:t.difficultyParams.itemCount)??6,u=(t==null?void 0:t.difficultyParams.trapCount)??4,F=`
    <div class="launch-rows">
      <div class="launch-row">
        <span class="launch-row-label">Mode</span>
        <div class="launch-row-value">
          <span class="launch-chip">Chrono</span>
        </div>
      </div>
      <div class="launch-row">
        <span class="launch-row-label">Temps</span>
        <div class="launch-row-value">
          <span class="launch-chip">${n}s</span>
        </div>
      </div>
      <div class="launch-row">
        <span class="launch-row-label">Totems</span>
        <div class="launch-row-value">
          <span class="launch-chip">${w}</span>
          <span class="launch-chip muted">Pièges ${u}</span>
        </div>
      </div>
    </div>
  `;v.style.display="grid",v.innerHTML=`
    <div class="launch-card">
      <div class="launch-head">
        <div class="launch-brand">
          <span class="launch-badge">Arcade Galaxy</span>
          <span class="launch-badge ghost">${(t==null?void 0:t.uiText.title)||"Mini Quest"}</span>
        </div>
        <h2 class="launch-title">${s}</h2>
        ${a?`<p class="launch-subtitle">${a}</p>`:""}
      </div>
      <div class="launch-grid">
        <section class="launch-section">
          <h3 class="launch-section-title">Briefing</h3>
          <p class="launch-text">${y}</p>
          <p class="launch-note">Chaque porte réduit le temps disponible et renforce les ennemis. Collecte tout, évite les pièges et frappe (${r}) pour les repousser.</p>
        </section>
        <section class="launch-section">
          <h3 class="launch-section-title">Paramètres</h3>
          ${F}
        </section>
        <section class="launch-section">
          <h3 class="launch-section-title">Contrôles</h3>
          <div class="launch-chips">
            ${l||'<span class="launch-chip muted">Contrôles à définir</span>'}
          </div>
        </section>
      </div>
      <div class="launch-actions">
        ${o?'<button class="launch-btn primary" id="launch-start">Lancer</button>':""}
        <a class="launch-btn ghost" href="${X("/")}">Hub</a>
      </div>
    </div>
  `,M.attachOverlay(v);const f=document.getElementById("launch-start");f==null||f.addEventListener("click",te)}B((t==null?void 0:t.uiText.title)||"Mini Quest",(t==null?void 0:t.uiText.help)||"");function re(s){if(!e.running||!t)return;if(e.timer-=s,e.invulnerable=Math.max(0,e.invulnerable-s),e.attackTimer=Math.max(0,e.attackTimer-s),e.chaseTimer+=s,e.chaseActive&&e.chaseTimer>=ee?(e.chaseActive=!1,e.chaseTimer=0):!e.chaseActive&&e.chaseTimer>=G&&(e.chaseActive=!0,e.chaseTimer=0),e.timer<=0){E();return}const c=(g.isDown(d.right)?1:0)+(g.isDown(d.left)?-1:0),o=(g.isDown(d.down)?1:0)+(g.isDown(d.up)?-1:0);if(e.player.x+=c*t.difficultyParams.playerSpeed*(s*60),e.player.y+=o*t.difficultyParams.playerSpeed*(s*60),e.player.x=x(e.player.x,e.player.r,e.width-e.player.r),e.player.y=x(e.player.y,e.player.r,e.height-e.player.r),e.enemies.forEach(a=>{if(a.wt-=s,!e.chaseActive&&a.wt<=0){const U=h(0,Math.PI*2);a.wx=Math.cos(U),a.wy=Math.sin(U),a.wt=h(1.4,3.2)}const l=e.player.x-a.x,n=e.player.y-a.y,w=Math.max(1,Math.sqrt(l*l+n*n)),u=e.chaseActive?l/w:a.wx,F=e.chaseActive?n/w:a.wy,f=h(-.12,.12),k=h(-.12,.12),$=e.enemySpeed,R=e.chaseActive?.9:.45;a.vx=x(a.vx*.8+(u*R+f)*.8,-1.8,1.8),a.vy=x(a.vy*.8+(F*R+k)*.8,-1.6,1.6),a.x+=a.vx*$*(s*60),a.y+=a.vy*$*(s*60),e.chaseActive||((a.x<20||a.x>e.width-20)&&(a.wx=-a.wx),(a.y<40||a.y>e.height-40)&&(a.wy=-a.wy)),a.x=x(a.x,20,e.width-20),a.y=x(a.y,40,e.height-40)}),e.invulnerable<=0)for(const a of e.enemies){const l=a.x-e.player.x,n=a.y-e.player.y;if(Math.sqrt(l*l+n*n)<e.player.r+14){E(),b({type:"PLAYER_HIT",gameId:m});return}}if(e.attackTimer<=0&&g.isDown(d.attack)){e.attackTimer=.6,e.invulnerable=.4;const a=80;e.enemies.forEach(l=>{const n=l.x-e.player.x,w=l.y-e.player.y,u=Math.sqrt(n*n+w*w);if(u<a){const F=2+(a-u)/a*2,f=u?n/u:1,k=u?w/u:0;l.vx=f*F,l.vy=k*F,l.x+=f*10,l.y+=k*10}})}e.items.forEach(a=>{if(a.collected)return;const l=a.x-e.player.x,n=a.y-e.player.y;Math.sqrt(l*l+n*n)<e.player.r+10&&(a.collected=!0,e.collected+=1,b({type:"ITEM_COLLECTED",gameId:m}),e.collected>=e.items.length&&(e.gate.open=!0,b({type:"GATE_UNLOCKED",gameId:m})))}),e.traps.forEach(a=>{if(!a.active)return;const l=a.x-e.player.x,n=a.y-e.player.y;Math.sqrt(l*l+n*n)<e.player.r+10&&(a.active=!1,E(),b({type:"TRAP_TRIGGERED",gameId:m}))});const y=e.gate.x-e.player.x,r=e.gate.y-e.player.y;e.gate.open&&Math.sqrt(y*y+r*r)<e.player.r+16&&(e.level+=1,Z())}function ce(){const s=Math.round(A.clientWidth),c=Math.round(A.clientHeight);(s!==Math.round(e.width)||c!==Math.round(e.height))&&L(),i.save(),i.scale(devicePixelRatio,devicePixelRatio),i.clearRect(0,0,e.width,e.height),S.complete?(i.globalAlpha=e.gate.open?1:.65,i.drawImage(S,e.gate.x-20,e.gate.y-50,40,100),i.globalAlpha=1):(i.fillStyle=e.gate.open?p.colors.accent:"rgba(255,255,255,0.1)",i.fillRect(e.gate.x-14,e.gate.y-24,28,48)),e.items.forEach(r=>{r.collected&&(i.globalAlpha=.35),I.complete?i.drawImage(I,r.x-16,r.y-16,32,32):(i.fillStyle=r.collected?"rgba(255,255,255,0.2)":p.colors.secondary,i.beginPath(),i.arc(r.x,r.y,10,0,Math.PI*2),i.fill()),i.globalAlpha=1}),e.traps.forEach(r=>{r.active&&(P.complete?i.drawImage(P,r.x-22,r.y-16,44,32):(i.fillStyle="rgba(255,95,109,0.9)",i.beginPath(),i.moveTo(r.x,r.y-10),i.lineTo(r.x-10,r.y+10),i.lineTo(r.x+10,r.y+10),i.closePath(),i.fill()))}),e.enemies.forEach(r=>{D.complete?i.drawImage(D,r.x-18,r.y-18,36,36):(i.fillStyle=p.colors.accent,i.beginPath(),i.arc(r.x,r.y,16,0,Math.PI*2),i.fill())});const o=e.player.r*2.6;C.complete?i.drawImage(C,e.player.x-o/2,e.player.y-o/2,o,o):(i.fillStyle=p.colors.primary,i.beginPath(),i.arc(e.player.x,e.player.y,e.player.r,0,Math.PI*2),i.fill());const y=G-e.chaseTimer;if(!e.chaseActive&&y<=2){const r=x(1-y/2,0,1),a=1+Math.sin(performance.now()/180)*.15;i.strokeStyle=`rgba(255, 96, 132, ${.35+r*.5})`,i.lineWidth=3+r*2,i.beginPath(),i.arc(e.player.x,e.player.y,o*.65*(1+r*.35)*a,0,Math.PI*2),i.stroke()}i.restore(),le()}function le(){T.innerHTML="",T.appendChild(v);const s=document.createElement("div");s.className="hud";const c=G-e.chaseTimer,o=e.chaseActive?"Chasse en cours":c<=2?"Chasse imminente":"Repérage";s.innerHTML=`
    <div class="pill">Niveau ${e.level}</div>
    <div class="pill">Temps ${e.timer.toFixed(1)}s</div>
    <div class="pill">Objets ${e.collected}/${e.items.length}</div>
    <div class="pill">Porte ${e.gate.open?"ouverte":"fermée"}</div>
    <div class="pill">Ennemis ${e.enemies.length}</div>
    <div class="pill">${o}</div>
  `,T.appendChild(s)}
