import{d as B,c as D,e as P,w as W,r as T,f as O}from"./loaders-CNHm-dlv.js";import{c as N,a as _}from"./input-BV31AzWF.js";import{c as q}from"./loop-24SuRqx9.js";import{a as X,l as Y,c as b,d as j}from"./index-niTdxgfr.js";const f="snake",i=B(f),F=D(),n=F.find(t=>t.id===(i==null?void 0:i.themeId))||F[0];X();if(n){const t=document.documentElement.style;t.setProperty("--color-primary",n.colors.primary),t.setProperty("--color-secondary",n.colors.secondary),t.setProperty("--color-accent",n.colors.accent),t.setProperty("--color-text",n.colors.text),t.setProperty("--color-muted",n.colors.muted),document.body.style.background=n.gradient||n.colors.background}const h=document.getElementById("game-canvas"),v=document.getElementById("ui"),s=h.getContext("2d"),C=N(),m=document.createElement("div");m.className="overlay";m.style.display="none";v.appendChild(m);const I=new Image;I.src=new URL("data:image/svg+xml,%3csvg%20width='220'%20height='220'%20viewBox='0%200%20220%20220'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cdefs%3e%3cradialGradient%20id='core'%20cx='0'%20cy='0'%20r='1'%20gradientUnits='userSpaceOnUse'%20gradientTransform='translate(110%20110)%20rotate(90)%20scale(110)'%3e%3cstop%20stop-color='%237CFFE1'%20/%3e%3cstop%20offset='1'%20stop-color='%230A1A2E'%20/%3e%3c/radialGradient%3e%3clinearGradient%20id='rim'%20x1='40'%20y1='50'%20x2='180'%20y2='170'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%237CFFE1'%20stop-opacity='0.9'%20/%3e%3cstop%20offset='1'%20stop-color='%237B8CFF'%20stop-opacity='0.85'%20/%3e%3c/linearGradient%3e%3c/defs%3e%3ccircle%20cx='110'%20cy='110'%20r='98'%20fill='url(%23core)'%20/%3e%3ccircle%20cx='110'%20cy='110'%20r='98'%20stroke='url(%23rim)'%20stroke-width='10'%20/%3e%3ccircle%20cx='110'%20cy='90'%20r='34'%20fill='%23E9FFFA'%20fill-opacity='0.85'%20/%3e%3ccircle%20cx='138'%20cy='80'%20r='18'%20fill='%23E9FFFA'%20fill-opacity='0.65'%20/%3e%3cpath%20d='M110%2022c20%203%2035%2012%2045%2026-18-8-35-10-53-6%204-7%205-14%208-20z'%20fill='%236DF6D4'%20fill-opacity='0.8'%20/%3e%3c/svg%3e",import.meta.url).href;const R=new Image;R.src=new URL("data:image/svg+xml,%3csvg%20width='220'%20height='220'%20viewBox='0%200%20220%20220'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cdefs%3e%3clinearGradient%20id='prism-core'%20x1='30'%20y1='40'%20x2='190'%20y2='180'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%23FF7EE2'%20/%3e%3cstop%20offset='0.45'%20stop-color='%237B8CFF'%20/%3e%3cstop%20offset='1'%20stop-color='%237CFFE1'%20/%3e%3c/linearGradient%3e%3cradialGradient%20id='prism-glow'%20cx='0'%20cy='0'%20r='1'%20gradientUnits='userSpaceOnUse'%20gradientTransform='translate(110%20110)%20rotate(90)%20scale(110)'%3e%3cstop%20stop-color='%23ffffff'%20stop-opacity='0.7'%20/%3e%3cstop%20offset='1'%20stop-color='%23050712'%20/%3e%3c/radialGradient%3e%3c/defs%3e%3ccircle%20cx='110'%20cy='110'%20r='100'%20fill='url(%23prism-glow)'%20/%3e%3cpath%20d='M110%2018%20190%20110%20110%20202%2030%20110%20110%2018z'%20fill='url(%23prism-core)'%20/%3e%3cpath%20d='M110%2018%20190%20110%20110%20202%2030%20110%20110%2018z'%20stroke='%23ffffff'%20stroke-opacity='0.4'%20stroke-width='6'%20/%3e%3ccircle%20cx='110'%20cy='110'%20r='46'%20fill='%230A0F24'%20fill-opacity='0.5'%20/%3e%3ccircle%20cx='110'%20cy='110'%20r='38'%20stroke='%23ffffff'%20stroke-opacity='0.4'%20stroke-width='4'%20/%3e%3ccircle%20cx='110'%20cy='84'%20r='14'%20fill='%23ffffff'%20fill-opacity='0.6'%20/%3e%3c/svg%3e",import.meta.url).href;const M=new Image;M.src=new URL("data:image/svg+xml,%3csvg%20width='340'%20height='340'%20viewBox='0%200%20340%20340'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cdefs%3e%3clinearGradient%20id='glow'%20x1='0'%20y1='0'%20x2='1'%20y2='1'%3e%3cstop%20stop-color='%237CFFE1'%20stop-opacity='0.18'%20/%3e%3cstop%20offset='0.5'%20stop-color='%237B8CFF'%20stop-opacity='0.12'%20/%3e%3cstop%20offset='1'%20stop-color='%23FF7EE2'%20stop-opacity='0.14'%20/%3e%3c/linearGradient%3e%3c/defs%3e%3crect%20width='340'%20height='340'%20fill='%23050712'%20/%3e%3crect%20width='340'%20height='340'%20fill='url(%23glow)'%20/%3e%3cg%20stroke='%23a3b3ff'%20stroke-opacity='0.16'%20stroke-width='1'%3e%3cpath%20d='M20%200v340M40%200v340M60%200v340M80%200v340M100%200v340M120%200v340M140%200v340M160%200v340M180%200v340M200%200v340M220%200v340M240%200v340M260%200v340M280%200v340M300%200v340M320%200v340'%20/%3e%3cpath%20d='M0%2020h340M0%2040h340M0%2060h340M0%2080h340M0%20100h340M0%20120h340M0%20140h340M0%20160h340M0%20180h340M0%20200h340M0%20220h340M0%20240h340M0%20260h340M0%20280h340M0%20300h340M0%20320h340'%20/%3e%3c/g%3e%3crect%20x='1'%20y='1'%20width='338'%20height='338'%20stroke='%237CFFE1'%20stroke-opacity='0.14'%20stroke-width='2'%20/%3e%3c/svg%3e",import.meta.url).href;const g={up:(i==null?void 0:i.input.keys.up)||"ArrowUp",down:(i==null?void 0:i.input.keys.down)||"ArrowDown",left:(i==null?void 0:i.input.keys.left)||"ArrowLeft",right:(i==null?void 0:i.input.keys.right)||"ArrowRight",dash:(i==null?void 0:i.input.keys.dash)||"Space"};_({container:document.body,input:C,mapping:{up:g.up,down:g.down,left:g.left,right:g.right,actionA:g.dash,actionALabel:"Boost"}});var E;const e={running:!1,boardSize:P((i==null?void 0:i.difficultyParams.boardSize)??20,12,32),cellSize:24,viewWidth:window.innerWidth,viewHeight:window.innerHeight,offsetX:0,offsetY:0,snake:[],dir:{x:1,y:0},pendingDir:{x:1,y:0},inputReady:!0,food:null,tickMs:(i==null?void 0:i.difficultyParams.baseTickMs)??140,timer:0,boost:0,score:0,best:((E=Y().games[f])==null?void 0:E.bestScore)??0,streak:0,comboTimer:0,particles:[],flash:0,lengthTarget:(i==null?void 0:i.difficultyParams.targetLength)??42,wallSolid:!!((i==null?void 0:i.difficultyParams.wallIsSolid)??1),dpr:devicePixelRatio||1},$=q({update:t=>Z(t),render:A,fps:60});function k(){e.dpr=devicePixelRatio||1,h.width=window.innerWidth*e.dpr,h.height=window.innerHeight*e.dpr,h.style.width="100%",h.style.height="100%",e.viewWidth=h.width/e.dpr,e.viewHeight=h.height/e.dpr;const t=Math.min(e.viewWidth,e.viewHeight)*.88;e.cellSize=P(Math.floor(t/e.boardSize),18,46);const o=e.cellSize*e.boardSize;e.offsetX=(e.viewWidth-o)/2,e.offsetY=(e.viewHeight-o)/2}k();window.addEventListener("resize",k);function K(){if(!i){z("Config manquante","Ajoute configs/games/snake.config.json",!1);return}k(),e.running=!0,e.dir={x:1,y:0},e.pendingDir={x:1,y:0},e.inputReady=!0;const t=Math.floor(e.boardSize/2);e.snake=[{x:t-2,y:t},{x:t-1,y:t},{x:t,y:t}],e.food=null,e.tickMs=i.difficultyParams.baseTickMs,e.timer=0,e.boost=0,e.score=0,e.streak=0,e.comboTimer=0,e.particles=[],e.flash=.9,L(),m.style.display="none",b({type:"SESSION_START",gameId:f}),$.start()}function x(t){e.running=!1,$.stop();const o=e.score;b({type:t?"SESSION_WIN":"SESSION_FAIL",gameId:f,payload:{score:o}}),j(f,(i==null?void 0:i.saveSchemaVersion)??1,l=>{const y=l.state.bestLength||0;l.state.bestLength=Math.max(y,e.snake.length);const c=l.bestScore||0;o>c&&(l.bestScore=o)}),e.best=Math.max(e.best,o),z(t?"Flow parfait":"Collision détectée",(i==null?void 0:i.uiText.help)||"",!0,o)}function L(){const t=new Set(e.snake.map(l=>`${l.x},${l.y}`));let o={x:0,y:0},a=0;do o={x:Math.floor(T(0,e.boardSize)),y:Math.floor(T(0,e.boardSize))},a+=1;while(t.has(`${o.x},${o.y}`)&&a<400);const r=O((i==null?void 0:i.difficultyParams.prismChance)??.16);e.food={...o,type:r?"prism":"core"}}function S(t){!e.inputReady||t.x===-e.dir.x&&t.y===-e.dir.y||(e.pendingDir=t,e.inputReady=!1)}function V(){if(!i)return;const t=i.input.keys,o=r=>r?C.isDown(r):!1;(o(t.left)||o(t.altLeft))&&S({x:-1,y:0}),(o(t.right)||o(t.altRight))&&S({x:1,y:0}),(o(t.up)||o(t.altUp))&&S({x:0,y:-1}),(o(t.down)||o(t.altDown))&&S({x:0,y:1});const a=t.dash||"Space";o(a)&&e.boost<=.1&&(e.boost=(i.difficultyParams.boostDurationMs??2600)/1e3,e.flash=1)}function J(){e.dir=e.pendingDir;const t=e.snake[e.snake.length-1];let o={x:t.x+e.dir.x,y:t.y+e.dir.y};if(!e.wallSolid)o.x=(o.x+e.boardSize)%e.boardSize,o.y=(o.y+e.boardSize)%e.boardSize;else if(o.x<0||o.y<0||o.x>=e.boardSize||o.y>=e.boardSize){x(!1);return}if(e.snake.some(r=>r.x===o.x&&r.y===o.y)){x(!1);return}e.snake.push(o);let a=!1;e.food&&o.x===e.food.x&&o.y===e.food.y&&(a=!0,Q(e.food)),a||e.snake.shift(),e.inputReady=!0}function Q(t){e.flash=1,e.comboTimer=2.8,e.streak+=1;const o=t.type==="prism"?18:9;e.score+=o+Math.floor(Math.max(0,e.streak-1)*1.5),b({type:t.type==="prism"?"PRISM_FRUIT_EATEN":"FRUIT_EATEN",gameId:f,payload:{score:e.score}}),t.type==="prism"&&(e.boost=Math.max(e.boost,((i==null?void 0:i.difficultyParams.boostDurationMs)??2400)/1e3),b({type:"STREAK_BONUS",gameId:f})),e.tickMs=Math.max(75,e.tickMs*((i==null?void 0:i.difficultyParams.speedRamp)??.99)),L(),e.particles.push({x:t.x,y:t.y,r:e.cellSize*1.2,alpha:.65,decay:.9,color:t.type==="prism"?n.colors.accent:n.colors.primary}),e.snake.length>=e.lengthTarget&&x(!0)}function Z(t){if(!e.running)return;const o=e.boost>0?1.25:1;for(e.timer+=t*1e3*o,e.boost=Math.max(0,e.boost-t),e.flash=Math.max(0,e.flash-t*.8),e.comboTimer=Math.max(0,e.comboTimer-t),e.comboTimer===0&&(e.streak=0),V();e.timer>=e.tickMs;)e.timer-=e.tickMs,J();e.particles=e.particles.map(a=>({...a,alpha:a.alpha-t*a.decay})).filter(a=>a.alpha>.02)}function w(t,o,a,r,l){s.beginPath(),s.moveTo(t+l,o),s.lineTo(t+a-l,o),s.quadraticCurveTo(t+a,o,t+a,o+l),s.lineTo(t+a,o+r-l),s.quadraticCurveTo(t+a,o+r,t+a-l,o+r),s.lineTo(t+l,o+r),s.quadraticCurveTo(t,o+r,t,o+r-l),s.lineTo(t,o+l),s.quadraticCurveTo(t,o,t+l,o),s.closePath()}function A(){s.save(),s.scale(e.dpr,e.dpr),s.clearRect(0,0,e.viewWidth,e.viewHeight);const t=s.createLinearGradient(0,0,e.viewWidth,e.viewHeight);t.addColorStop(0,"rgba(124,255,225,0.08)"),t.addColorStop(.5,"rgba(123,140,255,0.08)"),t.addColorStop(1,"rgba(255,126,226,0.08)"),s.fillStyle=t,s.fillRect(0,0,e.viewWidth,e.viewHeight),M.complete&&(s.globalAlpha=.16,s.drawImage(M,0,0,e.viewWidth,e.viewHeight),s.globalAlpha=1);const o=e.cellSize*e.boardSize,a=e.offsetX,r=e.offsetY,l=s.createLinearGradient(a,r,a,r+o);l.addColorStop(0,"rgba(255,255,255,0.04)"),l.addColorStop(1,"rgba(255,255,255,0.02)"),s.fillStyle=l,w(a,r,o,o,14),s.fill(),s.strokeStyle="rgba(255,255,255,0.08)",s.lineWidth=1.2,s.stroke(),s.strokeStyle="rgba(255,255,255,0.05)",s.lineWidth=.8;for(let c=1;c<e.boardSize;c++){const d=a+c*e.cellSize,p=r+c*e.cellSize;s.beginPath(),s.moveTo(d,r),s.lineTo(d,r+o),s.stroke(),s.beginPath(),s.moveTo(a,p),s.lineTo(a+o,p),s.stroke()}if(e.particles.forEach(c=>{const d=a+c.x*e.cellSize+e.cellSize/2,p=r+c.y*e.cellSize+e.cellSize/2,u=s.createRadialGradient(d,p,2,d,p,c.r);u.addColorStop(0,`${c.color}bf`),u.addColorStop(1,"transparent"),s.globalAlpha=c.alpha,s.fillStyle=u,s.beginPath(),s.arc(d,p,c.r,0,Math.PI*2),s.fill(),s.globalAlpha=1}),e.food){const c=a+e.food.x*e.cellSize,d=r+e.food.y*e.cellSize,p=e.food.type==="prism"?R:I;p.complete?s.drawImage(p,c,d,e.cellSize,e.cellSize):(s.fillStyle=e.food.type==="prism"?n.colors.accent:n.colors.primary,w(c+3,d+3,e.cellSize-6,e.cellSize-6,10),s.fill())}const y=e.snake.length;e.snake.forEach((c,d)=>{const p=a+c.x*e.cellSize+2,u=r+c.y*e.cellSize+2,G=d/Math.max(1,y-1),H=d===y-1?n.colors.primary:n.colors.secondary,U=d===y-1?.95:.55+G*.35;s.fillStyle=`${H}${Math.floor(U*255).toString(16).padStart(2,"0")}`,w(p,u,e.cellSize-4,e.cellSize-4,9),s.fill(),d===y-1&&(s.strokeStyle=n.colors.accent,s.lineWidth=2,s.beginPath(),s.arc(a+c.x*e.cellSize+e.cellSize/2,r+c.y*e.cellSize+e.cellSize/2,e.cellSize*.18+e.flash*4,0,Math.PI*2),s.stroke())}),s.restore(),ee()}function ee(){v.innerHTML="",v.appendChild(m);const t=document.createElement("div");t.className="hud",t.innerHTML=`
    <div class="chip">Score <strong>${e.score}</strong></div>
    <div class="chip">Longueur <strong>${e.snake.length}/${e.lengthTarget}</strong></div>
    <div class="chip ghost">Vitesse <span>${(1e3/e.tickMs).toFixed(1)} t/s</span></div>
    <div class="chip ghost">Record <span>${e.best}</span></div>
  `,v.appendChild(t);const o=document.createElement("div");o.className="hud bottom",o.innerHTML=`
    <div class="pill ${e.boost>0?"glow":""}">Boost ${e.boost>0?"actif":"off"}</div>
    <div class="pill">Flow ${Math.max(1,e.streak)}x</div>
  `,v.appendChild(o)}function z(t,o,a=!0,r){var l;m.style.display="grid",m.innerHTML=`
    <div class="panel">
      <p class="pill">Prism Snake</p>
      <h2>${t}</h2>
      ${r!==void 0?`<p class="muted">Score ${r} · Longueur ${e.snake.length}</p>`:""}
      <p class="muted">${o}</p>
      <div class="panel-actions">
        ${a?'<button class="btn" id="start-btn">Lancer</button>':""}
        <a class="btn ghost" href="${W("/")}">Hub</a>
      </div>
      <div class="inline-metrics">
        <div><span>Record</span><strong>${e.best}</strong></div>
        <div><span>Objectif</span><strong>${e.lengthTarget}</strong></div>
        <div><span>Cadence</span><strong>${(1e3/e.tickMs).toFixed(1)} t/s</strong></div>
      </div>
    </div>
  `,(l=document.getElementById("start-btn"))==null||l.addEventListener("click",K)}z((i==null?void 0:i.uiText.title)||"Prism Snake",(i==null?void 0:i.uiText.help)||"Serpent néon premium.");A();
