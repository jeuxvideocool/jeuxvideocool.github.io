import{l as q,e as K,f as X,w as Z,n as x,s as J,p as Q,m as ee}from"./index-CK9lGSzJ.js";/* empty css                    */import{c as te,a as ae}from"./input-C49DsMBr.js";import{c as ne}from"./loop-24SuRqx9.js";const p="drive",a=q(p),E=K(),h=a&&E.find(t=>t.id===a.themeId)||E[0];X();if(h){const t=document.documentElement.style;t.setProperty("--color-primary",h.colors.primary),t.setProperty("--color-secondary",h.colors.secondary),t.setProperty("--color-accent",h.colors.accent),t.setProperty("--color-text",h.colors.text),t.setProperty("--color-muted",h.colors.muted),document.body.style.background=h.gradient||document.body.style.background}const b=document.getElementById("game-canvas"),I=document.getElementById("ui"),o=b.getContext("2d"),S=te(),u=document.createElement("div");u.className="launch-overlay";u.style.display="none";I.appendChild(u);const d={left:(a==null?void 0:a.input.keys.left)||"ArrowLeft",right:(a==null?void 0:a.input.keys.right)||"ArrowRight",boost:(a==null?void 0:a.input.keys.boost)||"ArrowUp"},se=10,ie=.24,le=.14,P=ae({gameId:p,container:document.body,input:S,touch:{mapping:{left:d.left,right:d.right,up:d.boost,actionA:d.boost,actionALabel:"Boost"},showPad:!0,gestureEnabled:!0},motion:{input:S,axis:{x:{negative:d.left,positive:d.right}},actions:[{code:d.boost,trigger:"tiltForward",mode:"hold",threshold:16}]},hints:{touch:"Tactile : glisse pour changer de voie, bouton Boost.",motion:"Gyro : incline pour changer de voie, penche vers l'avant pour booster."}}),A=new Image;A.src=new URL("data:image/svg+xml,%3csvg%20width='64'%20height='128'%20viewBox='0%200%2064%20128'%20xmlns='http://www.w3.org/2000/svg'%3e%3crect%20width='64'%20height='128'%20rx='10'%20fill='%23ff6b6b'/%3e%3crect%20x='10'%20y='10'%20width='44'%20height='108'%20rx='8'%20fill='%231b233a'/%3e%3crect%20x='14'%20y='16'%20width='36'%20height='30'%20rx='6'%20fill='%230bd0ff'%20opacity='0.8'/%3e%3crect%20x='14'%20y='82'%20width='36'%20height='30'%20rx='6'%20fill='%230bd0ff'%20opacity='0.8'/%3e%3crect%20x='6'%20y='32'%20width='8'%20height='20'%20rx='3'%20fill='%23ffd166'/%3e%3crect%20x='50'%20y='32'%20width='8'%20height='20'%20rx='3'%20fill='%23ffd166'/%3e%3crect%20x='6'%20y='76'%20width='8'%20height='20'%20rx='3'%20fill='%23ffd166'/%3e%3crect%20x='50'%20y='76'%20width='8'%20height='20'%20rx='3'%20fill='%23ffd166'/%3e%3c/svg%3e",import.meta.url).href;const O=new Image;O.src=new URL("data:image/svg+xml,%3csvg%20width='64'%20height='128'%20viewBox='0%200%2064%20128'%20xmlns='http://www.w3.org/2000/svg'%3e%3crect%20width='64'%20height='128'%20rx='10'%20fill='%230bd0ff'/%3e%3crect%20x='10'%20y='10'%20width='44'%20height='108'%20rx='8'%20fill='%23111624'/%3e%3crect%20x='14'%20y='18'%20width='36'%20height='28'%20rx='6'%20fill='%237af0ff'%20opacity='0.6'/%3e%3crect%20x='14'%20y='82'%20width='36'%20height='28'%20rx='6'%20fill='%237af0ff'%20opacity='0.6'/%3e%3crect%20x='6'%20y='36'%20width='8'%20height='18'%20rx='3'%20fill='%2364f4ac'/%3e%3crect%20x='50'%20y='36'%20width='8'%20height='18'%20rx='3'%20fill='%2364f4ac'/%3e%3crect%20x='6'%20y='78'%20width='8'%20height='18'%20rx='3'%20fill='%2364f4ac'/%3e%3crect%20x='50'%20y='78'%20width='8'%20height='18'%20rx='3'%20fill='%2364f4ac'/%3e%3c/svg%3e",import.meta.url).href;const V=new Image;V.src=new URL("data:image/svg+xml,%3csvg%20width='64'%20height='64'%20viewBox='0%200%2064%2064'%20xmlns='http://www.w3.org/2000/svg'%3e%3crect%20x='8'%20y='8'%20width='48'%20height='48'%20rx='12'%20fill='%2364f4ac'%20opacity='0.85'/%3e%3crect%20x='16'%20y='16'%20width='32'%20height='32'%20rx='8'%20fill='%230bd0ff'%20opacity='0.8'/%3e%3cpath%20d='M32%2014%20L36%2032%20L28%2032%20Z'%20fill='%23ffd166'/%3e%3crect%20x='30'%20y='32'%20width='4'%20height='18'%20rx='2'%20fill='%23ffd166'/%3e%3c/svg%3e",import.meta.url).href;const y={bonusInvincibleMs:(a==null?void 0:a.difficultyParams.bonusInvincibleMs)??2200,bonusSlowMs:(a==null?void 0:a.difficultyParams.bonusSlowMs)??2400,slowMultiplier:(a==null?void 0:a.difficultyParams.slowMultiplier)??.65,malusSpeedMs:(a==null?void 0:a.difficultyParams.malusSpeedMs)??2600,speedUpMultiplier:(a==null?void 0:a.difficultyParams.speedUpMultiplier)??1.35,malusInvertMs:(a==null?void 0:a.difficultyParams.malusInvertMs)??2600},G=(a==null?void 0:a.difficultyParams.boostDurationMs)??2600,ce=(a==null?void 0:a.difficultyParams.boostCooldownMs)??4200,j=(a==null?void 0:a.difficultyParams.bonusSpawnMs)??(a==null?void 0:a.difficultyParams.pickupSpawnMs)??1800,H=(a==null?void 0:a.difficultyParams.malusSpawnMs)??3200,N=(a==null?void 0:a.difficultyParams.winDistance)??1e3,w={easy:{label:"Facile",laneCount:3,trafficSpawnMs:1100,trafficSpeed:210,trafficSpeedVariance:35,trafficPerSpawn:1,bonusSpawnMs:2400,malusSpawnMs:3600,winDistance:1400},medium:{label:"Moyen",laneCount:(a==null?void 0:a.difficultyParams.laneCount)??3,trafficSpawnMs:(a==null?void 0:a.difficultyParams.trafficSpawnMs)??950,trafficSpeed:(a==null?void 0:a.difficultyParams.trafficSpeed)??220,trafficSpeedVariance:(a==null?void 0:a.difficultyParams.trafficSpeedVariance)??40,trafficPerSpawn:1,bonusSpawnMs:j,malusSpawnMs:H,winDistance:N},hard:{label:"Difficile",laneCount:3,trafficSpawnMs:620,trafficSpeed:265,trafficSpeedVariance:60,trafficPerSpawn:2,bonusSpawnMs:3200,malusSpawnMs:1700,winDistance:2600},extreme:{label:"Extrême",laneCount:4,trafficSpawnMs:440,trafficSpeed:310,trafficSpeedVariance:75,trafficPerSpawn:3,bonusSpawnMs:1/0,malusSpawnMs:1100,winDistance:3200},endless:{label:"Infini",laneCount:4,trafficSpawnMs:600,trafficSpeed:290,trafficSpeedVariance:60,trafficPerSpawn:2,bonusSpawnMs:2300,malusSpawnMs:2e3,winDistance:1/0}};let v="medium";const oe=["bonus-invincible","bonus-slow"],re=["malus-speed","malus-invert"],e={running:!1,width:0,height:0,roadWidth:0,laneWidth:0,laneCount:(a==null?void 0:a.difficultyParams.laneCount)??3,lanes:[],player:{lane:1,lanePos:1,y:.78,boost:0,cooldown:0},traffic:[],items:[],distance:0,speed:120,trafficTimer:0,bonusTimer:0,malusTimer:0,trafficSpawnMs:(a==null?void 0:a.difficultyParams.trafficSpawnMs)??950,trafficPerSpawn:1,trafficSpeed:(a==null?void 0:a.difficultyParams.trafficSpeed)??220,trafficSpeedVariance:(a==null?void 0:a.difficultyParams.trafficSpeedVariance)??40,bonusSpawnMs:j,malusSpawnMs:H,winDistance:N,effects:{slow:0,speedUp:0,invert:0}},R={left:{held:0,nextRepeat:0,wasDown:!1},right:{held:0,nextRepeat:0,wasDown:!1}};function fe(){e.lanes=Array.from({length:e.laneCount},(t,n)=>n),e.laneWidth=e.roadWidth/e.laneCount}function T(){const t=b.getBoundingClientRect(),n=devicePixelRatio||1;b.width=t.width*n,b.height=t.height*n,e.width=t.width,e.height=t.height,e.roadWidth=Math.min(520,e.width*.65),fe()}T();window.addEventListener("resize",T);const _=ne({update:t=>Ee(t),render:Re,fps:60});function de(t){e.laneCount=t.laneCount,e.trafficSpawnMs=t.trafficSpawnMs,e.trafficPerSpawn=Math.max(1,Math.min(t.trafficPerSpawn,t.laneCount-1)),e.trafficSpeed=t.trafficSpeed,e.trafficSpeedVariance=t.trafficSpeedVariance,e.bonusSpawnMs=t.bonusSpawnMs,e.malusSpawnMs=t.malusSpawnMs,e.winDistance=t.winDistance,T()}function he(){e.player.lane=Math.floor(e.laneCount/2),e.player.lanePos=e.player.lane,e.player.boost=0,e.player.cooldown=0,R.left={held:0,nextRepeat:0,wasDown:!1},R.right={held:0,nextRepeat:0,wasDown:!1},e.distance=0,e.traffic=[],e.items=[],e.speed=e.trafficSpeed,e.trafficTimer=0,e.bonusTimer=0,e.malusTimer=0,e.effects.slow=0,e.effects.speedUp=0,e.effects.invert=0}function ue(){if(!a){k("Config à compléter","Crée configs/games/drive.config.json",!1);return}P.show();const t=w[v]||w.medium;de(t),he(),e.running=!0,u.style.display="none",x({type:"SESSION_START",gameId:p}),_.start()}function F(t){e.running=!1,_.stop(),P.hide(),x({type:t?"SESSION_WIN":"SESSION_FAIL",gameId:p,payload:{score:Math.floor(e.distance)}}),a&&J(p,a.saveSchemaVersion,s=>{const l=s.state.bestDistance||0;e.distance>l&&(s.state.bestDistance=Math.floor(e.distance),s.bestScore=Math.floor(e.distance))}),k(t?"Tu traces !":"Crash !",(a==null?void 0:a.uiText.help)||"")}function C(t){return t[Math.floor(Math.random()*t.length)]}function pe(t,n){const s=[...t],l=[];for(let i=0;i<n&&s.length>0;i++){const c=Math.floor(Math.random()*s.length);l.push(s.splice(c,1)[0])}return l}function me(){const t=e.laneWidth*.9;return Math.max(.18,t/e.height*1.2)}function we(){const t=e.laneWidth*.5;return Math.max(.2,t/e.height*1.2)}function z(t){const n=me();return!e.traffic.some(s=>s.lane===t&&s.y<n)}function ye(t){const n=we(),s=e.traffic.some(i=>i.lane===t&&i.y<n),l=e.items.some(i=>i.lane===t&&i.y<n);return!s&&!l}function be(){const t=e.lanes.filter(n=>z(n));return t.length?C(t):C(e.lanes)}function ve(){const t=e.lanes.filter(i=>ye(i));if(!t.length)return null;const n=t.map(i=>({lane:i,count:e.traffic.filter(c=>c.lane===i).length})),s=n.reduce((i,c)=>Math.min(i,c.count),1/0),l=n.filter(i=>i.count===s).map(i=>i.lane);return C(l.length?l:t)}function Me(t){const n=e.trafficSpeed+ee(-e.trafficSpeedVariance,e.trafficSpeedVariance);e.traffic.push({lane:t,y:-.3,speed:n})}function Se(){if(!e.lanes.length)return;const t=be(),n=e.lanes.filter(i=>i!==t&&z(i));if(n.length===0)return;const s=Math.min(e.trafficPerSpawn,n.length);pe(n,s).forEach(Me)}function xe(t){if(!e.lanes.length)return;const n=ve();n!==null&&e.items.push({lane:n,y:-.3,kind:t})}function B(t){t.length&&xe(C(t))}function ge(t){switch(x({type:"ITEM_COLLECTED",gameId:p}),t.kind){case"bonus-invincible":e.player.boost=Math.max(e.player.boost,y.bonusInvincibleMs);break;case"bonus-slow":e.effects.slow=Math.max(e.effects.slow,y.bonusSlowMs);break;case"malus-speed":e.effects.speedUp=Math.max(e.effects.speedUp,y.malusSpeedMs);break;case"malus-invert":e.effects.invert=Math.max(e.effects.invert,y.malusInvertMs);break}}function De(t){const n=t*1e3;e.effects.slow=Math.max(0,e.effects.slow-n),e.effects.speedUp=Math.max(0,e.effects.speedUp-n),e.effects.invert=Math.max(0,e.effects.invert-n)}function Ie(){let t=1;return e.effects.slow>0&&(t*=y.slowMultiplier),e.effects.speedUp>0&&(t*=y.speedUpMultiplier),t}function U(t){e.player.lane=Q(e.player.lane+t,0,e.laneCount-1)}function Pe(t){const n=e.player.lane-e.player.lanePos;if(Math.abs(n)<.001){e.player.lanePos=e.player.lane;return}e.player.lanePos+=n*Math.min(1,t*se)}function Ce(t){if(e.player.cooldown=Math.max(0,e.player.cooldown-t*1e3),e.player.boost=Math.max(0,e.player.boost-t*1e3),e.player.boost>0)return;S.isDown(d.boost)&&e.player.cooldown<=0&&(e.player.boost=G,e.player.cooldown=ce,x({type:"BOOST_USED",gameId:p}))}function Te(t){const n=e.effects.invert>0,s=S.isDown(d.left),l=S.isDown(d.right),i=n?l:s,c=n?s:l,r=(m,M,L)=>{const f=R[m];if(!M){f.held=0,f.nextRepeat=0,f.wasDown=!1;return}if(f.held+=t,!f.wasDown){U(L),f.wasDown=!0,f.nextRepeat=ie;return}f.nextRepeat>0&&f.held>=f.nextRepeat&&(U(L),f.nextRepeat+=le)};r("left",i,-1),r("right",c,1)}function Le(t,n){e.traffic=e.traffic.map(s=>({...s,y:s.y+s.speed*n/e.height*t})).filter(s=>s.y<1.4),e.items=e.items.map(s=>({...s,y:s.y+e.speed*n/e.height*t})).filter(s=>s.y<1.4)}function $e(){const t=e.height*e.player.y,n=e.laneWidth*.35;for(const l of e.traffic){if(Math.abs(l.lane-e.player.lanePos)>.45)continue;const i=l.y*e.height;if(Math.abs(i-t)<n*1.1)if(e.player.boost>0)x({type:"OBSTACLE_DODGED",gameId:p}),e.traffic=e.traffic.filter(c=>c!==l);else{F(!1);return}}const s=[];for(const l of e.items){if(Math.abs(l.lane-e.player.lanePos)>.45){s.push(l);continue}const i=l.y*e.height;if(Math.abs(i-t)<n){ge(l);continue}s.push(l)}e.items=s}function Ee(t){if(!e.running||!a)return;const n=Ie();if(e.distance+=e.speed/10*t*n,e.speed+=t*2,e.winDistance!==1/0&&e.distance>=e.winDistance){F(!0);return}e.trafficTimer+=t*1e3,e.bonusTimer+=t*1e3,e.malusTimer+=t*1e3,Te(t),Ce(t),Pe(t),Le(t,n),De(t),e.trafficTimer>=e.trafficSpawnMs&&(e.trafficTimer=0,Se()),e.bonusSpawnMs!==1/0&&e.bonusTimer>=e.bonusSpawnMs&&(e.bonusTimer=0,B(oe)),e.malusSpawnMs!==1/0&&e.malusTimer>=e.malusSpawnMs&&(e.malusTimer=0,B(re)),$e()}function Re(){const t=Math.round(b.clientWidth),n=Math.round(b.clientHeight);(t!==Math.round(e.width)||n!==Math.round(e.height))&&T(),o.save(),o.scale(devicePixelRatio,devicePixelRatio),o.clearRect(0,0,e.width,e.height);const s=e.width/2-e.roadWidth/2;o.fillStyle="rgba(255,255,255,0.04)",o.fillRect(s,0,e.roadWidth,e.height),o.strokeStyle="rgba(255,255,255,0.1)";for(let c=1;c<e.laneCount;c++){const r=s+c*e.laneWidth;o.setLineDash([12,12]),o.beginPath(),o.moveTo(r,0),o.lineTo(r,e.height),o.stroke()}o.setLineDash([]);const l=s+e.player.lanePos*e.laneWidth+e.laneWidth/2-e.laneWidth*.25,i=e.height*e.player.y-e.laneWidth*.5;W(A,l,i,e.laneWidth*.5,e.laneWidth*.9),e.traffic.forEach(c=>{const r=s+c.lane*e.laneWidth+e.laneWidth/2-e.laneWidth*.25,m=c.y*e.height-e.laneWidth*.5;W(O,r,m,e.laneWidth*.5,e.laneWidth*.9)}),e.items.forEach(c=>{We(c,s)}),o.restore(),ke()}function W(t,n,s,l,i){t.complete?o.drawImage(t,n,s,l,i):(o.fillStyle=h.colors.primary,o.fillRect(n,s,l,i))}function We(t,n){const s=e.laneWidth*.5,l=n+t.lane*e.laneWidth+e.laneWidth/2-s/2,i=t.y*e.height-s/2,c=t.kind==="bonus-invincible"?"rgba(100, 244, 172, 0.35)":t.kind==="bonus-slow"?"rgba(125, 211, 252, 0.35)":t.kind==="malus-speed"?"rgba(249, 115, 22, 0.35)":"rgba(244, 63, 94, 0.35)";o.fillStyle=c,o.beginPath(),o.ellipse(l+s/2,i+s/2,s*.55,s*.55,0,0,Math.PI*2),o.fill(),W(V,l,i,s,s)}function ke(){I.innerHTML="",I.appendChild(u);const t=document.createElement("div");t.className="hud";const n=Math.max(0,Math.floor(e.player.boost/100)/10),s=Math.max(0,Math.floor(e.player.cooldown/100)/10),l=Math.max(0,Math.floor(e.effects.slow/100)/10),i=Math.max(0,Math.floor(e.effects.speedUp/100)/10),c=Math.max(0,Math.floor(e.effects.invert/100)/10),r=[];e.player.boost>0&&r.push(`Invuln ${n}s`),e.effects.slow>0&&r.push(`Ralenti ${l}s`),e.effects.speedUp>0&&r.push(`Turbo ${i}s`),e.effects.invert>0&&r.push(`Inversion ${c}s`);const m=r.length?r.join(" · "):"Aucun",M=e.winDistance===1/0?`${Math.floor(e.distance)} m`:`${Math.floor(e.distance)} / ${Math.floor(e.winDistance)} m`;t.innerHTML=`
    <div class="pill">Distance ${M}</div>
    <div class="pill">Boost ${n?n+"s":"prêt"} · CD ${s?s+"s":"0s"}</div>
    <div class="pill">Effets ${m}</div>
    <div class="pill">Trafic ${e.traffic.length}</div>
  `,I.appendChild(t)}function k(t,n,s=!0){P.hide(),u.style.display="grid";const l=(a==null?void 0:a.uiText.shortDescription)||"",i=n||(a==null?void 0:a.uiText.help)||"",c=((a==null?void 0:a.uiText.controls)||[]).map(g=>`<span class="launch-chip">${g}</span>`).join(""),r=w[v]||w.medium,m=Math.round(G/1e3),M=r.winDistance===1/0?"Infini":`${r.winDistance} m`,f=`
    <div class="launch-rows">
      <div class="launch-row">
        <span class="launch-row-label">Niveau</span>
        <div class="launch-row-value launch-options">
          ${Object.entries(w).map(([g,D])=>{const Y=D.winDistance===1/0?"∞":`${D.winDistance} m`;return`
        <button class="launch-option diff-btn ${g===v?"is-active":""}" data-diff="${g}">
          <span class="launch-option-title">${D.label}</span>
          <span class="launch-option-meta">${D.laneCount} voies · ${Y}</span>
        </button>
      `}).join("")}
        </div>
      </div>
      <div class="launch-row">
        <span class="launch-row-label">Objectif</span>
        <div class="launch-row-value">
          <span class="launch-chip" id="drive-objective">${M}</span>
        </div>
      </div>
      <div class="launch-row">
        <span class="launch-row-label">Voies</span>
        <div class="launch-row-value">
          <span class="launch-chip" id="drive-lanes">${r.laneCount}</span>
        </div>
      </div>
      <div class="launch-row">
        <span class="launch-row-label">Boost</span>
        <div class="launch-row-value">
          <span class="launch-chip">${m}s</span>
        </div>
      </div>
    </div>
  `;u.innerHTML=`
    <div class="launch-card">
      <div class="launch-head">
        <div class="launch-brand">
          <span class="launch-badge">Arcade Galaxy</span>
          <span class="launch-badge ghost">${(a==null?void 0:a.uiText.title)||"Neon Drive"}</span>
        </div>
        <h2 class="launch-title">${t}</h2>
        ${l?`<p class="launch-subtitle">${l}</p>`:""}
      </div>
      <div class="launch-grid">
        <section class="launch-section">
          <h3 class="launch-section-title">Briefing</h3>
          <p class="launch-text">${i}</p>
        </section>
        <section class="launch-section">
          <h3 class="launch-section-title">Paramètres</h3>
          ${f}
        </section>
        <section class="launch-section">
          <h3 class="launch-section-title">Contrôles</h3>
          <div class="launch-chips">
            ${c||'<span class="launch-chip muted">Contrôles à définir</span>'}
          </div>
        </section>
      </div>
      <div class="launch-actions">
        ${s?'<button class="launch-btn primary" id="launch-start">Lancer</button>':""}
        <a class="launch-btn ghost" href="${Z("/")}">Hub</a>
      </div>
    </div>
  `,P.attachOverlay(u);const $=document.getElementById("launch-start");$==null||$.addEventListener("click",ue),Be()}function Be(){const t=document.getElementById("drive-objective"),n=document.getElementById("drive-lanes");document.querySelectorAll(".diff-btn").forEach(s=>{s.addEventListener("click",()=>{const l=s.dataset.diff;if(!l||!w[l])return;v=l,document.querySelectorAll(".diff-btn").forEach(c=>{c.classList.toggle("is-active",c.dataset.diff===v)});const i=w[v];t&&(t.textContent=i.winDistance===1/0?"Infini":`${i.winDistance} m`),n&&(n.textContent=`${i.laneCount}`)})})}k((a==null?void 0:a.uiText.title)||"Neon Drive",(a==null?void 0:a.uiText.help)||"Évite les voitures et ramasse les boosts.");
