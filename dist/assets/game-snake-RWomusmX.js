import{l as _,e as q,f as j,t as X,p as L,w as Y,v as z,m as A,q as K,s as V}from"./index-CK9lGSzJ.js";/* empty css                    */import{c as J,a as Q}from"./input-C49DsMBr.js";import{c as Z}from"./loop-24SuRqx9.js";const b="snake",t=_(b),G=q(),p=G.find(s=>s.id===(t==null?void 0:t.themeId))||G[0];j();if(p){const s=document.documentElement.style;s.setProperty("--color-primary",p.colors.primary),s.setProperty("--color-secondary",p.colors.secondary),s.setProperty("--color-accent",p.colors.accent),s.setProperty("--color-text",p.colors.text),s.setProperty("--color-muted",p.colors.muted),document.body.style.background=p.gradient||p.colors.background}const m=document.getElementById("game-canvas"),w=document.getElementById("ui"),i=m.getContext("2d"),R=J(),g=document.createElement("div");g.className="launch-overlay";g.style.display="none";w.appendChild(g);const D=new Image;D.src=new URL("data:image/svg+xml,%3csvg%20width='220'%20height='220'%20viewBox='0%200%20220%20220'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cdefs%3e%3cradialGradient%20id='core'%20cx='0'%20cy='0'%20r='1'%20gradientUnits='userSpaceOnUse'%20gradientTransform='translate(110%20110)%20rotate(90)%20scale(110)'%3e%3cstop%20stop-color='%237CFFE1'%20/%3e%3cstop%20offset='1'%20stop-color='%230A1A2E'%20/%3e%3c/radialGradient%3e%3clinearGradient%20id='rim'%20x1='40'%20y1='50'%20x2='180'%20y2='170'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%237CFFE1'%20stop-opacity='0.9'%20/%3e%3cstop%20offset='1'%20stop-color='%237B8CFF'%20stop-opacity='0.85'%20/%3e%3c/linearGradient%3e%3c/defs%3e%3ccircle%20cx='110'%20cy='110'%20r='98'%20fill='url(%23core)'%20/%3e%3ccircle%20cx='110'%20cy='110'%20r='98'%20stroke='url(%23rim)'%20stroke-width='10'%20/%3e%3ccircle%20cx='110'%20cy='90'%20r='34'%20fill='%23E9FFFA'%20fill-opacity='0.85'%20/%3e%3ccircle%20cx='138'%20cy='80'%20r='18'%20fill='%23E9FFFA'%20fill-opacity='0.65'%20/%3e%3cpath%20d='M110%2022c20%203%2035%2012%2045%2026-18-8-35-10-53-6%204-7%205-14%208-20z'%20fill='%236DF6D4'%20fill-opacity='0.8'%20/%3e%3c/svg%3e",import.meta.url).href;const H=new Image;H.src=new URL("data:image/svg+xml,%3csvg%20width='220'%20height='220'%20viewBox='0%200%20220%20220'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cdefs%3e%3clinearGradient%20id='prism-core'%20x1='30'%20y1='40'%20x2='190'%20y2='180'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%23FF7EE2'%20/%3e%3cstop%20offset='0.45'%20stop-color='%237B8CFF'%20/%3e%3cstop%20offset='1'%20stop-color='%237CFFE1'%20/%3e%3c/linearGradient%3e%3cradialGradient%20id='prism-glow'%20cx='0'%20cy='0'%20r='1'%20gradientUnits='userSpaceOnUse'%20gradientTransform='translate(110%20110)%20rotate(90)%20scale(110)'%3e%3cstop%20stop-color='%23ffffff'%20stop-opacity='0.7'%20/%3e%3cstop%20offset='1'%20stop-color='%23050712'%20/%3e%3c/radialGradient%3e%3c/defs%3e%3ccircle%20cx='110'%20cy='110'%20r='100'%20fill='url(%23prism-glow)'%20/%3e%3cpath%20d='M110%2018%20190%20110%20110%20202%2030%20110%20110%2018z'%20fill='url(%23prism-core)'%20/%3e%3cpath%20d='M110%2018%20190%20110%20110%20202%2030%20110%20110%2018z'%20stroke='%23ffffff'%20stroke-opacity='0.4'%20stroke-width='6'%20/%3e%3ccircle%20cx='110'%20cy='110'%20r='46'%20fill='%230A0F24'%20fill-opacity='0.5'%20/%3e%3ccircle%20cx='110'%20cy='110'%20r='38'%20stroke='%23ffffff'%20stroke-opacity='0.4'%20stroke-width='4'%20/%3e%3ccircle%20cx='110'%20cy='84'%20r='14'%20fill='%23ffffff'%20fill-opacity='0.6'%20/%3e%3c/svg%3e",import.meta.url).href;const $=new Image;$.src=new URL("data:image/svg+xml,%3csvg%20width='340'%20height='340'%20viewBox='0%200%20340%20340'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cdefs%3e%3clinearGradient%20id='glow'%20x1='0'%20y1='0'%20x2='1'%20y2='1'%3e%3cstop%20stop-color='%237CFFE1'%20stop-opacity='0.18'%20/%3e%3cstop%20offset='0.5'%20stop-color='%237B8CFF'%20stop-opacity='0.12'%20/%3e%3cstop%20offset='1'%20stop-color='%23FF7EE2'%20stop-opacity='0.14'%20/%3e%3c/linearGradient%3e%3c/defs%3e%3crect%20width='340'%20height='340'%20fill='%23050712'%20/%3e%3crect%20width='340'%20height='340'%20fill='url(%23glow)'%20/%3e%3cg%20stroke='%23a3b3ff'%20stroke-opacity='0.16'%20stroke-width='1'%3e%3cpath%20d='M20%200v340M40%200v340M60%200v340M80%200v340M100%200v340M120%200v340M140%200v340M160%200v340M180%200v340M200%200v340M220%200v340M240%200v340M260%200v340M280%200v340M300%200v340M320%200v340'%20/%3e%3cpath%20d='M0%2020h340M0%2040h340M0%2060h340M0%2080h340M0%20100h340M0%20120h340M0%20140h340M0%20160h340M0%20180h340M0%20200h340M0%20220h340M0%20240h340M0%20260h340M0%20280h340M0%20300h340M0%20320h340'%20/%3e%3c/g%3e%3crect%20x='1'%20y='1'%20width='338'%20height='338'%20stroke='%237CFFE1'%20stroke-opacity='0.14'%20stroke-width='2'%20/%3e%3c/svg%3e",import.meta.url).href;const u={up:(t==null?void 0:t.input.keys.up)||"ArrowUp",down:(t==null?void 0:t.input.keys.down)||"ArrowDown",left:(t==null?void 0:t.input.keys.left)||"ArrowLeft",right:(t==null?void 0:t.input.keys.right)||"ArrowRight",dash:(t==null?void 0:t.input.keys.dash)||"Space"},C=Q({gameId:b,container:document.body,input:R,touch:{mapping:{up:u.up,down:u.down,left:u.left,right:u.right,actionA:u.dash,actionALabel:"Boost"},showPad:!1,gestureEnabled:!0},motion:{input:R,axis:{x:{negative:u.left,positive:u.right},y:{negative:u.up,positive:u.down}},actions:[{code:u.dash,trigger:"shake"}]},hints:{touch:"Tactile : glisse pour diriger, bouton Boost.",motion:"Gyro : incline pour diriger, secoue pour booster."}}),x={easy:{label:"Facile",boardSize:20,tickMs:170,speedRamp:.992,prismChance:.22,lengthTarget:36,boostSeconds:3.4,wallSolid:!0},medium:{label:"Moyen",boardSize:(t==null?void 0:t.difficultyParams.boardSize)??21,tickMs:(t==null?void 0:t.difficultyParams.baseTickMs)??140,speedRamp:(t==null?void 0:t.difficultyParams.speedRamp)??.985,prismChance:(t==null?void 0:t.difficultyParams.prismChance)??.18,lengthTarget:(t==null?void 0:t.difficultyParams.targetLength)??46,boostSeconds:((t==null?void 0:t.difficultyParams.boostDurationMs)??3200)/1e3,wallSolid:!!((t==null?void 0:t.difficultyParams.wallIsSolid)??1)},hard:{label:"Difficile",boardSize:19,tickMs:120,speedRamp:.982,prismChance:.14,lengthTarget:52,boostSeconds:2.6,wallSolid:!0},extreme:{label:"Extrême",boardSize:18,tickMs:105,speedRamp:.978,prismChance:.1,lengthTarget:60,boostSeconds:2.4,wallSolid:!0}};let T="medium";var B;const e={running:!1,boardSize:L((t==null?void 0:t.difficultyParams.boardSize)??20,12,32),cellSize:24,viewWidth:window.innerWidth,viewHeight:window.innerHeight,offsetX:0,offsetY:0,snake:[],dir:{x:1,y:0},pendingDir:{x:1,y:0},inputReady:!0,food:null,tickMs:(t==null?void 0:t.difficultyParams.baseTickMs)??140,timer:0,boost:0,score:0,best:((B=X().games[b])==null?void 0:B.bestScore)??0,streak:0,comboTimer:0,particles:[],flash:0,lengthTarget:(t==null?void 0:t.difficultyParams.targetLength)??42,wallSolid:!!((t==null?void 0:t.difficultyParams.wallIsSolid)??1),speedRamp:(t==null?void 0:t.difficultyParams.speedRamp)??.99,prismChance:(t==null?void 0:t.difficultyParams.prismChance)??.16,boostSeconds:((t==null?void 0:t.difficultyParams.boostDurationMs)??2600)/1e3,dpr:devicePixelRatio||1},U=Z({update:s=>ie(s),render:W,fps:60});function E(){e.dpr=devicePixelRatio||1;const s=m.getBoundingClientRect();m.width=s.width*e.dpr,m.height=s.height*e.dpr,m.style.width="100%",m.style.height="100%",e.viewWidth=s.width,e.viewHeight=s.height;const a=Math.min(e.viewWidth,e.viewHeight)*.88;e.cellSize=L(Math.floor(a/e.boardSize),18,46);const o=e.cellSize*e.boardSize;e.offsetX=(e.viewWidth-o)/2,e.offsetY=(e.viewHeight-o)/2}E();window.addEventListener("resize",E);function ee(){if(!t){P("Config manquante","Ajoute configs/games/snake.config.json",!1);return}C.show();const s=x[T]||x.medium;e.boardSize=L(s.boardSize,12,32),E(),e.running=!0,e.dir={x:1,y:0},e.pendingDir={x:1,y:0},e.inputReady=!0;const a=Math.floor(e.boardSize/2);e.snake=[{x:a-2,y:a},{x:a-1,y:a},{x:a,y:a}],e.score=e.snake.length,e.food=null,e.tickMs=s.tickMs,e.timer=0,e.boost=0,e.streak=0,e.comboTimer=0,e.particles=[],e.flash=.9,e.lengthTarget=s.lengthTarget,e.wallSolid=s.wallSolid,e.speedRamp=s.speedRamp,e.prismChance=s.prismChance,e.boostSeconds=s.boostSeconds,O(),g.style.display="none",m.style.pointerEvents="auto",w.style.pointerEvents="none",z({type:"SESSION_START",gameId:b}),U.start()}function I(s){e.running=!1,U.stop(),C.hide();const a=e.score;z({type:s?"SESSION_WIN":"SESSION_FAIL",gameId:b,payload:{score:a}}),V(b,(t==null?void 0:t.saveSchemaVersion)??1,l=>{const d=l.state.bestLength||0;l.state.bestLength=Math.max(d,e.snake.length);const S=l.bestScore||0;a>S&&(l.bestScore=a)}),e.best=Math.max(e.best,a),P(s?"Flow parfait":"Collision détectée",(t==null?void 0:t.uiText.help)||"",!0,a)}function O(){const s=new Set(e.snake.map(l=>`${l.x},${l.y}`));let a={x:0,y:0},o=0;do a={x:Math.floor(A(0,e.boardSize)),y:Math.floor(A(0,e.boardSize))},o+=1;while(s.has(`${a.x},${a.y}`)&&o<400);const r=K(e.prismChance);e.food={...a,type:r?"prism":"core"}}function k(s){!e.inputReady||s.x===-e.dir.x&&s.y===-e.dir.y||(e.pendingDir=s,e.inputReady=!1)}function te(){if(!t)return;const s=t.input.keys,a=r=>r?R.isDown(r):!1;(a(s.left)||a(s.altLeft))&&k({x:-1,y:0}),(a(s.right)||a(s.altRight))&&k({x:1,y:0}),(a(s.up)||a(s.altUp))&&k({x:0,y:-1}),(a(s.down)||a(s.altDown))&&k({x:0,y:1});const o=s.dash||"Space";a(o)&&e.boost<=.1&&(e.boost=e.boostSeconds,e.flash=1)}function se(){e.dir=e.pendingDir;const s=e.snake[e.snake.length-1];let a={x:s.x+e.dir.x,y:s.y+e.dir.y};if(!e.wallSolid)a.x=(a.x+e.boardSize)%e.boardSize,a.y=(a.y+e.boardSize)%e.boardSize;else if(a.x<0||a.y<0||a.x>=e.boardSize||a.y>=e.boardSize){I(!1);return}if(e.snake.some(r=>r.x===a.x&&r.y===a.y)){I(!1);return}e.snake.push(a);let o=!1;e.food&&a.x===e.food.x&&a.y===e.food.y&&(o=!0,ae(e.food)),o||e.snake.shift(),e.inputReady=!0}function ae(s){e.flash=1,e.comboTimer=2.8,e.streak+=1,e.score=e.snake.length,z({type:s.type==="prism"?"PRISM_FRUIT_EATEN":"FRUIT_EATEN",gameId:b,payload:{score:e.score}}),s.type==="prism"&&(e.boost=Math.max(e.boost,e.boostSeconds),z({type:"STREAK_BONUS",gameId:b})),e.tickMs=Math.max(75,e.tickMs*e.speedRamp),O(),e.particles.push({x:s.x,y:s.y,r:e.cellSize*1.2,alpha:.65,decay:.9,color:s.type==="prism"?p.colors.accent:p.colors.primary}),e.snake.length>=e.lengthTarget&&I(!0)}function ie(s){if(!e.running)return;const a=e.boost>0?1.25:1;for(e.timer+=s*1e3*a,e.boost=Math.max(0,e.boost-s),e.flash=Math.max(0,e.flash-s*.8),e.comboTimer=Math.max(0,e.comboTimer-s),e.comboTimer===0&&(e.streak=0),te();e.timer>=e.tickMs;)e.timer-=e.tickMs,se();e.particles=e.particles.map(o=>({...o,alpha:o.alpha-s*o.decay})).filter(o=>o.alpha>.02)}function F(s,a,o,r,l){i.beginPath(),i.moveTo(s+l,a),i.lineTo(s+o-l,a),i.quadraticCurveTo(s+o,a,s+o,a+l),i.lineTo(s+o,a+r-l),i.quadraticCurveTo(s+o,a+r,s+o-l,a+r),i.lineTo(s+l,a+r),i.quadraticCurveTo(s,a+r,s,a+r-l),i.lineTo(s,a+l),i.quadraticCurveTo(s,a,s+l,a),i.closePath()}function W(){const s=Math.round(m.clientWidth),a=Math.round(m.clientHeight);(s!==Math.round(e.viewWidth)||a!==Math.round(e.viewHeight))&&E(),i.save(),i.scale(e.dpr,e.dpr),i.clearRect(0,0,e.viewWidth,e.viewHeight);const o=i.createLinearGradient(0,0,e.viewWidth,e.viewHeight);o.addColorStop(0,"rgba(124,255,225,0.08)"),o.addColorStop(.5,"rgba(123,140,255,0.08)"),o.addColorStop(1,"rgba(255,126,226,0.08)"),i.fillStyle=o,i.fillRect(0,0,e.viewWidth,e.viewHeight),$.complete&&(i.globalAlpha=.16,i.drawImage($,0,0,e.viewWidth,e.viewHeight),i.globalAlpha=1);const r=e.cellSize*e.boardSize,l=e.offsetX,d=e.offsetY,S=i.createLinearGradient(l,d,l,d+r);S.addColorStop(0,"rgba(255,255,255,0.04)"),S.addColorStop(1,"rgba(255,255,255,0.02)"),i.fillStyle=S,F(l,d,r,r,14),i.fill(),i.strokeStyle="rgba(255,255,255,0.08)",i.lineWidth=1.2,i.stroke(),i.strokeStyle="rgba(255,255,255,0.05)",i.lineWidth=.8;for(let c=1;c<e.boardSize;c++){const n=l+c*e.cellSize,h=d+c*e.cellSize;i.beginPath(),i.moveTo(n,d),i.lineTo(n,d+r),i.stroke(),i.beginPath(),i.moveTo(l,h),i.lineTo(l+r,h),i.stroke()}if(e.particles.forEach(c=>{const n=l+c.x*e.cellSize+e.cellSize/2,h=d+c.y*e.cellSize+e.cellSize/2,y=i.createRadialGradient(n,h,2,n,h,c.r);y.addColorStop(0,`${c.color}bf`),y.addColorStop(1,"transparent"),i.globalAlpha=c.alpha,i.fillStyle=y,i.beginPath(),i.arc(n,h,c.r,0,Math.PI*2),i.fill(),i.globalAlpha=1}),e.food){const c=l+e.food.x*e.cellSize,n=d+e.food.y*e.cellSize,h=e.food.type==="prism"?H:D;h.complete?i.drawImage(h,c,n,e.cellSize,e.cellSize):(i.fillStyle=e.food.type==="prism"?p.colors.accent:p.colors.primary,F(c+3,n+3,e.cellSize-6,e.cellSize-6,10),i.fill())}const M=e.snake.length;e.snake.forEach((c,n)=>{const h=l+c.x*e.cellSize+2,y=d+c.y*e.cellSize+2,f=n/Math.max(1,M-1),v=n===M-1?p.colors.primary:p.colors.secondary,N=n===M-1?.95:.55+f*.35;i.fillStyle=`${v}${Math.floor(N*255).toString(16).padStart(2,"0")}`,F(h,y,e.cellSize-4,e.cellSize-4,9),i.fill(),n===M-1&&(i.strokeStyle=p.colors.accent,i.lineWidth=2,i.beginPath(),i.arc(l+c.x*e.cellSize+e.cellSize/2,d+c.y*e.cellSize+e.cellSize/2,e.cellSize*.18+e.flash*4,0,Math.PI*2),i.stroke())}),i.restore(),oe()}function oe(){w.innerHTML="",w.appendChild(g);const s=document.createElement("div");s.className="hud",s.innerHTML=`
    <div class="chip">Score <strong>${e.score}/${e.lengthTarget}</strong></div>
    <div class="chip ghost">Vitesse <span>${(1e3/e.tickMs).toFixed(1)} t/s</span></div>
    <div class="chip ghost">Record <span>${e.best}</span></div>
  `,w.appendChild(s);const a=document.createElement("div");a.className="hud bottom",a.innerHTML=`
    <div class="pill ${e.boost>0?"glow":""}">Boost ${e.boost>0?"actif":"off"}</div>
    <div class="pill">Flow ${Math.max(1,e.streak)}x</div>
  `,w.appendChild(a)}function P(s,a,o=!0,r){var y;C.hide();const l=x[T]||x.medium;g.style.display="grid",w.style.pointerEvents="auto",m.style.pointerEvents="none";const d=(t==null?void 0:t.uiText.shortDescription)||"",S=a||(t==null?void 0:t.uiText.help)||"",M=((t==null?void 0:t.uiText.controls)||[]).map(f=>`<span class="launch-chip">${f}</span>`).join(""),n=`
    <div class="launch-rows">
      <div class="launch-row">
        <span class="launch-row-label">Difficulté</span>
        <div class="launch-row-value launch-options">
          ${Object.entries(x).map(([f,v])=>`
        <button class="launch-option diff-btn ${f===T?"is-active":""}" data-diff="${f}">
          <span class="launch-option-title">${v.label}</span>
          <span class="launch-option-meta">${v.lengthTarget} segments</span>
        </button>
      `).join("")}
        </div>
      </div>
      <div class="launch-row">
        <span class="launch-row-label">Mode</span>
        <div class="launch-row-value">
          <span class="launch-chip">Standard</span>
        </div>
      </div>
    </div>
  `,h=`
    <div class="launch-metrics">
      <div class="launch-metric"><span>Record</span><strong>${e.best}</strong></div>
      <div class="launch-metric"><span>Objectif</span><strong>${l.lengthTarget}</strong></div>
      <div class="launch-metric"><span>Cadence</span><strong>${(1e3/l.tickMs).toFixed(1)} t/s</strong></div>
    </div>
  `;g.innerHTML=`
    <div class="launch-card">
      <div class="launch-head">
        <div class="launch-brand">
          <span class="launch-badge">Arcade Galaxy</span>
          <span class="launch-badge ghost">${(t==null?void 0:t.uiText.title)||"Prism Snake"}</span>
        </div>
        <h2 class="launch-title">${s}</h2>
        ${d?`<p class="launch-subtitle">${d}</p>`:""}
      </div>
      <div class="launch-grid">
        <section class="launch-section">
          <h3 class="launch-section-title">Briefing</h3>
          <p class="launch-text">${S}</p>
          ${r!==void 0?`<p class="launch-note">Dernier score : ${r}/${e.lengthTarget}</p>`:""}
        </section>
        <section class="launch-section">
          <h3 class="launch-section-title">Paramètres</h3>
          ${n}
        </section>
        <section class="launch-section">
          <h3 class="launch-section-title">Contrôles</h3>
          <div class="launch-chips">
            ${M||'<span class="launch-chip muted">Contrôles à définir</span>'}
          </div>
        </section>
        <section class="launch-section">
          <h3 class="launch-section-title">Repères</h3>
          ${h}
        </section>
      </div>
      <div class="launch-actions">
        ${o?'<button class="launch-btn primary" id="launch-start">Lancer</button>':""}
        <a class="launch-btn ghost" href="${Y("/")}">Hub</a>
      </div>
    </div>
  `,C.attachOverlay(g),(y=document.getElementById("launch-start"))==null||y.addEventListener("click",ee),document.querySelectorAll(".diff-btn").forEach(f=>{f.addEventListener("click",()=>{const v=f.dataset.diff;v&&x[v]&&(T=v,P(s,a,o,r))})})}P((t==null?void 0:t.uiText.title)||"Prism Snake",(t==null?void 0:t.uiText.help)||"Serpent néon premium.");W();
