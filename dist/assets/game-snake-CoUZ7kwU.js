import{m as q,e as j,f as X,l as Y,p as $,w as K,k as T,n as L,q as V,t as J}from"./index-Cmf_HX6D.js";import{c as Q,a as Z}from"./input-BfI4bNy9.js";import{c as ee}from"./loop-24SuRqx9.js";const b="snake",t=q(b),A=j(),d=A.find(s=>s.id===(t==null?void 0:t.themeId))||A[0];X();if(d){const s=document.documentElement.style;s.setProperty("--color-primary",d.colors.primary),s.setProperty("--color-secondary",d.colors.secondary),s.setProperty("--color-accent",d.colors.accent),s.setProperty("--color-text",d.colors.text),s.setProperty("--color-muted",d.colors.muted),document.body.style.background=d.gradient||d.colors.background}const f=document.getElementById("game-canvas"),y=document.getElementById("ui"),i=f.getContext("2d"),H=Q(),v=document.createElement("div");v.className="launch-overlay";v.style.display="none";y.appendChild(v);const U=new Image;U.src=new URL("data:image/svg+xml,%3csvg%20width='220'%20height='220'%20viewBox='0%200%20220%20220'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cdefs%3e%3cradialGradient%20id='core'%20cx='0'%20cy='0'%20r='1'%20gradientUnits='userSpaceOnUse'%20gradientTransform='translate(110%20110)%20rotate(90)%20scale(110)'%3e%3cstop%20stop-color='%237CFFE1'%20/%3e%3cstop%20offset='1'%20stop-color='%230A1A2E'%20/%3e%3c/radialGradient%3e%3clinearGradient%20id='rim'%20x1='40'%20y1='50'%20x2='180'%20y2='170'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%237CFFE1'%20stop-opacity='0.9'%20/%3e%3cstop%20offset='1'%20stop-color='%237B8CFF'%20stop-opacity='0.85'%20/%3e%3c/linearGradient%3e%3c/defs%3e%3ccircle%20cx='110'%20cy='110'%20r='98'%20fill='url(%23core)'%20/%3e%3ccircle%20cx='110'%20cy='110'%20r='98'%20stroke='url(%23rim)'%20stroke-width='10'%20/%3e%3ccircle%20cx='110'%20cy='90'%20r='34'%20fill='%23E9FFFA'%20fill-opacity='0.85'%20/%3e%3ccircle%20cx='138'%20cy='80'%20r='18'%20fill='%23E9FFFA'%20fill-opacity='0.65'%20/%3e%3cpath%20d='M110%2022c20%203%2035%2012%2045%2026-18-8-35-10-53-6%204-7%205-14%208-20z'%20fill='%236DF6D4'%20fill-opacity='0.8'%20/%3e%3c/svg%3e",import.meta.url).href;const O=new Image;O.src=new URL("data:image/svg+xml,%3csvg%20width='220'%20height='220'%20viewBox='0%200%20220%20220'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cdefs%3e%3clinearGradient%20id='prism-core'%20x1='30'%20y1='40'%20x2='190'%20y2='180'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%23FF7EE2'%20/%3e%3cstop%20offset='0.45'%20stop-color='%237B8CFF'%20/%3e%3cstop%20offset='1'%20stop-color='%237CFFE1'%20/%3e%3c/linearGradient%3e%3cradialGradient%20id='prism-glow'%20cx='0'%20cy='0'%20r='1'%20gradientUnits='userSpaceOnUse'%20gradientTransform='translate(110%20110)%20rotate(90)%20scale(110)'%3e%3cstop%20stop-color='%23ffffff'%20stop-opacity='0.7'%20/%3e%3cstop%20offset='1'%20stop-color='%23050712'%20/%3e%3c/radialGradient%3e%3c/defs%3e%3ccircle%20cx='110'%20cy='110'%20r='100'%20fill='url(%23prism-glow)'%20/%3e%3cpath%20d='M110%2018%20190%20110%20110%20202%2030%20110%20110%2018z'%20fill='url(%23prism-core)'%20/%3e%3cpath%20d='M110%2018%20190%20110%20110%20202%2030%20110%20110%2018z'%20stroke='%23ffffff'%20stroke-opacity='0.4'%20stroke-width='6'%20/%3e%3ccircle%20cx='110'%20cy='110'%20r='46'%20fill='%230A0F24'%20fill-opacity='0.5'%20/%3e%3ccircle%20cx='110'%20cy='110'%20r='38'%20stroke='%23ffffff'%20stroke-opacity='0.4'%20stroke-width='4'%20/%3e%3ccircle%20cx='110'%20cy='84'%20r='14'%20fill='%23ffffff'%20fill-opacity='0.6'%20/%3e%3c/svg%3e",import.meta.url).href;const P=new Image;P.src=new URL("data:image/svg+xml,%3csvg%20width='340'%20height='340'%20viewBox='0%200%20340%20340'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cdefs%3e%3clinearGradient%20id='glow'%20x1='0'%20y1='0'%20x2='1'%20y2='1'%3e%3cstop%20stop-color='%237CFFE1'%20stop-opacity='0.18'%20/%3e%3cstop%20offset='0.5'%20stop-color='%237B8CFF'%20stop-opacity='0.12'%20/%3e%3cstop%20offset='1'%20stop-color='%23FF7EE2'%20stop-opacity='0.14'%20/%3e%3c/linearGradient%3e%3c/defs%3e%3crect%20width='340'%20height='340'%20fill='%23050712'%20/%3e%3crect%20width='340'%20height='340'%20fill='url(%23glow)'%20/%3e%3cg%20stroke='%23a3b3ff'%20stroke-opacity='0.16'%20stroke-width='1'%3e%3cpath%20d='M20%200v340M40%200v340M60%200v340M80%200v340M100%200v340M120%200v340M140%200v340M160%200v340M180%200v340M200%200v340M220%200v340M240%200v340M260%200v340M280%200v340M300%200v340M320%200v340'%20/%3e%3cpath%20d='M0%2020h340M0%2040h340M0%2060h340M0%2080h340M0%20100h340M0%20120h340M0%20140h340M0%20160h340M0%20180h340M0%20200h340M0%20220h340M0%20240h340M0%20260h340M0%20280h340M0%20300h340M0%20320h340'%20/%3e%3c/g%3e%3crect%20x='1'%20y='1'%20width='338'%20height='338'%20stroke='%237CFFE1'%20stroke-opacity='0.14'%20stroke-width='2'%20/%3e%3c/svg%3e",import.meta.url).href;const w={up:(t==null?void 0:t.input.keys.up)||"ArrowUp",down:(t==null?void 0:t.input.keys.down)||"ArrowDown",left:(t==null?void 0:t.input.keys.left)||"ArrowLeft",right:(t==null?void 0:t.input.keys.right)||"ArrowRight",dash:(t==null?void 0:t.input.keys.dash)||"Space"};var D,G;const te=typeof window<"u"&&(((G=(D=window.matchMedia)==null?void 0:D.call(window,"(pointer: coarse)"))==null?void 0:G.matches)||navigator.maxTouchPoints>0),R=te?Z({container:document.body,input:H,mapping:{up:w.up,down:w.down,left:w.left,right:w.right,actionA:w.dash,actionALabel:"Boost"},autoShow:!1,showPad:!0,gestureEnabled:!1,showOnDesktop:!1}):{show:()=>{},hide:()=>{},dispose:()=>{}},g={easy:{label:"Facile",boardSize:20,tickMs:170,speedRamp:.992,prismChance:.22,lengthTarget:36,boostSeconds:3.4,wallSolid:!0},medium:{label:"Moyen",boardSize:(t==null?void 0:t.difficultyParams.boardSize)??21,tickMs:(t==null?void 0:t.difficultyParams.baseTickMs)??140,speedRamp:(t==null?void 0:t.difficultyParams.speedRamp)??.985,prismChance:(t==null?void 0:t.difficultyParams.prismChance)??.18,lengthTarget:(t==null?void 0:t.difficultyParams.targetLength)??46,boostSeconds:((t==null?void 0:t.difficultyParams.boostDurationMs)??3200)/1e3,wallSolid:!!((t==null?void 0:t.difficultyParams.wallIsSolid)??1)},hard:{label:"Difficile",boardSize:19,tickMs:120,speedRamp:.982,prismChance:.14,lengthTarget:52,boostSeconds:2.6,wallSolid:!0},extreme:{label:"Extrême",boardSize:18,tickMs:105,speedRamp:.978,prismChance:.1,lengthTarget:60,boostSeconds:2.4,wallSolid:!0}};let k="medium";var B;const e={running:!1,boardSize:$((t==null?void 0:t.difficultyParams.boardSize)??20,12,32),cellSize:24,viewWidth:window.innerWidth,viewHeight:window.innerHeight,offsetX:0,offsetY:0,snake:[],dir:{x:1,y:0},pendingDir:{x:1,y:0},inputReady:!0,food:null,tickMs:(t==null?void 0:t.difficultyParams.baseTickMs)??140,timer:0,boost:0,score:0,best:((B=Y().games[b])==null?void 0:B.bestScore)??0,streak:0,comboTimer:0,particles:[],flash:0,lengthTarget:(t==null?void 0:t.difficultyParams.targetLength)??42,wallSolid:!!((t==null?void 0:t.difficultyParams.wallIsSolid)??1),speedRamp:(t==null?void 0:t.difficultyParams.speedRamp)??.99,prismChance:(t==null?void 0:t.difficultyParams.prismChance)??.16,boostSeconds:((t==null?void 0:t.difficultyParams.boostDurationMs)??2600)/1e3,dpr:devicePixelRatio||1},W=ee({update:s=>le(s),render:_,fps:60});function I(){e.dpr=devicePixelRatio||1,f.width=window.innerWidth*e.dpr,f.height=window.innerHeight*e.dpr,f.style.width="100%",f.style.height="100%",e.viewWidth=f.width/e.dpr,e.viewHeight=f.height/e.dpr;const s=Math.min(e.viewWidth,e.viewHeight)*.88;e.cellSize=$(Math.floor(s/e.boardSize),18,46);const a=e.cellSize*e.boardSize;e.offsetX=(e.viewWidth-a)/2,e.offsetY=(e.viewHeight-a)/2}I();window.addEventListener("resize",I);function se(){if(!t){z("Config manquante","Ajoute configs/games/snake.config.json",!1);return}R.show();const s=g[k]||g.medium;e.boardSize=$(s.boardSize,12,32),I(),e.running=!0,e.dir={x:1,y:0},e.pendingDir={x:1,y:0},e.inputReady=!0;const a=Math.floor(e.boardSize/2);e.snake=[{x:a-2,y:a},{x:a-1,y:a},{x:a,y:a}],e.score=e.snake.length,e.food=null,e.tickMs=s.tickMs,e.timer=0,e.boost=0,e.streak=0,e.comboTimer=0,e.particles=[],e.flash=.9,e.lengthTarget=s.lengthTarget,e.wallSolid=s.wallSolid,e.speedRamp=s.speedRamp,e.prismChance=s.prismChance,e.boostSeconds=s.boostSeconds,N(),v.style.display="none",f.style.pointerEvents="auto",y.style.pointerEvents="none",T({type:"SESSION_START",gameId:b}),W.start()}function F(s){e.running=!1,W.stop(),R.hide();const a=e.score;T({type:s?"SESSION_WIN":"SESSION_FAIL",gameId:b,payload:{score:a}}),J(b,(t==null?void 0:t.saveSchemaVersion)??1,r=>{const h=r.state.bestLength||0;r.state.bestLength=Math.max(h,e.snake.length);const c=r.bestScore||0;a>c&&(r.bestScore=a)}),e.best=Math.max(e.best,a),z(s?"Flow parfait":"Collision détectée",(t==null?void 0:t.uiText.help)||"",!0,a)}function N(){const s=new Set(e.snake.map(r=>`${r.x},${r.y}`));let a={x:0,y:0},o=0;do a={x:Math.floor(L(0,e.boardSize)),y:Math.floor(L(0,e.boardSize))},o+=1;while(s.has(`${a.x},${a.y}`)&&o<400);const l=V(e.prismChance);e.food={...a,type:l?"prism":"core"}}function x(s){!e.inputReady||s.x===-e.dir.x&&s.y===-e.dir.y||(e.pendingDir=s,e.inputReady=!1)}function ae(){if(!t)return;const s=t.input.keys,a=l=>l?H.isDown(l):!1;(a(s.left)||a(s.altLeft))&&x({x:-1,y:0}),(a(s.right)||a(s.altRight))&&x({x:1,y:0}),(a(s.up)||a(s.altUp))&&x({x:0,y:-1}),(a(s.down)||a(s.altDown))&&x({x:0,y:1});const o=s.dash||"Space";a(o)&&e.boost<=.1&&(e.boost=e.boostSeconds,e.flash=1)}function ie(){e.dir=e.pendingDir;const s=e.snake[e.snake.length-1];let a={x:s.x+e.dir.x,y:s.y+e.dir.y};if(!e.wallSolid)a.x=(a.x+e.boardSize)%e.boardSize,a.y=(a.y+e.boardSize)%e.boardSize;else if(a.x<0||a.y<0||a.x>=e.boardSize||a.y>=e.boardSize){F(!1);return}if(e.snake.some(l=>l.x===a.x&&l.y===a.y)){F(!1);return}e.snake.push(a);let o=!1;e.food&&a.x===e.food.x&&a.y===e.food.y&&(o=!0,oe(e.food)),o||e.snake.shift(),e.inputReady=!0}function oe(s){e.flash=1,e.comboTimer=2.8,e.streak+=1,e.score=e.snake.length,T({type:s.type==="prism"?"PRISM_FRUIT_EATEN":"FRUIT_EATEN",gameId:b,payload:{score:e.score}}),s.type==="prism"&&(e.boost=Math.max(e.boost,e.boostSeconds),T({type:"STREAK_BONUS",gameId:b})),e.tickMs=Math.max(75,e.tickMs*e.speedRamp),N(),e.particles.push({x:s.x,y:s.y,r:e.cellSize*1.2,alpha:.65,decay:.9,color:s.type==="prism"?d.colors.accent:d.colors.primary}),e.snake.length>=e.lengthTarget&&F(!0)}function le(s){if(!e.running)return;const a=e.boost>0?1.25:1;for(e.timer+=s*1e3*a,e.boost=Math.max(0,e.boost-s),e.flash=Math.max(0,e.flash-s*.8),e.comboTimer=Math.max(0,e.comboTimer-s),e.comboTimer===0&&(e.streak=0),ae();e.timer>=e.tickMs;)e.timer-=e.tickMs,ie();e.particles=e.particles.map(o=>({...o,alpha:o.alpha-s*o.decay})).filter(o=>o.alpha>.02)}function E(s,a,o,l,r){i.beginPath(),i.moveTo(s+r,a),i.lineTo(s+o-r,a),i.quadraticCurveTo(s+o,a,s+o,a+r),i.lineTo(s+o,a+l-r),i.quadraticCurveTo(s+o,a+l,s+o-r,a+l),i.lineTo(s+r,a+l),i.quadraticCurveTo(s,a+l,s,a+l-r),i.lineTo(s,a+r),i.quadraticCurveTo(s,a,s+r,a),i.closePath()}function _(){i.save(),i.scale(e.dpr,e.dpr),i.clearRect(0,0,e.viewWidth,e.viewHeight);const s=i.createLinearGradient(0,0,e.viewWidth,e.viewHeight);s.addColorStop(0,"rgba(124,255,225,0.08)"),s.addColorStop(.5,"rgba(123,140,255,0.08)"),s.addColorStop(1,"rgba(255,126,226,0.08)"),i.fillStyle=s,i.fillRect(0,0,e.viewWidth,e.viewHeight),P.complete&&(i.globalAlpha=.16,i.drawImage(P,0,0,e.viewWidth,e.viewHeight),i.globalAlpha=1);const a=e.cellSize*e.boardSize,o=e.offsetX,l=e.offsetY,r=i.createLinearGradient(o,l,o,l+a);r.addColorStop(0,"rgba(255,255,255,0.04)"),r.addColorStop(1,"rgba(255,255,255,0.02)"),i.fillStyle=r,E(o,l,a,a,14),i.fill(),i.strokeStyle="rgba(255,255,255,0.08)",i.lineWidth=1.2,i.stroke(),i.strokeStyle="rgba(255,255,255,0.05)",i.lineWidth=.8;for(let c=1;c<e.boardSize;c++){const n=o+c*e.cellSize,p=l+c*e.cellSize;i.beginPath(),i.moveTo(n,l),i.lineTo(n,l+a),i.stroke(),i.beginPath(),i.moveTo(o,p),i.lineTo(o+a,p),i.stroke()}if(e.particles.forEach(c=>{const n=o+c.x*e.cellSize+e.cellSize/2,p=l+c.y*e.cellSize+e.cellSize/2,m=i.createRadialGradient(n,p,2,n,p,c.r);m.addColorStop(0,`${c.color}bf`),m.addColorStop(1,"transparent"),i.globalAlpha=c.alpha,i.fillStyle=m,i.beginPath(),i.arc(n,p,c.r,0,Math.PI*2),i.fill(),i.globalAlpha=1}),e.food){const c=o+e.food.x*e.cellSize,n=l+e.food.y*e.cellSize,p=e.food.type==="prism"?O:U;p.complete?i.drawImage(p,c,n,e.cellSize,e.cellSize):(i.fillStyle=e.food.type==="prism"?d.colors.accent:d.colors.primary,E(c+3,n+3,e.cellSize-6,e.cellSize-6,10),i.fill())}const h=e.snake.length;e.snake.forEach((c,n)=>{const p=o+c.x*e.cellSize+2,m=l+c.y*e.cellSize+2,C=n/Math.max(1,h-1),M=n===h-1?d.colors.primary:d.colors.secondary,u=n===h-1?.95:.55+C*.35;i.fillStyle=`${M}${Math.floor(u*255).toString(16).padStart(2,"0")}`,E(p,m,e.cellSize-4,e.cellSize-4,9),i.fill(),n===h-1&&(i.strokeStyle=d.colors.accent,i.lineWidth=2,i.beginPath(),i.arc(o+c.x*e.cellSize+e.cellSize/2,l+c.y*e.cellSize+e.cellSize/2,e.cellSize*.18+e.flash*4,0,Math.PI*2),i.stroke())}),i.restore(),re()}function re(){y.innerHTML="",y.appendChild(v);const s=document.createElement("div");s.className="hud",s.innerHTML=`
    <div class="chip">Score <strong>${e.score}/${e.lengthTarget}</strong></div>
    <div class="chip ghost">Vitesse <span>${(1e3/e.tickMs).toFixed(1)} t/s</span></div>
    <div class="chip ghost">Record <span>${e.best}</span></div>
  `,y.appendChild(s);const a=document.createElement("div");a.className="hud bottom",a.innerHTML=`
    <div class="pill ${e.boost>0?"glow":""}">Boost ${e.boost>0?"actif":"off"}</div>
    <div class="pill">Flow ${Math.max(1,e.streak)}x</div>
  `,y.appendChild(a)}function z(s,a,o=!0,l){var M;R.hide();const r=g[k]||g.medium;v.style.display="grid",y.style.pointerEvents="auto",f.style.pointerEvents="none";const h=(t==null?void 0:t.uiText.shortDescription)||"",c=a||(t==null?void 0:t.uiText.help)||"",n=((t==null?void 0:t.uiText.controls)||[]).map(u=>`<span class="launch-chip">${u}</span>`).join(""),m=`
    <div class="launch-rows">
      <div class="launch-row">
        <span class="launch-row-label">Difficulté</span>
        <div class="launch-row-value launch-options">
          ${Object.entries(g).map(([u,S])=>`
        <button class="launch-option diff-btn ${u===k?"is-active":""}" data-diff="${u}">
          <span class="launch-option-title">${S.label}</span>
          <span class="launch-option-meta">${S.lengthTarget} segments</span>
        </button>
      `).join("")}
        </div>
      </div>
      <div class="launch-row">
        <span class="launch-row-label">Mode</span>
        <div class="launch-row-value">
          <span class="launch-chip">Standard</span>
        </div>
      </div>
    </div>
  `,C=`
    <div class="launch-metrics">
      <div class="launch-metric"><span>Record</span><strong>${e.best}</strong></div>
      <div class="launch-metric"><span>Objectif</span><strong>${r.lengthTarget}</strong></div>
      <div class="launch-metric"><span>Cadence</span><strong>${(1e3/r.tickMs).toFixed(1)} t/s</strong></div>
    </div>
  `;v.innerHTML=`
    <div class="launch-card">
      <div class="launch-head">
        <div class="launch-brand">
          <span class="launch-badge">Arcade Galaxy</span>
          <span class="launch-badge ghost">${(t==null?void 0:t.uiText.title)||"Prism Snake"}</span>
        </div>
        <h2 class="launch-title">${s}</h2>
        ${h?`<p class="launch-subtitle">${h}</p>`:""}
      </div>
      <div class="launch-grid">
        <section class="launch-section">
          <h3 class="launch-section-title">Briefing</h3>
          <p class="launch-text">${c}</p>
          ${l!==void 0?`<p class="launch-note">Dernier score : ${l}/${e.lengthTarget}</p>`:""}
        </section>
        <section class="launch-section">
          <h3 class="launch-section-title">Paramètres</h3>
          ${m}
        </section>
        <section class="launch-section">
          <h3 class="launch-section-title">Contrôles</h3>
          <div class="launch-chips">
            ${n||'<span class="launch-chip muted">Contrôles à définir</span>'}
          </div>
        </section>
        <section class="launch-section">
          <h3 class="launch-section-title">Repères</h3>
          ${C}
        </section>
      </div>
      <div class="launch-actions">
        ${o?'<button class="launch-btn primary" id="launch-start">Lancer</button>':""}
        <a class="launch-btn ghost" href="${K("/")}">Hub</a>
      </div>
    </div>
  `,(M=document.getElementById("launch-start"))==null||M.addEventListener("click",se),document.querySelectorAll(".diff-btn").forEach(u=>{u.addEventListener("click",()=>{const S=u.dataset.diff;S&&g[S]&&(k=S,z(s,a,o,l))})})}z((t==null?void 0:t.uiText.title)||"Prism Snake",(t==null?void 0:t.uiText.help)||"Serpent néon premium.");_();
