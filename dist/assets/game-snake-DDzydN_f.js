import{d as N,c as _,e as C,w as j,r as R,f as q}from"./loaders-CNHm-dlv.js";import{c as X,a as L}from"./input-Cf-krNy4.js";import{c as Y}from"./loop-24SuRqx9.js";import{a as K,l as V,c as M,d as J}from"./index-niTdxgfr.js";const u="snake",a=N(u),I=_(),d=I.find(t=>t.id===(a==null?void 0:a.themeId))||I[0];K();if(d){const t=document.documentElement.style;t.setProperty("--color-primary",d.colors.primary),t.setProperty("--color-secondary",d.colors.secondary),t.setProperty("--color-accent",d.colors.accent),t.setProperty("--color-text",d.colors.text),t.setProperty("--color-muted",d.colors.muted),document.body.style.background=d.gradient||d.colors.background}const m=document.getElementById("game-canvas"),S=document.getElementById("ui"),s=m.getContext("2d"),P=X(),y=document.createElement("div");y.className="overlay";y.style.display="none";S.appendChild(y);const A=new Image;A.src=new URL("data:image/svg+xml,%3csvg%20width='220'%20height='220'%20viewBox='0%200%20220%20220'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cdefs%3e%3cradialGradient%20id='core'%20cx='0'%20cy='0'%20r='1'%20gradientUnits='userSpaceOnUse'%20gradientTransform='translate(110%20110)%20rotate(90)%20scale(110)'%3e%3cstop%20stop-color='%237CFFE1'%20/%3e%3cstop%20offset='1'%20stop-color='%230A1A2E'%20/%3e%3c/radialGradient%3e%3clinearGradient%20id='rim'%20x1='40'%20y1='50'%20x2='180'%20y2='170'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%237CFFE1'%20stop-opacity='0.9'%20/%3e%3cstop%20offset='1'%20stop-color='%237B8CFF'%20stop-opacity='0.85'%20/%3e%3c/linearGradient%3e%3c/defs%3e%3ccircle%20cx='110'%20cy='110'%20r='98'%20fill='url(%23core)'%20/%3e%3ccircle%20cx='110'%20cy='110'%20r='98'%20stroke='url(%23rim)'%20stroke-width='10'%20/%3e%3ccircle%20cx='110'%20cy='90'%20r='34'%20fill='%23E9FFFA'%20fill-opacity='0.85'%20/%3e%3ccircle%20cx='138'%20cy='80'%20r='18'%20fill='%23E9FFFA'%20fill-opacity='0.65'%20/%3e%3cpath%20d='M110%2022c20%203%2035%2012%2045%2026-18-8-35-10-53-6%204-7%205-14%208-20z'%20fill='%236DF6D4'%20fill-opacity='0.8'%20/%3e%3c/svg%3e",import.meta.url).href;const G=new Image;G.src=new URL("data:image/svg+xml,%3csvg%20width='220'%20height='220'%20viewBox='0%200%20220%20220'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cdefs%3e%3clinearGradient%20id='prism-core'%20x1='30'%20y1='40'%20x2='190'%20y2='180'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%23FF7EE2'%20/%3e%3cstop%20offset='0.45'%20stop-color='%237B8CFF'%20/%3e%3cstop%20offset='1'%20stop-color='%237CFFE1'%20/%3e%3c/linearGradient%3e%3cradialGradient%20id='prism-glow'%20cx='0'%20cy='0'%20r='1'%20gradientUnits='userSpaceOnUse'%20gradientTransform='translate(110%20110)%20rotate(90)%20scale(110)'%3e%3cstop%20stop-color='%23ffffff'%20stop-opacity='0.7'%20/%3e%3cstop%20offset='1'%20stop-color='%23050712'%20/%3e%3c/radialGradient%3e%3c/defs%3e%3ccircle%20cx='110'%20cy='110'%20r='100'%20fill='url(%23prism-glow)'%20/%3e%3cpath%20d='M110%2018%20190%20110%20110%20202%2030%20110%20110%2018z'%20fill='url(%23prism-core)'%20/%3e%3cpath%20d='M110%2018%20190%20110%20110%20202%2030%20110%20110%2018z'%20stroke='%23ffffff'%20stroke-opacity='0.4'%20stroke-width='6'%20/%3e%3ccircle%20cx='110'%20cy='110'%20r='46'%20fill='%230A0F24'%20fill-opacity='0.5'%20/%3e%3ccircle%20cx='110'%20cy='110'%20r='38'%20stroke='%23ffffff'%20stroke-opacity='0.4'%20stroke-width='4'%20/%3e%3ccircle%20cx='110'%20cy='84'%20r='14'%20fill='%23ffffff'%20fill-opacity='0.6'%20/%3e%3c/svg%3e",import.meta.url).href;const z=new Image;z.src=new URL("data:image/svg+xml,%3csvg%20width='340'%20height='340'%20viewBox='0%200%20340%20340'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cdefs%3e%3clinearGradient%20id='glow'%20x1='0'%20y1='0'%20x2='1'%20y2='1'%3e%3cstop%20stop-color='%237CFFE1'%20stop-opacity='0.18'%20/%3e%3cstop%20offset='0.5'%20stop-color='%237B8CFF'%20stop-opacity='0.12'%20/%3e%3cstop%20offset='1'%20stop-color='%23FF7EE2'%20stop-opacity='0.14'%20/%3e%3c/linearGradient%3e%3c/defs%3e%3crect%20width='340'%20height='340'%20fill='%23050712'%20/%3e%3crect%20width='340'%20height='340'%20fill='url(%23glow)'%20/%3e%3cg%20stroke='%23a3b3ff'%20stroke-opacity='0.16'%20stroke-width='1'%3e%3cpath%20d='M20%200v340M40%200v340M60%200v340M80%200v340M100%200v340M120%200v340M140%200v340M160%200v340M180%200v340M200%200v340M220%200v340M240%200v340M260%200v340M280%200v340M300%200v340M320%200v340'%20/%3e%3cpath%20d='M0%2020h340M0%2040h340M0%2060h340M0%2080h340M0%20100h340M0%20120h340M0%20140h340M0%20160h340M0%20180h340M0%20200h340M0%20220h340M0%20240h340M0%20260h340M0%20280h340M0%20300h340M0%20320h340'%20/%3e%3c/g%3e%3crect%20x='1'%20y='1'%20width='338'%20height='338'%20stroke='%237CFFE1'%20stroke-opacity='0.14'%20stroke-width='2'%20/%3e%3c/svg%3e",import.meta.url).href;const h={up:(a==null?void 0:a.input.keys.up)||"ArrowUp",down:(a==null?void 0:a.input.keys.down)||"ArrowDown",left:(a==null?void 0:a.input.keys.left)||"ArrowLeft",right:(a==null?void 0:a.input.keys.right)||"ArrowRight",dash:(a==null?void 0:a.input.keys.dash)||"Space"},E=L({container:document.body,input:P,mapping:{up:h.up,down:h.down,left:h.left,right:h.right,actionA:h.dash,actionALabel:"Boost"},autoShow:!1,showPad:!1}),b={easy:{label:"Facile",boardSize:20,tickMs:170,speedRamp:.992,prismChance:.22,lengthTarget:36,boostSeconds:3.4,wallSolid:!0},medium:{label:"Moyen",boardSize:(a==null?void 0:a.difficultyParams.boardSize)??21,tickMs:(a==null?void 0:a.difficultyParams.baseTickMs)??140,speedRamp:(a==null?void 0:a.difficultyParams.speedRamp)??.985,prismChance:(a==null?void 0:a.difficultyParams.prismChance)??.18,lengthTarget:(a==null?void 0:a.difficultyParams.targetLength)??46,boostSeconds:((a==null?void 0:a.difficultyParams.boostDurationMs)??3200)/1e3,wallSolid:!!((a==null?void 0:a.difficultyParams.wallIsSolid)??1)},hard:{label:"Difficile",boardSize:19,tickMs:120,speedRamp:.982,prismChance:.14,lengthTarget:52,boostSeconds:2.6,wallSolid:!0},extreme:{label:"Extrême",boardSize:18,tickMs:105,speedRamp:.978,prismChance:.1,lengthTarget:60,boostSeconds:2.4,wallSolid:!0}};let w="medium";L({container:document.body,input:P,mapping:{up:h.up,down:h.down,left:h.left,right:h.right,actionA:h.dash,actionALabel:"Boost"}});var $;const e={running:!1,boardSize:C((a==null?void 0:a.difficultyParams.boardSize)??20,12,32),cellSize:24,viewWidth:window.innerWidth,viewHeight:window.innerHeight,offsetX:0,offsetY:0,snake:[],dir:{x:1,y:0},pendingDir:{x:1,y:0},inputReady:!0,food:null,tickMs:(a==null?void 0:a.difficultyParams.baseTickMs)??140,timer:0,boost:0,score:0,best:(($=V().games[u])==null?void 0:$.bestScore)??0,streak:0,comboTimer:0,particles:[],flash:0,lengthTarget:(a==null?void 0:a.difficultyParams.targetLength)??42,wallSolid:!!((a==null?void 0:a.difficultyParams.wallIsSolid)??1),speedRamp:(a==null?void 0:a.difficultyParams.speedRamp)??.99,prismChance:(a==null?void 0:a.difficultyParams.prismChance)??.16,boostSeconds:((a==null?void 0:a.difficultyParams.boostDurationMs)??2600)/1e3,dpr:devicePixelRatio||1},B=Y({update:t=>oe(t),render:U,fps:60});function F(){e.dpr=devicePixelRatio||1,m.width=window.innerWidth*e.dpr,m.height=window.innerHeight*e.dpr,m.style.width="100%",m.style.height="100%",e.viewWidth=m.width/e.dpr,e.viewHeight=m.height/e.dpr;const t=Math.min(e.viewWidth,e.viewHeight)*.88;e.cellSize=C(Math.floor(t/e.boardSize),18,46);const o=e.cellSize*e.boardSize;e.offsetX=(e.viewWidth-o)/2,e.offsetY=(e.viewHeight-o)/2}F();window.addEventListener("resize",F);function Q(){if(!a){x("Config manquante","Ajoute configs/games/snake.config.json",!1);return}E.show();const t=b[w]||b.medium;e.boardSize=C(t.boardSize,12,32),F(),e.running=!0,e.dir={x:1,y:0},e.pendingDir={x:1,y:0},e.inputReady=!0;const o=Math.floor(e.boardSize/2);e.snake=[{x:o-2,y:o},{x:o-1,y:o},{x:o,y:o}],e.food=null,e.tickMs=t.tickMs,e.timer=0,e.boost=0,e.score=0,e.streak=0,e.comboTimer=0,e.particles=[],e.flash=.9,e.lengthTarget=t.lengthTarget,e.wallSolid=t.wallSolid,e.speedRamp=t.speedRamp,e.prismChance=t.prismChance,e.boostSeconds=t.boostSeconds,H(),y.style.display="none",M({type:"SESSION_START",gameId:u}),B.start()}function T(t){e.running=!1,B.stop(),E.hide();const o=e.score;M({type:t?"SESSION_WIN":"SESSION_FAIL",gameId:u,payload:{score:o}}),J(u,(a==null?void 0:a.saveSchemaVersion)??1,c=>{const f=c.state.bestLength||0;c.state.bestLength=Math.max(f,e.snake.length);const l=c.bestScore||0;o>l&&(c.bestScore=o)}),e.best=Math.max(e.best,o),x(t?"Flow parfait":"Collision détectée",(a==null?void 0:a.uiText.help)||"",!0,o)}function H(){const t=new Set(e.snake.map(c=>`${c.x},${c.y}`));let o={x:0,y:0},i=0;do o={x:Math.floor(R(0,e.boardSize)),y:Math.floor(R(0,e.boardSize))},i+=1;while(t.has(`${o.x},${o.y}`)&&i<400);const r=q(e.prismChance);e.food={...o,type:r?"prism":"core"}}function v(t){!e.inputReady||t.x===-e.dir.x&&t.y===-e.dir.y||(e.pendingDir=t,e.inputReady=!1)}function Z(){if(!a)return;const t=a.input.keys,o=r=>r?P.isDown(r):!1;(o(t.left)||o(t.altLeft))&&v({x:-1,y:0}),(o(t.right)||o(t.altRight))&&v({x:1,y:0}),(o(t.up)||o(t.altUp))&&v({x:0,y:-1}),(o(t.down)||o(t.altDown))&&v({x:0,y:1});const i=t.dash||"Space";o(i)&&e.boost<=.1&&(e.boost=e.boostSeconds,e.flash=1)}function ee(){e.dir=e.pendingDir;const t=e.snake[e.snake.length-1];let o={x:t.x+e.dir.x,y:t.y+e.dir.y};if(!e.wallSolid)o.x=(o.x+e.boardSize)%e.boardSize,o.y=(o.y+e.boardSize)%e.boardSize;else if(o.x<0||o.y<0||o.x>=e.boardSize||o.y>=e.boardSize){T(!1);return}if(e.snake.some(r=>r.x===o.x&&r.y===o.y)){T(!1);return}e.snake.push(o);let i=!1;e.food&&o.x===e.food.x&&o.y===e.food.y&&(i=!0,te(e.food)),i||e.snake.shift(),e.inputReady=!0}function te(t){e.flash=1,e.comboTimer=2.8,e.streak+=1;const o=t.type==="prism"?18:9;e.score+=o+Math.floor(Math.max(0,e.streak-1)*1.5),M({type:t.type==="prism"?"PRISM_FRUIT_EATEN":"FRUIT_EATEN",gameId:u,payload:{score:e.score}}),t.type==="prism"&&(e.boost=Math.max(e.boost,e.boostSeconds),M({type:"STREAK_BONUS",gameId:u})),e.tickMs=Math.max(75,e.tickMs*e.speedRamp),H(),e.particles.push({x:t.x,y:t.y,r:e.cellSize*1.2,alpha:.65,decay:.9,color:t.type==="prism"?d.colors.accent:d.colors.primary}),e.snake.length>=e.lengthTarget&&T(!0)}function oe(t){if(!e.running)return;const o=e.boost>0?1.25:1;for(e.timer+=t*1e3*o,e.boost=Math.max(0,e.boost-t),e.flash=Math.max(0,e.flash-t*.8),e.comboTimer=Math.max(0,e.comboTimer-t),e.comboTimer===0&&(e.streak=0),Z();e.timer>=e.tickMs;)e.timer-=e.tickMs,ee();e.particles=e.particles.map(i=>({...i,alpha:i.alpha-t*i.decay})).filter(i=>i.alpha>.02)}function k(t,o,i,r,c){s.beginPath(),s.moveTo(t+c,o),s.lineTo(t+i-c,o),s.quadraticCurveTo(t+i,o,t+i,o+c),s.lineTo(t+i,o+r-c),s.quadraticCurveTo(t+i,o+r,t+i-c,o+r),s.lineTo(t+c,o+r),s.quadraticCurveTo(t,o+r,t,o+r-c),s.lineTo(t,o+c),s.quadraticCurveTo(t,o,t+c,o),s.closePath()}function U(){s.save(),s.scale(e.dpr,e.dpr),s.clearRect(0,0,e.viewWidth,e.viewHeight);const t=s.createLinearGradient(0,0,e.viewWidth,e.viewHeight);t.addColorStop(0,"rgba(124,255,225,0.08)"),t.addColorStop(.5,"rgba(123,140,255,0.08)"),t.addColorStop(1,"rgba(255,126,226,0.08)"),s.fillStyle=t,s.fillRect(0,0,e.viewWidth,e.viewHeight),z.complete&&(s.globalAlpha=.16,s.drawImage(z,0,0,e.viewWidth,e.viewHeight),s.globalAlpha=1);const o=e.cellSize*e.boardSize,i=e.offsetX,r=e.offsetY,c=s.createLinearGradient(i,r,i,r+o);c.addColorStop(0,"rgba(255,255,255,0.04)"),c.addColorStop(1,"rgba(255,255,255,0.02)"),s.fillStyle=c,k(i,r,o,o,14),s.fill(),s.strokeStyle="rgba(255,255,255,0.08)",s.lineWidth=1.2,s.stroke(),s.strokeStyle="rgba(255,255,255,0.05)",s.lineWidth=.8;for(let l=1;l<e.boardSize;l++){const n=i+l*e.cellSize,p=r+l*e.cellSize;s.beginPath(),s.moveTo(n,r),s.lineTo(n,r+o),s.stroke(),s.beginPath(),s.moveTo(i,p),s.lineTo(i+o,p),s.stroke()}if(e.particles.forEach(l=>{const n=i+l.x*e.cellSize+e.cellSize/2,p=r+l.y*e.cellSize+e.cellSize/2,g=s.createRadialGradient(n,p,2,n,p,l.r);g.addColorStop(0,`${l.color}bf`),g.addColorStop(1,"transparent"),s.globalAlpha=l.alpha,s.fillStyle=g,s.beginPath(),s.arc(n,p,l.r,0,Math.PI*2),s.fill(),s.globalAlpha=1}),e.food){const l=i+e.food.x*e.cellSize,n=r+e.food.y*e.cellSize,p=e.food.type==="prism"?G:A;p.complete?s.drawImage(p,l,n,e.cellSize,e.cellSize):(s.fillStyle=e.food.type==="prism"?d.colors.accent:d.colors.primary,k(l+3,n+3,e.cellSize-6,e.cellSize-6,10),s.fill())}const f=e.snake.length;e.snake.forEach((l,n)=>{const p=i+l.x*e.cellSize+2,g=r+l.y*e.cellSize+2,D=n/Math.max(1,f-1),W=n===f-1?d.colors.primary:d.colors.secondary,O=n===f-1?.95:.55+D*.35;s.fillStyle=`${W}${Math.floor(O*255).toString(16).padStart(2,"0")}`,k(p,g,e.cellSize-4,e.cellSize-4,9),s.fill(),n===f-1&&(s.strokeStyle=d.colors.accent,s.lineWidth=2,s.beginPath(),s.arc(i+l.x*e.cellSize+e.cellSize/2,r+l.y*e.cellSize+e.cellSize/2,e.cellSize*.18+e.flash*4,0,Math.PI*2),s.stroke())}),s.restore(),ae()}function ae(){S.innerHTML="",S.appendChild(y);const t=document.createElement("div");t.className="hud",t.innerHTML=`
    <div class="chip">Score <strong>${e.score}</strong></div>
    <div class="chip">Longueur <strong>${e.snake.length}/${e.lengthTarget}</strong></div>
    <div class="chip ghost">Vitesse <span>${(1e3/e.tickMs).toFixed(1)} t/s</span></div>
    <div class="chip ghost">Record <span>${e.best}</span></div>
  `,S.appendChild(t);const o=document.createElement("div");o.className="hud bottom",o.innerHTML=`
    <div class="pill ${e.boost>0?"glow":""}">Boost ${e.boost>0?"actif":"off"}</div>
    <div class="pill">Flow ${Math.max(1,e.streak)}x</div>
  `,S.appendChild(o)}function x(t,o,i=!0,r){var f;E.hide();const c=b[w]||b.medium;y.style.display="grid",y.innerHTML=`
    <div class="panel">
      <p class="pill">Prism Snake · ${c.label}</p>
      <h2>${t}</h2>
      ${r!==void 0?`<p class="muted">Score ${r} · Longueur ${e.snake.length}</p>`:""}
      <p class="muted">${o}</p>
      <div class="panel-actions" style="flex-wrap:wrap; justify-content:center;">
        ${Object.entries(b).map(([l,n])=>`
              <button class="btn ghost diff-btn ${l===w?"active":""}" data-diff="${l}">
                ${n.label} · ${n.lengthTarget} segments
              </button>
            `).join("")}
      </div>
      <div class="panel-actions">
        ${i?'<button class="btn" id="start-btn">Lancer</button>':""}
        <a class="btn ghost" href="${j("/")}">Hub</a>
      </div>
      <div class="inline-metrics">
        <div><span>Record</span><strong>${e.best}</strong></div>
        <div><span>Objectif</span><strong>${c.lengthTarget}</strong></div>
        <div><span>Cadence</span><strong>${(1e3/c.tickMs).toFixed(1)} t/s</strong></div>
      </div>
    </div>
  `,(f=document.getElementById("start-btn"))==null||f.addEventListener("click",Q),document.querySelectorAll(".diff-btn").forEach(l=>{l.addEventListener("click",()=>{const n=l.dataset.diff;n&&b[n]&&(w=n,x(t,o,i,r))})})}x((a==null?void 0:a.uiText.title)||"Prism Snake",(a==null?void 0:a.uiText.help)||"Serpent néon premium.");U();
