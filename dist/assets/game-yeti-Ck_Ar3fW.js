import{l as O,e as H,f as U,t as Z,x as A,w as N,n as I,m as u,p as x,q as W,s as _}from"./index-CK9lGSzJ.js";/* empty css                    */import{c as z,a as V}from"./input-C49DsMBr.js";import{c as q}from"./loop-24SuRqx9.js";const f="yeti",a=O(f),T=H(),d=a&&T.find(t=>t.id===a.themeId)||T[0];U();var L,Y;const K=((Y=(L=Z().games)==null?void 0:L[f])==null?void 0:Y.bestScore)??0;if(d){const t=document.documentElement.style;t.setProperty("--color-primary",d.colors.primary),t.setProperty("--color-secondary",d.colors.secondary),t.setProperty("--color-accent",d.colors.accent),t.setProperty("--color-text",d.colors.text),t.setProperty("--color-muted",d.colors.muted),document.body.style.background=d.gradient||document.body.style.background}const C=new Image;C.src=new URL("data:image/svg+xml,%3csvg%20width='160'%20height='160'%20viewBox='0%200%20160%20160'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cdefs%3e%3clinearGradient%20id='body'%20x1='36'%20y1='20'%20x2='120'%20y2='144'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%230B1E35'/%3e%3cstop%20offset='1'%20stop-color='%2313395C'/%3e%3c/linearGradient%3e%3clinearGradient%20id='belly'%20x1='64'%20y1='54'%20x2='104'%20y2='126'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%23F9FCFF'/%3e%3cstop%20offset='1'%20stop-color='%23E5EFFA'/%3e%3c/linearGradient%3e%3clinearGradient%20id='shine'%20x1='54'%20y1='26'%20x2='82'%20y2='70'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%237BE0FF'%20stop-opacity='0.9'/%3e%3cstop%20offset='1'%20stop-color='%237BE0FF'%20stop-opacity='0'/%3e%3c/linearGradient%3e%3c/defs%3e%3cpath%20d='M80%2018c-28%200-50%2026-50%2058%200%2026%2012%2053%2050%2078%2038-25%2050-52%2050-78%200-32-22-58-50-58Z'%20fill='url(%23body)'%20stroke='%230AF0FF'%20stroke-width='4'%20stroke-linejoin='round'%20/%3e%3cpath%20d='M80%2034c-17%200-30%2016-30%2036%200%2016%208%2034%2030%2050%2022-16%2030-34%2030-50%200-20-13-36-30-36Z'%20fill='url(%23belly)'%20/%3e%3cellipse%20cx='80'%20cy='64'%20rx='22'%20ry='24'%20fill='url(%23shine)'%20/%3e%3cpath%20d='M68%20106c-8%2010-26%2010-30%204%202-6%2012-10%2022-10%204%200%206%202%208%206Z'%20fill='%23FFB157'%20opacity='0.9'%20/%3e%3cpath%20d='M92%20106c8%2010%2026%2010%2030%204-2-6-12-10-22-10-4%200-6%202-8%206Z'%20fill='%23FFB157'%20opacity='0.9'%20/%3e%3cpath%20d='M80%2068c6%200%2012%204%2012%206s-6%204-12%204-12-2-12-4%206-6%2012-6Z'%20fill='%23F2A950'%20/%3e%3ccircle%20cx='66'%20cy='54'%20r='8'%20fill='%230A0F1F'%20/%3e%3ccircle%20cx='94'%20cy='54'%20r='8'%20fill='%230A0F1F'%20/%3e%3ccircle%20cx='64'%20cy='52'%20r='3'%20fill='%23fff'%20/%3e%3ccircle%20cx='92'%20cy='52'%20r='3'%20fill='%23fff'%20/%3e%3cpath%20d='M80%2078c-6%206-12%2010-12%2016%200%203%204%208%2012%208s12-5%2012-8c0-6-6-10-12-16Z'%20fill='%23FFB157'%20opacity='0.9'%20/%3e%3cpath%20d='M58%2086c-6-4-12-10-14-18%202-6%208-12%2014-14-6%208-6%2024%200%2032Z'%20fill='%230AF0FF'%20opacity='0.55'%20/%3e%3cpath%20d='M102%2086c6-4%2012-10%2014-18-2-6-8-12-14-14%206%208%206%2024%200%2032Z'%20fill='%230AF0FF'%20opacity='0.55'%20/%3e%3c/svg%3e",import.meta.url).href;const m=document.getElementById("game-canvas"),y=document.getElementById("ui"),n=m.getContext("2d"),b=z(),g=document.createElement("div");g.className="launch-overlay";g.style.display="none";y.appendChild(g);const w={action:(a==null?void 0:a.input.keys.swing)||"Space",restart:(a==null?void 0:a.input.keys.restart)||"KeyR"},M=V({gameId:f,container:document.body,input:b,touch:{mapping:{actionA:w.action,actionALabel:"Frapper"},showPad:!1,gestureEnabled:!1},motion:{input:b,actions:[{code:w.action,trigger:"shake"}]},hints:{touch:"Tactile : bouton Frapper.",motion:"Gyro : secoue pour frapper."}}),l=(a==null?void 0:a.difficultyParams)??{},v=l.minAngle??20,S=l.maxAngle??68,e={phase:"angle",running:!1,width:0,height:0,groundY:0,startX:120,cameraX:0,angle:A(v,S,.5),power:.5,angleTimer:0,powerTimer:0,distance:0,best:K,wind:0,penguin:{x:0,y:0,vx:0,vy:0,rotation:0},objects:[],nextSpawnX:0,particles:[],actionHeld:!1,lastBoost:0};function X(){const t=m.getBoundingClientRect(),s=devicePixelRatio||1;m.width=t.width*s,m.height=t.height*s,e.width=t.width,e.height=t.height,e.groundY=e.height*.72}X();window.addEventListener("resize",X);const j=q({update:t=>oe(t),render:fe,fps:60});function J(){const t=l.courseLength??4200,s=Math.max(6,Math.floor((l.mineCount??6)+(l.trapCount??4))),i=t/s,o=Math.max(140,l.obstacleSpacingMin??i*.55),c=Math.max(o+80,l.obstacleSpacingMax??i*1.4);return{spacingMin:o,spacingMax:c}}function Q(){const t=Math.max(1,Math.floor(l.mineCount??6)),s=Math.max(1,Math.floor(l.trapCount??4));return t/(t+s)}function ee(t){const{spacingMin:s,spacingMax:i}=J(),o=Q();for(;e.nextSpawnX<t;)e.nextSpawnX+=u(s,i),e.objects.push({x:e.nextSpawnX,type:W(o)?"mine":"trap",triggered:!1})}function te(){const t=e.cameraX-e.width*.8;e.objects=e.objects.filter(s=>s.x>=t)}function R(){const t=l.spawnAheadDistance??Math.max(1e3,e.width*2);ee(e.penguin.x+t),te()}function ne(){e.phase="angle",e.angleTimer=0,e.powerTimer=0,e.angle=A(v,S,.5),e.power=.5,e.distance=0,e.cameraX=0,e.penguin.x=e.startX,e.penguin.y=e.groundY-12,e.penguin.vx=0,e.penguin.vy=0,e.penguin.rotation=0,e.wind=u(-(l.windMax??42),l.windMax??42),e.objects=[],e.nextSpawnX=e.startX,R(),e.particles=[],e.lastBoost=0,e.actionHeld=!1}function D(){if(!a){B("Config à compléter","Ajoute configs/games/yeti.config.json",!1);return}ne(),M.show(),g.style.display="none",e.running=!0,e.phase="angle",I({type:"SESSION_START",gameId:f}),j.start()}function G(t,s){e.running=!1,e.phase="end",j.stop(),M.hide();const i=Math.floor(e.distance);I({type:t?"SESSION_WIN":"SESSION_FAIL",gameId:f,payload:{score:i}}),a&&_(f,a.saveSchemaVersion,p=>{const h=p.state.bestDistance||0;e.distance>h&&(p.state.bestDistance=i,p.bestScore=i)}),e.best=Math.max(e.best,i);const c=s??(a==null?void 0:a.uiText.help)??"";B(t?"Vol record !":"Fin du vol",`${c}<br/><strong>${i} m</strong> atteints.`)}function B(t,s,i=!0){M.hide(),g.style.display="grid";const o=(a==null?void 0:a.uiText.shortDescription)||"",c=s||(a==null?void 0:a.uiText.help)||"",p=((a==null?void 0:a.uiText.controls)||[]).map(k=>`<span class="launch-chip">${k}</span>`).join(""),h=(a==null?void 0:a.difficultyParams.winDistance)??1e3,P=(a==null?void 0:a.difficultyParams.mineCount)??7,E=(a==null?void 0:a.difficultyParams.trapCount)??5,r=`
    <div class="launch-rows">
      <div class="launch-row">
        <span class="launch-row-label">Mode</span>
        <div class="launch-row-value">
          <span class="launch-chip">Standard</span>
        </div>
      </div>
      <div class="launch-row">
        <span class="launch-row-label">Objectif</span>
        <div class="launch-row-value">
          <span class="launch-chip">${h} m</span>
        </div>
      </div>
      <div class="launch-row">
        <span class="launch-row-label">Terrain</span>
        <div class="launch-row-value">
          <span class="launch-chip">Mines ${P}</span>
          <span class="launch-chip muted">Pièges ${E}</span>
        </div>
      </div>
    </div>
  `;g.innerHTML=`
    <div class="launch-card">
      <div class="launch-head">
        <div class="launch-brand">
          <span class="launch-badge">Arcade Galaxy</span>
          <span class="launch-badge ghost">${(a==null?void 0:a.uiText.title)||"Yeti Launch"}</span>
        </div>
        <h2 class="launch-title">${t}</h2>
        ${o?`<p class="launch-subtitle">${o}</p>`:""}
      </div>
      <div class="launch-grid">
        <section class="launch-section">
          <h3 class="launch-section-title">Briefing</h3>
          <p class="launch-text">${c}</p>
        </section>
        <section class="launch-section">
          <h3 class="launch-section-title">Paramètres</h3>
          ${r}
        </section>
        <section class="launch-section">
          <h3 class="launch-section-title">Contrôles</h3>
          <div class="launch-chips">
            ${p||'<span class="launch-chip muted">Contrôles à définir</span>'}
          </div>
        </section>
      </div>
      <div class="launch-actions">
        ${i?'<button class="launch-btn primary" id="launch-start">Lancer</button>':""}
        <a class="launch-btn ghost" href="${N("/")}">Hub</a>
      </div>
    </div>
  `,M.attachOverlay(g);const F=document.getElementById("launch-start");F==null||F.addEventListener("click",D)}B((a==null?void 0:a.uiText.title)||"Lance le pingouin",(a==null?void 0:a.uiText.help)||"Appuie sur Espace pour figer l'angle, puis une seconde fois pour verrouiller la puissance. Les mines relancent ton vol, évite les pieux.");function $(t,s,i,o,c){for(let p=0;p<o;p++){const h=u(-Math.PI/2-.8,-Math.PI/2+.8);e.particles.push({x:t,y:s,vx:Math.cos(h)*u(c*.5,c),vy:Math.sin(h)*u(c*.5,c),life:u(.4,.9),color:i})}}function ae(t){const s=l.mineLift??1200,i=l.mineBoost??260;e.penguin.vy=-s*u(.92,1.1),e.penguin.vx+=i*u(.85,1.2),e.lastBoost=.5,$(t.x,e.groundY-4,"rgba(255,255,255,0.9)",24,520),I({type:"MINE_BOOST",gameId:f})}function se(t){$(t.x,e.groundY-8,"rgba(255,116,116,0.9)",16,360),e.penguin.vx=0,e.penguin.vy=0,e.penguin.rotation=0,G(!1,"Le pingouin est stoppé net par un piège !")}function ie(t,s){const i=Math.min(t,s)-26,o=Math.max(t,s)+26;for(const c of e.objects)if(!c.triggered&&c.x>=i&&c.x<=o){c.triggered=!0,c.type==="mine"?ae(c):se(c);return}}function oe(t){if(!a||e.phase==="end")return;if(b.isDown(w.restart)&&!e.running){D();return}const i=b.isDown(w.action),o=i&&!e.actionHeld;if(e.actionHeld=i,!!e.running){if(e.phase==="angle"){e.angleTimer+=t*(l.aimSpeed??2.4);const c=(Math.sin(e.angleTimer)+1)/2;e.angle=A(v,S,c),o&&(e.phase="power",e.powerTimer=0)}else e.phase==="power"?(e.powerTimer+=t*(l.powerSpeed??3.1),e.power=(Math.sin(e.powerTimer)+1)/2,o&&ce()):e.phase==="flight"&&(le(t),o&&e.penguin.y>=e.groundY-40&&e.penguin.vy>-60&&(e.penguin.vy=-220,e.penguin.vx+=40));e.lastBoost>0&&(e.lastBoost=Math.max(0,e.lastBoost-t))}}function ce(){const t=l.basePower??900,s=e.angle*Math.PI/180,i=t*(.45+e.power*.75);e.penguin.vx=Math.cos(s)*i+e.wind*.8,e.penguin.vy=-Math.sin(s)*i,e.phase="flight"}function le(t){const s=l.gravity??1700,i=l.airDrag??60,o=l.groundDrag??220,c=e.penguin.x;e.penguin.vy+=s*t;const p=Math.sign(e.penguin.vx)*i*t;e.penguin.vx=Math.sign(e.penguin.vx)*Math.max(0,Math.abs(e.penguin.vx)-Math.abs(p)),e.penguin.vx+=e.wind/8*t,e.penguin.vx=Math.max(0,e.penguin.vx),e.penguin.x+=e.penguin.vx*t,e.penguin.y+=e.penguin.vy*t,R();let h=!1;if(e.penguin.y>=e.groundY){e.penguin.y=e.groundY,h=!0;const r=Math.abs(e.penguin.vy);if(r>240?(e.penguin.vy=-r*(l.bounceFactor??.58),e.penguin.vx*=.98,$(e.penguin.x,e.groundY-2,"rgba(255,255,255,0.8)",10,280)):(e.penguin.vy=0,e.penguin.vx=Math.max(0,e.penguin.vx-o*t)),ie(c,e.penguin.x),!e.running)return}e.distance=Math.max(0,e.penguin.x-e.startX),e.cameraX=Math.max(0,e.penguin.x-e.width*.35),e.penguin.rotation=Math.atan2(e.penguin.vy,e.penguin.vx);const P=e.phase==="flight"?.01:0;if(e.wind=x(e.wind+u(-1,1)*P,-(l.windMax??42),l.windMax??42),h&&e.lastBoost<=.05&&Math.abs(e.penguin.vx)<12&&Math.abs(e.penguin.vy)<10){const r=l.winDistance??900;G(e.distance>=r)}e.particles=e.particles.map(r=>({...r,life:r.life-t,x:r.x+r.vx*t,y:r.y+r.vy*t+18*t})).filter(r=>r.life>.05)}function re(){const t=n.createLinearGradient(0,0,0,e.height);t.addColorStop(0,"rgba(108, 190, 255, 0.4)"),t.addColorStop(.5,"rgba(23, 49, 87, 0.6)"),t.addColorStop(1,"rgba(8, 18, 33, 1)"),n.fillStyle=t,n.fillRect(0,0,e.width,e.height),n.save(),n.translate(-e.cameraX*.15,0);const s=e.height*.42;n.fillStyle="rgba(255,255,255,0.14)",n.beginPath(),n.moveTo(-200,s+20);for(let i=0;i<6;i++){const o=i*240+60;n.lineTo(o,s+u(-40,30))}n.lineTo(e.width+400,s+60),n.lineTo(e.width+400,e.height),n.lineTo(-200,e.height),n.closePath(),n.fill(),n.restore()}function pe(){n.save(),n.translate(-e.cameraX,0),n.fillStyle="rgba(15, 32, 50, 0.9)";const t=e.cameraX-400,s=e.cameraX+e.width+400;n.fillRect(t,e.groundY,s-t,e.height-e.groundY),n.fillStyle="rgba(255,255,255,0.6)";const i=140,o=80,c=Math.floor(t/i)*i;for(let p=c;p<s;p+=i)n.fillRect(p,e.groundY-6,o,2);n.restore()}function de(){n.save(),n.translate(-e.cameraX,0);for(const t of e.objects)t.type==="mine"?(n.fillStyle=t.triggered?"rgba(255,255,255,0.4)":"rgba(255,255,255,0.9)",n.beginPath(),n.arc(t.x,e.groundY-6,14,0,Math.PI*2),n.fill(),n.fillStyle="rgba(91, 179, 255, 0.9)",n.fillRect(t.x-10,e.groundY-20,20,8)):(n.fillStyle="rgba(255,116,116,0.9)",n.beginPath(),n.moveTo(t.x-10,e.groundY),n.lineTo(t.x,e.groundY-30),n.lineTo(t.x+10,e.groundY),n.closePath(),n.fill());n.restore()}function ue(){var i;n.save(),n.translate(-e.cameraX,0);const t=e.startX-48,s=e.groundY-46;n.fillStyle="rgba(255,255,255,0.85)",n.beginPath(),n.roundRect(t-12,s,52,58,12),n.fill(),n.fillStyle="rgba(0,0,0,0.4)",n.fillRect(t+12,s+10,18,10),n.strokeStyle=((i=d==null?void 0:d.colors)==null?void 0:i.accent)||"#4dddbb",n.lineWidth=5,n.beginPath(),n.moveTo(t-6,s+10),n.lineTo(t+40,s-18),n.stroke(),n.restore()}function he(){n.save(),n.translate(-e.cameraX+e.penguin.x,e.penguin.y),n.rotate(e.penguin.rotation);const t=56;C.complete?n.drawImage(C,-t/2,-t/2,t,t):(n.fillStyle="rgba(255,255,255,0.9)",n.beginPath(),n.arc(0,0,t/3,0,Math.PI*2),n.fill()),n.restore()}function ge(){n.save(),n.translate(-e.cameraX,0);for(const t of e.particles)n.globalAlpha=x(t.life,0,1),n.fillStyle=t.color,n.beginPath(),n.arc(t.x,t.y,3,0,Math.PI*2),n.fill();n.globalAlpha=1,n.restore()}function fe(){const t=Math.round(m.clientWidth),s=Math.round(m.clientHeight);(t!==Math.round(e.width)||s!==Math.round(e.height))&&X(),n.save(),n.scale(devicePixelRatio,devicePixelRatio),n.clearRect(0,0,e.width,e.height),re(),pe(),de(),ue(),he(),ge(),n.restore(),me()}function me(){y.innerHTML="",y.appendChild(g);const t=document.createElement("div");t.className="hud";const s=e.phase==="angle"?"Choisis l'angle":e.phase==="power"?"Charge la frappe":e.phase==="flight"?"En vol":"Pause",i=x((e.angle-v)/(S-v),0,1)*100,o=x(e.power,0,1)*100;t.innerHTML=`
    <div class="pill">Distance ${Math.floor(e.distance)} m</div>
    <div class="pill">Record ${Math.floor(e.best)} m</div>
    <div class="pill">Vent ${e.wind.toFixed(0)} km/h</div>
    <div class="pill">${s}</div>
    <div class="meters">
      <div class="meter">
        <div class="label">Angle</div>
        <div class="bar"><span style="width:${i}%"></span></div>
        <small>${e.angle.toFixed(0)}°</small>
      </div>
      <div class="meter">
        <div class="label">Puissance</div>
        <div class="bar"><span style="width:${o}%"></span></div>
        <small>${Math.round(o)}%</small>
      </div>
    </div>
  `,y.appendChild(t)}
