import{m as D,e as R,f as $,p as N,w as O,k as b,t as j}from"./index-Cmf_HX6D.js";import{c as U,a as z}from"./input-BfI4bNy9.js";import{c as K}from"./loop-24SuRqx9.js";const V="data:image/svg+xml,%3csvg%20width='64'%20height='64'%20viewBox='0%200%2064%2064'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3crect%20x='4'%20y='4'%20width='56'%20height='56'%20rx='10'%20fill='url(%23g)'%20stroke='%237CFFE1'%20stroke-width='4'/%3e%3cdefs%3e%3clinearGradient%20id='g'%20x1='0'%20y1='0'%20x2='1'%20y2='1'%3e%3cstop%20stop-color='%237CFFE1'/%3e%3cstop%20offset='1'%20stop-color='%230E1B2F'/%3e%3c/linearGradient%3e%3c/defs%3e%3c/svg%3e",X="data:image/svg+xml,%3csvg%20width='64'%20height='64'%20viewBox='0%200%2064%2064'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3crect%20x='4'%20y='4'%20width='56'%20height='56'%20rx='10'%20fill='url(%23g)'%20stroke='%237B8CFF'%20stroke-width='4'/%3e%3cdefs%3e%3clinearGradient%20id='g'%20x1='0'%20y1='0'%20x2='1'%20y2='1'%3e%3cstop%20stop-color='%237B8CFF'/%3e%3cstop%20offset='1'%20stop-color='%230E1B2F'/%3e%3c/linearGradient%3e%3c/defs%3e%3c/svg%3e",Y="data:image/svg+xml,%3csvg%20width='64'%20height='64'%20viewBox='0%200%2064%2064'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3crect%20x='4'%20y='4'%20width='56'%20height='56'%20rx='10'%20fill='url(%23g)'%20stroke='%23FF7EE2'%20stroke-width='4'/%3e%3cdefs%3e%3clinearGradient%20id='g'%20x1='0'%20y1='0'%20x2='1'%20y2='1'%3e%3cstop%20stop-color='%23FF7EE2'/%3e%3cstop%20offset='1'%20stop-color='%230E1B2F'/%3e%3c/linearGradient%3e%3c/defs%3e%3c/svg%3e",q="data:image/svg+xml,%3csvg%20width='64'%20height='64'%20viewBox='0%200%2064%2064'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3crect%20x='4'%20y='4'%20width='56'%20height='56'%20rx='10'%20fill='url(%23g)'%20stroke='%23FFC36A'%20stroke-width='4'/%3e%3cdefs%3e%3clinearGradient%20id='g'%20x1='0'%20y1='0'%20x2='1'%20y2='1'%3e%3cstop%20stop-color='%23FFC36A'/%3e%3cstop%20offset='1'%20stop-color='%230E1B2F'/%3e%3c/linearGradient%3e%3c/defs%3e%3c/svg%3e",J="data:image/svg+xml,%3csvg%20width='64'%20height='64'%20viewBox='0%200%2064%2064'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3crect%20x='4'%20y='4'%20width='56'%20height='56'%20rx='10'%20fill='url(%23g)'%20stroke='%237AF0FF'%20stroke-width='4'/%3e%3cdefs%3e%3clinearGradient%20id='g'%20x1='0'%20y1='0'%20x2='1'%20y2='1'%3e%3cstop%20stop-color='%237AF0FF'/%3e%3cstop%20offset='1'%20stop-color='%230E1B2F'/%3e%3c/linearGradient%3e%3c/defs%3e%3c/svg%3e",Q="data:image/svg+xml,%3csvg%20width='64'%20height='64'%20viewBox='0%200%2064%2064'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3crect%20x='4'%20y='4'%20width='56'%20height='56'%20rx='10'%20fill='url(%23g)'%20stroke='%237CFFA5'%20stroke-width='4'/%3e%3cdefs%3e%3clinearGradient%20id='g'%20x1='0'%20y1='0'%20x2='1'%20y2='1'%3e%3cstop%20stop-color='%237CFFA5'/%3e%3cstop%20offset='1'%20stop-color='%230E1B2F'/%3e%3c/linearGradient%3e%3c/defs%3e%3c/svg%3e",Z="data:image/svg+xml,%3csvg%20width='64'%20height='64'%20viewBox='0%200%2064%2064'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3crect%20x='4'%20y='4'%20width='56'%20height='56'%20rx='10'%20fill='url(%23g)'%20stroke='%23A987FF'%20stroke-width='4'/%3e%3cdefs%3e%3clinearGradient%20id='g'%20x1='0'%20y1='0'%20x2='1'%20y2='1'%3e%3cstop%20stop-color='%23A987FF'/%3e%3cstop%20offset='1'%20stop-color='%230E1B2F'/%3e%3c/linearGradient%3e%3c/defs%3e%3c/svg%3e",m="tetris",r=D(m),_=R(),p=r&&_.find(t=>t.id===r.themeId)||_[0];$();const ee=Array.from({length:8},(t,o)=>{if(o===0)return null;const s=new Image;return s.src=new URL(Object.assign({"../assets/block1.svg":V,"../assets/block2.svg":X,"../assets/block3.svg":Y,"../assets/block4.svg":q,"../assets/block5.svg":J,"../assets/block6.svg":Q,"../assets/block7.svg":Z})[`../assets/block${o}.svg`],import.meta.url).href,s});if(p){const t=document.documentElement.style;t.setProperty("--color-primary",p.colors.primary),t.setProperty("--color-secondary",p.colors.secondary),t.setProperty("--color-accent",p.colors.accent),t.setProperty("--color-text",p.colors.text),t.setProperty("--color-muted",p.colors.muted),document.body.style.background=p.gradient||document.body.style.background}const y=document.getElementById("game-canvas"),x=document.getElementById("ui"),l=y.getContext("2d"),v=U(),f=document.createElement("div");f.className="launch-overlay";f.style.display="none";x.appendChild(f);const I=[[[1,1,1,1],[0,0,0,0],[0,0,0,0],[0,0,0,0]],[[2,2],[2,2]],[[0,3,0],[3,3,3],[0,0,0]],[[4,0,0],[4,4,4],[0,0,0]],[[0,0,5],[5,5,5],[0,0,0]],[[0,6,6],[6,6,0],[0,0,0]],[[7,7,0],[0,7,7],[0,0,0]]],e={running:!1,width:0,height:0,cell:24,boardWidth:(r==null?void 0:r.difficultyParams.boardWidth)??10,boardHeight:(r==null?void 0:r.difficultyParams.boardHeight)??20,board:[],current:null,next:null,dropTimer:0,dropInterval:(r==null?void 0:r.difficultyParams.dropIntervalMs)??800,baseDropInterval:(r==null?void 0:r.difficultyParams.dropIntervalMs)??800,speedUpFactor:(r==null?void 0:r.difficultyParams.speedUpFactor)??.92,lines:0,level:1,score:0,targetLines:(r==null?void 0:r.difficultyParams.linesToWin)??24},c={left:(r==null?void 0:r.input.keys.left)||"ArrowLeft",right:(r==null?void 0:r.input.keys.right)||"ArrowRight",down:(r==null?void 0:r.input.keys.down)||"ArrowDown",rotate:(r==null?void 0:r.input.keys.rotate)||"ArrowUp",drop:(r==null?void 0:r.input.keys.drop)||"Space"},E=z({container:document.body,input:v,mapping:{left:c.left,right:c.right,down:c.down,up:c.rotate,actionA:c.rotate,actionALabel:"Rotate",actionB:c.drop,actionBLabel:"Drop"},autoShow:!1,showPad:!1}),u={};function L(){y.width=window.innerWidth*devicePixelRatio,y.height=window.innerHeight*devicePixelRatio,e.width=y.width/devicePixelRatio,e.height=y.height/devicePixelRatio;const t=Math.floor(e.width/(e.boardWidth+6)),o=Math.floor(e.height/(e.boardHeight+2));e.cell=N(Math.min(t,o),18,36)}L();window.addEventListener("resize",L);const S=K({update:t=>ce(t),render:de,fps:60});function te(){e.board=Array.from({length:e.boardHeight},()=>Array(e.boardWidth).fill(0))}function F(){const t=Math.floor(Math.random()*I.length);return{matrix:I[t].map(o=>[...o]),x:Math.floor(e.boardWidth/2)-2,y:0,id:t}}function re(t){const o=t.length,s=Array.from({length:o},()=>Array(o).fill(0));for(let n=0;n<o;n++)for(let i=0;i<o;i++)s[i][o-1-n]=t[n][i];return s}function w(t,o,s){const n=t.matrix;for(let i=0;i<n.length;i++)for(let a=0;a<n[i].length;a++){if(!n[i][a])continue;const d=t.x+a+o,h=t.y+i+s;if(d<0||d>=e.boardWidth||h>=e.boardHeight||h>=0&&e.board[h][d])return!0}return!1}function P(){e.current=e.next??F(),e.current.x=Math.floor(e.boardWidth/2)-2,e.current.y=-1,e.next=F(),w(e.current,0,0)&&H(!1)}function C(){if(!e.current)return;const t=e.current.matrix;for(let o=0;o<t.length;o++)for(let s=0;s<t[o].length;s++){if(!t[o][s])continue;const n=e.current.x+s,i=e.current.y+o;i>=0&&i<e.boardHeight&&n>=0&&n<e.boardWidth&&(e.board[i][n]=t[o][s])}}function G(){const t=[];for(let s=e.boardHeight-1;s>=0;s--)e.board[s].every(n=>n!==0)&&t.push(s);if(!t.length)return;for(t.forEach(s=>e.board.splice(s,1));e.board.length<e.boardHeight;)e.board.unshift(Array(e.boardWidth).fill(0));e.lines+=t.length;const o=[0,100,300,500,800];e.score+=(o[t.length]||1e3)*e.level;for(let s=0;s<t.length;s++)b({type:"LINES_CLEARED",gameId:m});t.length===4&&b({type:"TETRIS_CLEAR",gameId:m,payload:{lines:4}}),e.level=1+Math.floor(e.lines/10),e.dropInterval=e.baseDropInterval*Math.pow(e.speedUpFactor,e.level-1),e.lines>=e.targetLines&&H(!0)}function se(){if(!e.current)return;let t=0;for(;!w(e.current,0,t+1);)t++;e.current.y+=t,C(),G(),P()}function A(t){!e.current||w(e.current,t,0)||(e.current.x+=t)}function oe(){if(!e.current)return;const t=re(e.current.matrix),o=[[0,0],[1,0],[-1,0],[0,-1]];for(const[s,n]of o){const i={...e.current,matrix:t,x:e.current.x+s,y:e.current.y+n};if(!w(i,0,0)){e.current.matrix=t,e.current.x=i.x,e.current.y=i.y;return}}}function ne(t){e.dropTimer+=t*1e3*3}function ie(t){e.dropTimer+=t*1e3,!(e.dropTimer<e.dropInterval)&&(e.dropTimer=0,e.current&&(w(e.current,0,1)?(C(),G(),P()):e.current.y+=1))}function le(){if(!r){T("Config à compléter","Crée configs/games/tetris.config.json",!1);return}E.show(),e.running=!0,e.lines=0,e.level=1,e.score=0,e.dropInterval=e.baseDropInterval,e.dropTimer=0,e.current=null,e.next=F(),te(),P(),f.style.display="none",b({type:"SESSION_START",gameId:m}),S.start()}function H(t){e.running=!1,S.stop(),E.hide(),b({type:t?"SESSION_WIN":"SESSION_FAIL",gameId:m,payload:{score:e.score,lines:e.lines}}),r&&j(m,r.saveSchemaVersion,s=>{const n=s.state.bestLines||0;e.lines>n&&(s.state.bestLines=e.lines,s.bestScore=e.lines)}),T(t?"GG, objectif atteint !":"Pile trop haute !",(r==null?void 0:r.uiText.help)||"Rejoue pour battre ton record.")}function ae(t){const o=v.isDown(c.left),s=v.isDown(c.right),n=v.isDown(c.rotate),i=v.isDown(c.drop),a=v.isDown(c.down);o&&!u.left&&A(-1),s&&!u.right&&A(1),n&&!u.rotate&&oe(),i&&!u.drop&&se(),a&&ne(t),u.left=o,u.right=s,u.rotate=n,u.drop=i}function ce(t){!e.running||!r||(ae(t),ie(t))}function de(){l.save(),l.scale(devicePixelRatio,devicePixelRatio),l.clearRect(0,0,e.width,e.height),l.fillStyle="rgba(255,255,255,0.03)",l.fillRect(0,0,e.width,e.height);const t=(e.width-e.boardWidth*e.cell)/2,o=(e.height-e.boardHeight*e.cell)/2;l.strokeStyle="rgba(255,255,255,0.08)";for(let s=0;s<=e.boardWidth;s++)l.beginPath(),l.moveTo(t+s*e.cell,o),l.lineTo(t+s*e.cell,o+e.boardHeight*e.cell),l.stroke();for(let s=0;s<=e.boardHeight;s++)l.beginPath(),l.moveTo(t,o+s*e.cell),l.lineTo(t+e.boardWidth*e.cell,o+s*e.cell),l.stroke();for(let s=0;s<e.boardHeight;s++)for(let n=0;n<e.boardWidth;n++){const i=e.board[s][n];i&&B(n,s,i,t,o)}if(e.current){const s=e.current.matrix;for(let n=0;n<s.length;n++)for(let i=0;i<s[n].length;i++){if(!s[n][i])continue;const a=s[n][i];B(e.current.x+i,e.current.y+n,a,t,o,!0)}}l.restore(),he()}function B(t,o,s,n,i,a=!1){const d=n+t*e.cell,h=i+o*e.cell,g=ee[s];g!=null&&g.complete?l.drawImage(g,d+1,h+1,e.cell-2,e.cell-2):(l.fillStyle=p.colors.primary,l.fillRect(d+1,h+1,e.cell-2,e.cell-2)),l.strokeStyle=a?"rgba(255,255,255,0.6)":"rgba(255,255,255,0.2)",l.strokeRect(d+.5,h+.5,e.cell-1,e.cell-1)}function he(){x.innerHTML="",x.appendChild(f);const t=document.createElement("div");t.className="hud",t.innerHTML=`
    <div class="pill">Lignes ${e.lines}/${e.targetLines}</div>
    <div class="pill">Niveau ${e.level}</div>
    <div class="pill">Score ${e.score}</div>
  `,x.appendChild(t)}function T(t,o,s=!0){E.hide(),f.style.display="grid";const n=(r==null?void 0:r.uiText.shortDescription)||"",i=o||(r==null?void 0:r.uiText.help)||"",a=((r==null?void 0:r.uiText.controls)||[]).map(M=>`<span class="launch-chip">${M}</span>`).join(""),d=(r==null?void 0:r.difficultyParams.linesToWin)??24,h=(r==null?void 0:r.difficultyParams.boardWidth)??10,g=(r==null?void 0:r.difficultyParams.boardHeight)??20,W=`
    <div class="launch-rows">
      <div class="launch-row">
        <span class="launch-row-label">Mode</span>
        <div class="launch-row-value">
          <span class="launch-chip">Standard</span>
        </div>
      </div>
      <div class="launch-row">
        <span class="launch-row-label">Objectif</span>
        <div class="launch-row-value">
          <span class="launch-chip">${d} lignes</span>
        </div>
      </div>
      <div class="launch-row">
        <span class="launch-row-label">Grille</span>
        <div class="launch-row-value">
          <span class="launch-chip">${h}x${g}</span>
        </div>
      </div>
    </div>
  `;f.innerHTML=`
    <div class="launch-card">
      <div class="launch-head">
        <div class="launch-brand">
          <span class="launch-badge">Arcade Galaxy</span>
          <span class="launch-badge ghost">${(r==null?void 0:r.uiText.title)||"Tetris Mini"}</span>
        </div>
        <h2 class="launch-title">${t}</h2>
        ${n?`<p class="launch-subtitle">${n}</p>`:""}
      </div>
      <div class="launch-grid">
        <section class="launch-section">
          <h3 class="launch-section-title">Briefing</h3>
          <p class="launch-text">${i}</p>
        </section>
        <section class="launch-section">
          <h3 class="launch-section-title">Paramètres</h3>
          ${W}
        </section>
        <section class="launch-section">
          <h3 class="launch-section-title">Contrôles</h3>
          <div class="launch-chips">
            ${a||'<span class="launch-chip muted">Contrôles à définir</span>'}
          </div>
        </section>
      </div>
      <div class="launch-actions">
        ${s?'<button class="launch-btn primary" id="launch-start">Lancer</button>':""}
        <a class="launch-btn ghost" href="${O("/")}">Hub</a>
      </div>
    </div>
  `;const k=document.getElementById("launch-start");k==null||k.addEventListener("click",le)}T((r==null?void 0:r.uiText.title)||"Tetris Mini",(r==null?void 0:r.uiText.help)||"");
