import{l as X,e as N,f as Y,p as j,w as U,n as _,s as z}from"./index-CK9lGSzJ.js";/* empty css                    */import{c as K,a as V}from"./input-C49DsMBr.js";import{c as q}from"./loop-24SuRqx9.js";const J="data:image/svg+xml,%3csvg%20width='64'%20height='64'%20viewBox='0%200%2064%2064'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3crect%20x='4'%20y='4'%20width='56'%20height='56'%20rx='10'%20fill='url(%23g)'%20stroke='%237CFFE1'%20stroke-width='4'/%3e%3cdefs%3e%3clinearGradient%20id='g'%20x1='0'%20y1='0'%20x2='1'%20y2='1'%3e%3cstop%20stop-color='%237CFFE1'/%3e%3cstop%20offset='1'%20stop-color='%230E1B2F'/%3e%3c/linearGradient%3e%3c/defs%3e%3c/svg%3e",Q="data:image/svg+xml,%3csvg%20width='64'%20height='64'%20viewBox='0%200%2064%2064'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3crect%20x='4'%20y='4'%20width='56'%20height='56'%20rx='10'%20fill='url(%23g)'%20stroke='%237B8CFF'%20stroke-width='4'/%3e%3cdefs%3e%3clinearGradient%20id='g'%20x1='0'%20y1='0'%20x2='1'%20y2='1'%3e%3cstop%20stop-color='%237B8CFF'/%3e%3cstop%20offset='1'%20stop-color='%230E1B2F'/%3e%3c/linearGradient%3e%3c/defs%3e%3c/svg%3e",Z="data:image/svg+xml,%3csvg%20width='64'%20height='64'%20viewBox='0%200%2064%2064'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3crect%20x='4'%20y='4'%20width='56'%20height='56'%20rx='10'%20fill='url(%23g)'%20stroke='%23FF7EE2'%20stroke-width='4'/%3e%3cdefs%3e%3clinearGradient%20id='g'%20x1='0'%20y1='0'%20x2='1'%20y2='1'%3e%3cstop%20stop-color='%23FF7EE2'/%3e%3cstop%20offset='1'%20stop-color='%230E1B2F'/%3e%3c/linearGradient%3e%3c/defs%3e%3c/svg%3e",ee="data:image/svg+xml,%3csvg%20width='64'%20height='64'%20viewBox='0%200%2064%2064'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3crect%20x='4'%20y='4'%20width='56'%20height='56'%20rx='10'%20fill='url(%23g)'%20stroke='%23FFC36A'%20stroke-width='4'/%3e%3cdefs%3e%3clinearGradient%20id='g'%20x1='0'%20y1='0'%20x2='1'%20y2='1'%3e%3cstop%20stop-color='%23FFC36A'/%3e%3cstop%20offset='1'%20stop-color='%230E1B2F'/%3e%3c/linearGradient%3e%3c/defs%3e%3c/svg%3e",te="data:image/svg+xml,%3csvg%20width='64'%20height='64'%20viewBox='0%200%2064%2064'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3crect%20x='4'%20y='4'%20width='56'%20height='56'%20rx='10'%20fill='url(%23g)'%20stroke='%237AF0FF'%20stroke-width='4'/%3e%3cdefs%3e%3clinearGradient%20id='g'%20x1='0'%20y1='0'%20x2='1'%20y2='1'%3e%3cstop%20stop-color='%237AF0FF'/%3e%3cstop%20offset='1'%20stop-color='%230E1B2F'/%3e%3c/linearGradient%3e%3c/defs%3e%3c/svg%3e",re="data:image/svg+xml,%3csvg%20width='64'%20height='64'%20viewBox='0%200%2064%2064'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3crect%20x='4'%20y='4'%20width='56'%20height='56'%20rx='10'%20fill='url(%23g)'%20stroke='%237CFFA5'%20stroke-width='4'/%3e%3cdefs%3e%3clinearGradient%20id='g'%20x1='0'%20y1='0'%20x2='1'%20y2='1'%3e%3cstop%20stop-color='%237CFFA5'/%3e%3cstop%20offset='1'%20stop-color='%230E1B2F'/%3e%3c/linearGradient%3e%3c/defs%3e%3c/svg%3e",oe="data:image/svg+xml,%3csvg%20width='64'%20height='64'%20viewBox='0%200%2064%2064'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3crect%20x='4'%20y='4'%20width='56'%20height='56'%20rx='10'%20fill='url(%23g)'%20stroke='%23A987FF'%20stroke-width='4'/%3e%3cdefs%3e%3clinearGradient%20id='g'%20x1='0'%20y1='0'%20x2='1'%20y2='1'%3e%3cstop%20stop-color='%23A987FF'/%3e%3cstop%20offset='1'%20stop-color='%230E1B2F'/%3e%3c/linearGradient%3e%3c/defs%3e%3c/svg%3e",y="tetris",r=X(y),E=N(),f=r&&E.find(t=>t.id===r.themeId)||E[0];Y();const se=Array.from({length:8},(t,o)=>{if(o===0)return null;const s=new Image;return s.src=new URL(Object.assign({"../assets/block1.svg":J,"../assets/block2.svg":Q,"../assets/block3.svg":Z,"../assets/block4.svg":ee,"../assets/block5.svg":te,"../assets/block6.svg":re,"../assets/block7.svg":oe})[`../assets/block${o}.svg`],import.meta.url).href,s});if(f){const t=document.documentElement.style;t.setProperty("--color-primary",f.colors.primary),t.setProperty("--color-secondary",f.colors.secondary),t.setProperty("--color-accent",f.colors.accent),t.setProperty("--color-text",f.colors.text),t.setProperty("--color-muted",f.colors.muted),document.body.style.background=f.gradient||document.body.style.background}const h=document.getElementById("game-canvas"),k=document.getElementById("ui"),d=h.getContext("2d"),m=K(),v=document.createElement("div");v.className="launch-overlay";v.style.display="none";k.appendChild(v);const G=[[[1,1,1,1],[0,0,0,0],[0,0,0,0],[0,0,0,0]],[[2,2],[2,2]],[[0,3,0],[3,3,3],[0,0,0]],[[4,0,0],[4,4,4],[0,0,0]],[[0,0,5],[5,5,5],[0,0,0]],[[0,6,6],[6,6,0],[0,0,0]],[[7,7,0],[0,7,7],[0,0,0]]],e={running:!1,width:0,height:0,cell:24,boardWidth:(r==null?void 0:r.difficultyParams.boardWidth)??10,boardHeight:(r==null?void 0:r.difficultyParams.boardHeight)??20,board:[],current:null,next:null,dropTimer:0,dropInterval:(r==null?void 0:r.difficultyParams.dropIntervalMs)??800,baseDropInterval:(r==null?void 0:r.difficultyParams.dropIntervalMs)??800,speedUpFactor:(r==null?void 0:r.difficultyParams.speedUpFactor)??.92,lines:0,level:1,score:0,targetLines:(r==null?void 0:r.difficultyParams.linesToWin)??24},g={left:(r==null?void 0:r.input.keys.left)||"ArrowLeft",right:(r==null?void 0:r.input.keys.right)||"ArrowRight",down:(r==null?void 0:r.input.keys.down)||"ArrowDown",rotate:(r==null?void 0:r.input.keys.rotate)||"ArrowUp",drop:(r==null?void 0:r.input.keys.drop)||"Space"},x=V({gameId:y,container:document.body,input:m,touch:{mapping:{actionA:g.rotate,actionALabel:"Rotate",actionB:g.drop,actionBLabel:"Drop"},showPad:!1,gestureEnabled:!1},motion:{input:m,actions:[{code:g.drop,trigger:"shake"}]},hints:{touch:"Tactile : glisse pour gauche/droite, glisse vers le bas pour descendre, boutons Rotate/Drop.",motion:"Gyro : secoue pour drop."}}),l={active:!1,x:0,y:0,startX:0,startY:0,moveCooldown:0,softDrop:!1};function I(){const{gridOffsetX:t,gridOffsetY:o}=I();return{gridOffsetX:t,gridOffsetY:o}}function D(t){const o=h.getBoundingClientRect(),s=e.width/o.width,i=e.height/o.height;return{x:(t.clientX-o.left)*s,y:(t.clientY-o.top)*i}}h.style.touchAction="none";h.addEventListener("pointerdown",t=>{if(!x.isMobile)return;const o=D(t),{gridOffsetX:s,gridOffsetY:i}=I(),n=e.boardWidth*e.cell,a=e.boardHeight*e.cell;o.x>=s&&o.x<=s+n&&o.y>=i&&o.y<=i+a&&(l.active=!0,l.x=o.x,l.y=o.y,l.startX=o.x,l.startY=o.y,l.softDrop=!1)});h.addEventListener("pointermove",t=>{if(!l.active)return;const o=D(t);l.x=o.x,l.y=o.y,l.softDrop=l.y-l.startY>e.cell*.6});const P=()=>{l.active=!1,l.softDrop=!1,l.moveCooldown=0};h.addEventListener("pointerup",P);h.addEventListener("pointercancel",P);h.addEventListener("pointerleave",P);const p={};function L(){const t=h.getBoundingClientRect(),o=devicePixelRatio||1;h.width=t.width*o,h.height=t.height*o,e.width=t.width,e.height=t.height;const s=Math.floor(e.width/(e.boardWidth+6)),i=Math.floor(e.height/(e.boardHeight+2));e.cell=j(Math.min(s,i),18,36)}L();window.addEventListener("resize",L);const H=q({update:t=>fe(t),render:ge,fps:60});function ne(){e.board=Array.from({length:e.boardHeight},()=>Array(e.boardWidth).fill(0))}function C(){const t=Math.floor(Math.random()*G.length);return{matrix:G[t].map(o=>[...o]),x:Math.floor(e.boardWidth/2)-2,y:0,id:t}}function ie(t){const o=t.length,s=Array.from({length:o},()=>Array(o).fill(0));for(let i=0;i<o;i++)for(let n=0;n<o;n++)s[n][o-1-i]=t[i][n];return s}function b(t,o,s){const i=t.matrix;for(let n=0;n<i.length;n++)for(let a=0;a<i[n].length;a++){if(!i[n][a])continue;const c=t.x+a+o,u=t.y+n+s;if(c<0||c>=e.boardWidth||u>=e.boardHeight||u>=0&&e.board[u][c])return!0}return!1}function M(){e.current=e.next??C(),e.current.x=Math.floor(e.boardWidth/2)-2,e.current.y=-1,e.next=C(),b(e.current,0,0)&&R(!1)}function S(){if(!e.current)return;const t=e.current.matrix;for(let o=0;o<t.length;o++)for(let s=0;s<t[o].length;s++){if(!t[o][s])continue;const i=e.current.x+s,n=e.current.y+o;n>=0&&n<e.boardHeight&&i>=0&&i<e.boardWidth&&(e.board[n][i]=t[o][s])}}function W(){const t=[];for(let s=e.boardHeight-1;s>=0;s--)e.board[s].every(i=>i!==0)&&t.push(s);if(!t.length)return;for(t.forEach(s=>e.board.splice(s,1));e.board.length<e.boardHeight;)e.board.unshift(Array(e.boardWidth).fill(0));e.lines+=t.length;const o=[0,100,300,500,800];e.score+=(o[t.length]||1e3)*e.level;for(let s=0;s<t.length;s++)_({type:"LINES_CLEARED",gameId:y});t.length===4&&_({type:"TETRIS_CLEAR",gameId:y,payload:{lines:4}}),e.level=1+Math.floor(e.lines/10),e.dropInterval=e.baseDropInterval*Math.pow(e.speedUpFactor,e.level-1),e.lines>=e.targetLines&&R(!0)}function le(){if(!e.current)return;let t=0;for(;!b(e.current,0,t+1);)t++;e.current.y+=t,S(),W(),M()}function T(t){!e.current||b(e.current,t,0)||(e.current.x+=t)}function ae(){if(!e.current)return;const t=ie(e.current.matrix),o=[[0,0],[1,0],[-1,0],[0,-1]];for(const[s,i]of o){const n={...e.current,matrix:t,x:e.current.x+s,y:e.current.y+i};if(!b(n,0,0)){e.current.matrix=t,e.current.x=n.x,e.current.y=n.y;return}}}function ce(t){e.dropTimer+=t*1e3*3}function de(t){e.dropTimer+=t*1e3,!(e.dropTimer<e.dropInterval)&&(e.dropTimer=0,e.current&&(b(e.current,0,1)?(S(),W(),M()):e.current.y+=1))}function he(){if(!r){B("Config à compléter","Crée configs/games/tetris.config.json",!1);return}x.show(),e.running=!0,e.lines=0,e.level=1,e.score=0,e.dropInterval=e.baseDropInterval,e.dropTimer=0,e.current=null,e.next=C(),l.active=!1,l.softDrop=!1,l.moveCooldown=0,ne(),M(),v.style.display="none",_({type:"SESSION_START",gameId:y}),H.start()}function R(t){e.running=!1,H.stop(),x.hide(),_({type:t?"SESSION_WIN":"SESSION_FAIL",gameId:y,payload:{score:e.score,lines:e.lines}}),r&&z(y,r.saveSchemaVersion,s=>{const i=s.state.bestLines||0;e.lines>i&&(s.state.bestLines=e.lines,s.bestScore=e.lines)}),B(t?"GG, objectif atteint !":"Pile trop haute !",(r==null?void 0:r.uiText.help)||"Rejoue pour battre ton record.")}function ue(){if(!l.active||!e.current)return 0;const{gridOffsetX:t}=I(),o=e.current.matrix[0].length,s=t+(e.current.x+o/2)*e.cell,i=e.cell*.35;return l.x>s+i?1:l.x<s-i?-1:0}function pe(t){l.moveCooldown>0&&(l.moveCooldown=Math.max(0,l.moveCooldown-t));const o=ue();o!==0&&l.moveCooldown===0&&(T(o),l.moveCooldown=.12);const s=!l.active&&m.isDown(g.left),i=!l.active&&m.isDown(g.right),n=m.isDown(g.rotate),a=m.isDown(g.drop),c=m.isDown(g.down)||l.softDrop;s&&!p.left&&T(-1),i&&!p.right&&T(1),n&&!p.rotate&&ae(),a&&!p.drop&&le(),c&&ce(t),p.left=s,p.right=i,p.rotate=n,p.drop=a}function fe(t){!e.running||!r||(pe(t),de(t))}function ge(){const t=Math.round(h.clientWidth),o=Math.round(h.clientHeight);(t!==Math.round(e.width)||o!==Math.round(e.height))&&L(),d.save(),d.scale(devicePixelRatio,devicePixelRatio),d.clearRect(0,0,e.width,e.height),d.fillStyle="rgba(255,255,255,0.03)",d.fillRect(0,0,e.width,e.height);const s=(e.width-e.boardWidth*e.cell)/2,i=(e.height-e.boardHeight*e.cell)/2;d.strokeStyle="rgba(255,255,255,0.08)";for(let n=0;n<=e.boardWidth;n++)d.beginPath(),d.moveTo(s+n*e.cell,i),d.lineTo(s+n*e.cell,i+e.boardHeight*e.cell),d.stroke();for(let n=0;n<=e.boardHeight;n++)d.beginPath(),d.moveTo(s,i+n*e.cell),d.lineTo(s+e.boardWidth*e.cell,i+n*e.cell),d.stroke();for(let n=0;n<e.boardHeight;n++)for(let a=0;a<e.boardWidth;a++){const c=e.board[n][a];c&&A(a,n,c,s,i)}if(e.current){const n=e.current.matrix;for(let a=0;a<n.length;a++)for(let c=0;c<n[a].length;c++){if(!n[a][c])continue;const u=n[a][c];A(e.current.x+c,e.current.y+a,u,s,i,!0)}}d.restore(),ve()}function A(t,o,s,i,n,a=!1){const c=i+t*e.cell,u=n+o*e.cell,w=se[s];w!=null&&w.complete?d.drawImage(w,c+1,u+1,e.cell-2,e.cell-2):(d.fillStyle=f.colors.primary,d.fillRect(c+1,u+1,e.cell-2,e.cell-2)),d.strokeStyle=a?"rgba(255,255,255,0.6)":"rgba(255,255,255,0.2)",d.strokeRect(c+.5,u+.5,e.cell-1,e.cell-1)}function ve(){k.innerHTML="",k.appendChild(v);const t=document.createElement("div");t.className="hud",t.innerHTML=`
    <div class="pill">Lignes ${e.lines}/${e.targetLines}</div>
    <div class="pill">Niveau ${e.level}</div>
    <div class="pill">Score ${e.score}</div>
  `,k.appendChild(t)}function B(t,o,s=!0){x.hide(),v.style.display="grid";const i=(r==null?void 0:r.uiText.shortDescription)||"",n=o||(r==null?void 0:r.uiText.help)||"",a=((r==null?void 0:r.uiText.controls)||[]).map(O=>`<span class="launch-chip">${O}</span>`).join(""),c=(r==null?void 0:r.difficultyParams.linesToWin)??24,u=(r==null?void 0:r.difficultyParams.boardWidth)??10,w=(r==null?void 0:r.difficultyParams.boardHeight)??20,$=`
    <div class="launch-rows">
      <div class="launch-row">
        <span class="launch-row-label">Mode</span>
        <div class="launch-row-value">
          <span class="launch-chip">Standard</span>
        </div>
      </div>
      <div class="launch-row">
        <span class="launch-row-label">Objectif</span>
        <div class="launch-row-value">
          <span class="launch-chip">${c} lignes</span>
        </div>
      </div>
      <div class="launch-row">
        <span class="launch-row-label">Grille</span>
        <div class="launch-row-value">
          <span class="launch-chip">${u}x${w}</span>
        </div>
      </div>
    </div>
  `;v.innerHTML=`
    <div class="launch-card">
      <div class="launch-head">
        <div class="launch-brand">
          <span class="launch-badge">Arcade Galaxy</span>
          <span class="launch-badge ghost">${(r==null?void 0:r.uiText.title)||"Tetris Mini"}</span>
        </div>
        <h2 class="launch-title">${t}</h2>
        ${i?`<p class="launch-subtitle">${i}</p>`:""}
      </div>
      <div class="launch-grid">
        <section class="launch-section">
          <h3 class="launch-section-title">Briefing</h3>
          <p class="launch-text">${n}</p>
        </section>
        <section class="launch-section">
          <h3 class="launch-section-title">Paramètres</h3>
          ${$}
        </section>
        <section class="launch-section">
          <h3 class="launch-section-title">Contrôles</h3>
          <div class="launch-chips">
            ${a||'<span class="launch-chip muted">Contrôles à définir</span>'}
          </div>
        </section>
      </div>
      <div class="launch-actions">
        ${s?'<button class="launch-btn primary" id="launch-start">Lancer</button>':""}
        <a class="launch-btn ghost" href="${U("/")}">Hub</a>
      </div>
    </div>
  `,x.attachOverlay(v);const F=document.getElementById("launch-start");F==null||F.addEventListener("click",he)}B((r==null?void 0:r.uiText.title)||"Tetris Mini",(r==null?void 0:r.uiText.help)||"");
