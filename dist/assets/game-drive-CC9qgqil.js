import{d as E,c as I,w as C,r as v,e as B}from"./loaders-CNHm-dlv.js";import{c as R,a as A}from"./input-DsLowg7g.js";import{c as H}from"./loop-24SuRqx9.js";import{a as G,c as p,d as O}from"./index-niTdxgfr.js";const d="drive",t=E(d),x=I(),c=t&&x.find(i=>i.id===t.themeId)||x[0];G();if(c){const i=document.documentElement.style;i.setProperty("--color-primary",c.colors.primary),i.setProperty("--color-secondary",c.colors.secondary),i.setProperty("--color-accent",c.colors.accent),i.setProperty("--color-text",c.colors.text),i.setProperty("--color-muted",c.colors.muted),document.body.style.background=c.gradient||document.body.style.background}const f=document.getElementById("game-canvas"),u=document.getElementById("ui"),s=f.getContext("2d"),m=R(),h=document.createElement("div");h.className="overlay";h.style.display="none";u.appendChild(h);const l={left:(t==null?void 0:t.input.keys.left)||"ArrowLeft",right:(t==null?void 0:t.input.keys.right)||"ArrowRight",boost:(t==null?void 0:t.input.keys.boost)||"ArrowUp"},T=A({container:document.body,input:m,mapping:{left:l.left,right:l.right,up:l.boost,actionA:l.boost,actionALabel:"Boost"},autoShow:!1}),S=new Image;S.src=new URL("data:image/svg+xml,%3csvg%20width='64'%20height='128'%20viewBox='0%200%2064%20128'%20xmlns='http://www.w3.org/2000/svg'%3e%3crect%20width='64'%20height='128'%20rx='10'%20fill='%23ff6b6b'/%3e%3crect%20x='10'%20y='10'%20width='44'%20height='108'%20rx='8'%20fill='%231b233a'/%3e%3crect%20x='14'%20y='16'%20width='36'%20height='30'%20rx='6'%20fill='%230bd0ff'%20opacity='0.8'/%3e%3crect%20x='14'%20y='82'%20width='36'%20height='30'%20rx='6'%20fill='%230bd0ff'%20opacity='0.8'/%3e%3crect%20x='6'%20y='32'%20width='8'%20height='20'%20rx='3'%20fill='%23ffd166'/%3e%3crect%20x='50'%20y='32'%20width='8'%20height='20'%20rx='3'%20fill='%23ffd166'/%3e%3crect%20x='6'%20y='76'%20width='8'%20height='20'%20rx='3'%20fill='%23ffd166'/%3e%3crect%20x='50'%20y='76'%20width='8'%20height='20'%20rx='3'%20fill='%23ffd166'/%3e%3c/svg%3e",import.meta.url).href;const M=new Image;M.src=new URL("data:image/svg+xml,%3csvg%20width='64'%20height='128'%20viewBox='0%200%2064%20128'%20xmlns='http://www.w3.org/2000/svg'%3e%3crect%20width='64'%20height='128'%20rx='10'%20fill='%230bd0ff'/%3e%3crect%20x='10'%20y='10'%20width='44'%20height='108'%20rx='8'%20fill='%23111624'/%3e%3crect%20x='14'%20y='18'%20width='36'%20height='28'%20rx='6'%20fill='%237af0ff'%20opacity='0.6'/%3e%3crect%20x='14'%20y='82'%20width='36'%20height='28'%20rx='6'%20fill='%237af0ff'%20opacity='0.6'/%3e%3crect%20x='6'%20y='36'%20width='8'%20height='18'%20rx='3'%20fill='%2364f4ac'/%3e%3crect%20x='50'%20y='36'%20width='8'%20height='18'%20rx='3'%20fill='%2364f4ac'/%3e%3crect%20x='6'%20y='78'%20width='8'%20height='18'%20rx='3'%20fill='%2364f4ac'/%3e%3crect%20x='50'%20y='78'%20width='8'%20height='18'%20rx='3'%20fill='%2364f4ac'/%3e%3c/svg%3e",import.meta.url).href;const P=new Image;P.src=new URL("data:image/svg+xml,%3csvg%20width='64'%20height='64'%20viewBox='0%200%2064%2064'%20xmlns='http://www.w3.org/2000/svg'%3e%3crect%20x='8'%20y='8'%20width='48'%20height='48'%20rx='12'%20fill='%2364f4ac'%20opacity='0.85'/%3e%3crect%20x='16'%20y='16'%20width='32'%20height='32'%20rx='8'%20fill='%230bd0ff'%20opacity='0.8'/%3e%3cpath%20d='M32%2014%20L36%2032%20L28%2032%20Z'%20fill='%23ffd166'/%3e%3crect%20x='30'%20y='32'%20width='4'%20height='18'%20rx='2'%20fill='%23ffd166'/%3e%3c/svg%3e",import.meta.url).href;const y=(t==null?void 0:t.difficultyParams.laneCount)??3,w=Array.from({length:y},(i,a)=>a),e={running:!1,width:0,height:0,roadWidth:0,laneWidth:0,player:{lane:1,y:.78,boost:0,cooldown:0},traffic:[],pickups:[],distance:0,speed:120,trafficTimer:0,pickupTimer:0};function L(){f.width=window.innerWidth*devicePixelRatio,f.height=window.innerHeight*devicePixelRatio,e.width=f.width/devicePixelRatio,e.height=f.height/devicePixelRatio,e.roadWidth=Math.min(520,e.width*.65),e.laneWidth=e.roadWidth/y}L();window.addEventListener("resize",L);const D=H({update:i=>F(i),render:Z,fps:60});function $(){e.player.lane=Math.floor(y/2),e.player.boost=0,e.player.cooldown=0,e.distance=0,e.traffic=[],e.pickups=[],e.speed=(t==null?void 0:t.difficultyParams.trafficSpeed)??200,e.trafficTimer=0,e.pickupTimer=0}function _(){if(!t){W("Config à compléter","Crée configs/games/drive.config.json",!1);return}T.show(),$(),e.running=!0,h.style.display="none",p({type:"SESSION_START",gameId:d}),D.start()}function N(i){e.running=!1,D.stop(),T.hide(),p({type:"SESSION_FAIL",gameId:d,payload:{score:Math.floor(e.distance)}}),t&&O(d,t.saveSchemaVersion,r=>{const o=r.state.bestDistance||0;e.distance>o&&(r.state.bestDistance=Math.floor(e.distance),r.bestScore=Math.floor(e.distance))}),W("Crash !",(t==null?void 0:t.uiText.help)||"")}function U(){const i=w[v(0,w.length-1)],a=(t==null?void 0:t.difficultyParams.trafficSpeed)??220,r=(t==null?void 0:t.difficultyParams.trafficSpeedVariance)??40,o=a+v(-r,r);e.traffic.push({lane:i,y:-.3,speed:o})}function Y(){const i=w[v(0,w.length-1)];e.pickups.push({lane:i,y:-.3})}function k(i){e.player.lane=B(e.player.lane+i,0,y-1)}function j(i){if(e.player.cooldown=Math.max(0,e.player.cooldown-i*1e3),e.player.boost=Math.max(0,e.player.boost-i*1e3),e.player.boost>0)return;m.isDown(l.boost)&&e.player.cooldown<=0&&(e.player.boost=(t==null?void 0:t.difficultyParams.boostDurationMs)??2600,e.player.cooldown=(t==null?void 0:t.difficultyParams.boostCooldownMs)??4200,p({type:"BOOST_USED",gameId:d}))}function z(){m.isDown(l.left)&&k(-1),m.isDown(l.right)&&k(1)}function V(i){e.traffic=e.traffic.map(a=>({...a,y:a.y+a.speed/e.height*i})).filter(a=>a.y<1.4),e.pickups=e.pickups.map(a=>({...a,y:a.y+e.speed/e.height*i})).filter(a=>a.y<1.4)}function X(){const i=e.height*e.player.y,a=e.laneWidth*.35;for(const r of e.traffic){if(r.lane!==e.player.lane)continue;const o=r.y*e.height;if(Math.abs(o-i)<a*1.1)if(e.player.boost>0)p({type:"OBSTACLE_DODGED",gameId:d}),e.traffic=e.traffic.filter(n=>n!==r);else{N();return}}for(const r of e.pickups){if(r.lane!==e.player.lane)continue;const o=r.y*e.height;Math.abs(o-i)<a&&(p({type:"ITEM_COLLECTED",gameId:d}),e.player.boost=((t==null?void 0:t.difficultyParams.boostDurationMs)??2600)/2,e.pickups=e.pickups.filter(n=>n!==r))}}function F(i){!e.running||!t||(e.distance+=e.speed/10*i,e.speed+=i*2,e.trafficTimer+=i*1e3,e.pickupTimer+=i*1e3,z(),j(i),V(i),e.trafficTimer>=((t==null?void 0:t.difficultyParams.trafficSpawnMs)??950)&&(e.trafficTimer=0,U()),e.pickupTimer>=((t==null?void 0:t.difficultyParams.pickupSpawnMs)??1800)&&(e.pickupTimer=0,Y()),X())}function Z(){s.save(),s.scale(devicePixelRatio,devicePixelRatio),s.clearRect(0,0,e.width,e.height);const i=e.width/2-e.roadWidth/2;s.fillStyle="rgba(255,255,255,0.04)",s.fillRect(i,0,e.roadWidth,e.height),s.strokeStyle="rgba(255,255,255,0.1)";for(let o=1;o<y;o++){const n=i+o*e.laneWidth;s.setLineDash([12,12]),s.beginPath(),s.moveTo(n,0),s.lineTo(n,e.height),s.stroke()}s.setLineDash([]);const a=i+e.player.lane*e.laneWidth+e.laneWidth/2-e.laneWidth*.25,r=e.height*e.player.y-e.laneWidth*.5;b(S,a,r,e.laneWidth*.5,e.laneWidth*.9),e.traffic.forEach(o=>{const n=i+o.lane*e.laneWidth+e.laneWidth/2-e.laneWidth*.25,g=o.y*e.height-e.laneWidth*.5;b(M,n,g,e.laneWidth*.5,e.laneWidth*.9)}),e.pickups.forEach(o=>{const n=i+o.lane*e.laneWidth+e.laneWidth/2-e.laneWidth*.25,g=o.y*e.height-e.laneWidth*.25;b(P,n,g,e.laneWidth*.5,e.laneWidth*.5)}),s.restore(),q()}function b(i,a,r,o,n){i.complete?s.drawImage(i,a,r,o,n):(s.fillStyle=c.colors.primary,s.fillRect(a,r,o,n))}function q(){u.innerHTML="",u.appendChild(h);const i=document.createElement("div");i.className="hud";const a=Math.max(0,Math.floor(e.player.boost/100)/10),r=Math.max(0,Math.floor(e.player.cooldown/100)/10);i.innerHTML=`
    <div class="pill">Distance ${Math.floor(e.distance)} m</div>
    <div class="pill">Boost ${a?a+"s":"prêt"} · CD ${r?r+"s":"0s"}</div>
    <div class="pill">Trafic ${e.traffic.length}</div>
  `,u.appendChild(i)}function W(i,a,r=!0){T.hide(),h.style.display="grid",h.innerHTML=`
    <div class="panel">
      <p class="pill">Neon Drive</p>
      <h2>${i}</h2>
      <p>${a}</p>
      <div style="display:flex; gap:10px; justify-content:center; margin-top:12px;">
        ${r?'<button class="btn" id="play-btn">Lancer</button>':""}
        <a class="btn secondary" href="${C("/apps/hub/")}">Hub</a>
      </div>
      <p class="legend">Contrôles : Gauche/Droite pour changer de voie · Haut pour boost.</p>
    </div>
  `;const o=document.getElementById("play-btn");o==null||o.addEventListener("click",_)}W((t==null?void 0:t.uiText.title)||"Neon Drive",(t==null?void 0:t.uiText.help)||"Évite les voitures et ramasse les boosts.");
