import{d as R,c as $,w as G,r as n,e as F}from"./loaders-CNHm-dlv.js";import{c as B,a as U}from"./input-xiSeUQqn.js";import{c as H}from"./loop-24SuRqx9.js";import{a as q,c as f,d as O}from"./index-niTdxgfr.js";const m="quest",t=R(m),k=$(),c=k.find(i=>i.id===(t==null?void 0:t.themeId))||k[0];q();const E=new Image;E.src=new URL("data:image/svg+xml,%3csvg%20width='140'%20height='160'%20viewBox='0%200%20140%20160'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cdefs%3e%3clinearGradient%20id='cloak'%20x1='0'%20y1='0'%20x2='1'%20y2='1'%3e%3cstop%20stop-color='%237CFFE1'/%3e%3cstop%20offset='1'%20stop-color='%237B8CFF'/%3e%3c/linearGradient%3e%3c/defs%3e%3cpath%20d='M70%2014c18%200%2032%2014%2032%2032v16l10%2016-10%2010v30c0%2010-8%2018-18%2018H56c-10%200-18-8-18-18v-30l-10-10%2010-16V46c0-18%2014-32%2032-32Z'%20fill='url(%23cloak)'%20stroke='%230AF0FF'%20stroke-width='4'/%3e%3ccircle%20cx='70'%20cy='54'%20r='18'%20fill='%230A0F1F'%20stroke='%23E9F5FF'%20stroke-width='4'/%3e%3crect%20x='54'%20y='96'%20width='32'%20height='36'%20rx='12'%20fill='%230A0F1F'%20opacity='0.8'/%3e%3ccircle%20cx='60'%20cy='52'%20r='5'%20fill='%23E9F5FF'/%3e%3ccircle%20cx='80'%20cy='52'%20r='5'%20fill='%23E9F5FF'/%3e%3c/svg%3e",import.meta.url).href;const C=new Image;C.src=new URL("data:image/svg+xml,%3csvg%20width='80'%20height='80'%20viewBox='0%200%2080%2080'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cdefs%3e%3cradialGradient%20id='orb'%20cx='0'%20cy='0'%20r='1'%20gradientUnits='userSpaceOnUse'%20gradientTransform='translate(40%2040)%20scale(38)'%3e%3cstop%20stop-color='%237B8CFF'/%3e%3cstop%20offset='1'%20stop-color='%230A0F24'/%3e%3c/radialGradient%3e%3c/defs%3e%3ccircle%20cx='40'%20cy='40'%20r='34'%20fill='url(%23orb)'%20stroke='%23B6C4FF'%20stroke-width='4'/%3e%3ccircle%20cx='40'%20cy='34'%20r='12'%20fill='%23E9F5FF'%20fill-opacity='0.75'/%3e%3c/svg%3e",import.meta.url).href;const I=new Image;I.src=new URL("data:image/svg+xml,%3csvg%20width='90'%20height='70'%20viewBox='0%200%2090%2070'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3crect%20x='6'%20y='28'%20width='78'%20height='20'%20rx='6'%20fill='%232D0A12'%20stroke='%23FF5F6D'%20stroke-width='4'/%3e%3cpath%20d='M10%2048%2018%2022l10%2026%2010-26%2010%2026%2010-26%2010%2026%2010-26%206%2026'%20stroke='%23FFB6BF'%20stroke-width='4'%20stroke-linecap='round'/%3e%3c/svg%3e",import.meta.url).href;const S=new Image;S.src=new URL("data:image/svg+xml,%3csvg%20width='90'%20height='140'%20viewBox='0%200%2090%20140'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3crect%20x='18'%20y='8'%20width='54'%20height='124'%20rx='10'%20fill='%230A0F1F'%20stroke='%237CFFE1'%20stroke-width='4'/%3e%3crect%20x='26'%20y='16'%20width='38'%20height='108'%20rx='8'%20fill='%230A162E'%20stroke='%2300D9F5'%20stroke-width='3'/%3e%3ccircle%20cx='45'%20cy='70'%20r='10'%20fill='%2300F5A0'/%3e%3c/svg%3e",import.meta.url).href;const L=new Image;L.src=new URL("data:image/svg+xml,%3csvg%20width='120'%20height='120'%20viewBox='0%200%20120%20120'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cdefs%3e%3clinearGradient%20id='eyeCore'%20x1='0'%20y1='0'%20x2='1'%20y2='1'%3e%3cstop%20stop-color='%237B8CFF'/%3e%3cstop%20offset='1'%20stop-color='%23FF7EE2'/%3e%3c/linearGradient%3e%3c/defs%3e%3ccircle%20cx='60'%20cy='60'%20r='52'%20fill='%230A1024'%20stroke='%237CFFE1'%20stroke-width='4'/%3e%3ccircle%20cx='60'%20cy='60'%20r='30'%20fill='url(%23eyeCore)'%20stroke='%23E9F5FF'%20stroke-width='4'/%3e%3crect%20x='46'%20y='46'%20width='28'%20height='28'%20rx='6'%20fill='%230A1024'%20/%3e%3ccircle%20cx='60'%20cy='60'%20r='12'%20fill='%2300F5A0'/%3e%3crect%20x='20'%20y='56'%20width='10'%20height='8'%20rx='4'%20fill='%23FF7EE2'/%3e%3crect%20x='90'%20y='56'%20width='10'%20height='8'%20rx='4'%20fill='%23FF7EE2'/%3e%3c/svg%3e",import.meta.url).href;if(c){const i=document.documentElement.style;i.setProperty("--color-primary",c.colors.primary),i.setProperty("--color-secondary",c.colors.secondary),i.setProperty("--color-accent",c.colors.accent),i.setProperty("--color-text",c.colors.text),i.setProperty("--color-muted",c.colors.muted),document.body.style.background=c.gradient||document.body.style.background}const w=document.getElementById("game-canvas"),b=document.getElementById("ui"),r=w.getContext("2d"),g=B(),p=document.createElement("div");p.className="overlay";p.style.display="none";b.appendChild(p);const y={up:(t==null?void 0:t.input.keys.up)||"ArrowUp",down:(t==null?void 0:t.input.keys.down)||"ArrowDown",left:(t==null?void 0:t.input.keys.left)||"ArrowLeft",right:(t==null?void 0:t.input.keys.right)||"ArrowRight"},o={easy:{label:"Facile",timeLimit:80,itemCount:6,trapCount:3,enemyCount:2,enemySpeed:1.1,hitPenalty:5},medium:{label:"Moyen",timeLimit:(t==null?void 0:t.difficultyParams.timeLimitSeconds)??60,itemCount:(t==null?void 0:t.difficultyParams.itemCount)??6,trapCount:(t==null?void 0:t.difficultyParams.trapCount)??4,enemyCount:(t==null?void 0:t.difficultyParams.enemyCount)??3,enemySpeed:(t==null?void 0:t.difficultyParams.enemySpeed)??1.5,hitPenalty:(t==null?void 0:t.difficultyParams.hitPenalty)??6},hard:{label:"Difficile",timeLimit:55,itemCount:7,trapCount:5,enemyCount:4,enemySpeed:1.8,hitPenalty:8},extreme:{label:"Extrême",timeLimit:50,itemCount:8,trapCount:6,enemyCount:5,enemySpeed:2.1,hitPenalty:10}};let x="medium";U({container:document.body,input:g,mapping:{up:y.up,down:y.down,left:y.left,right:y.right}});const e={running:!1,width:0,height:0,player:{x:0,y:0,r:12},items:[],traps:[],enemies:[],gate:{x:0,y:0,open:!1},timer:(t==null?void 0:t.difficultyParams.timeLimitSeconds)??60,collected:0,enemySpeed:(t==null?void 0:t.difficultyParams.enemySpeed)??1.5,hitPenalty:(t==null?void 0:t.difficultyParams.hitPenalty)??6,invulnerable:0,level:1,baseTime:(t==null?void 0:t.difficultyParams.timeLimitSeconds)??60,timeDecay:5};function A(){w.width=window.innerWidth*devicePixelRatio,w.height=window.innerHeight*devicePixelRatio,e.width=w.width/devicePixelRatio,e.height=w.height/devicePixelRatio}A();window.addEventListener("resize",A);const M=H({update:i=>Q(i),render:V,fps:60});function j(){if(!t){P("Config manquante","Ajoute configs/games/quest.config.json",!1);return}const i=o[x]||o.medium;e.running=!0,e.baseTime=i.timeLimit,e.timeDecay=5,e.level=1,e.enemySpeed=i.enemySpeed,e.hitPenalty=i.hitPenalty,e.invulnerable=1,D(i),p.style.display="none",f({type:"SESSION_START",gameId:m}),M.start()}function D(i=o[x]||o.medium){e.player.x=e.width*.15,e.player.y=e.height/2,e.items=[],e.traps=[],e.enemies=[],e.collected=0,e.gate={x:e.width*.85,y:e.height/2,open:!1};const l=Math.max(10,e.baseTime-(e.level-1)*e.timeDecay);e.timer=l,_(i.itemCount),N(i.trapCount),z(i.enemyCount)}function _(i){for(let l=0;l<i;l++)e.items.push({x:n(e.width*.25,e.width*.8),y:n(50,e.height-50),collected:!1})}function N(i){for(let l=0;l<i;l++)e.traps.push({x:n(e.width*.2,e.width*.8),y:n(60,e.height-60),active:!0})}function z(i){for(let l=0;l<i;l++)e.enemies.push({x:n(e.width*.3,e.width*.8),y:n(80,e.height-80),vx:n(-1,1)||.5,vy:n(-.6,.6)})}function T(i){e.running=!1,M.stop(),f({type:"SESSION_FAIL",gameId:m,payload:{remaining:e.timer}}),O(m,(t==null?void 0:t.saveSchemaVersion)??1,h=>{h.state.bestTime}),P("Temps écoulé",(t==null?void 0:t.uiText.help)||"")}function P(i,l,h=!0){const v=o[x]||o.medium;p.style.display="grid",p.innerHTML=`
    <div class="panel">
      <p class="pill">Mini Quest · ${v.label}</p>
      <h2>${i}</h2>
      <p>${l}</p>
      <div style="display:flex; gap:8px; flex-wrap:wrap; justify-content:center; margin:10px 0 6px;">
        ${Object.entries(o).map(([a,s])=>`
              <button class="btn ghost diff-btn ${a===x?"active":""}" data-diff="${a}">
                ${s.label} · ${s.itemCount} items · ${s.timeLimit}s
              </button>
            `).join("")}
      </div>
      <div style="display:flex; gap:10px; justify-content:center; margin-top:12px; flex-wrap:wrap;">
        ${h?'<button class="btn" id="play-btn">Lancer</button>':""}
        <a class="btn secondary" href="${G("/apps/hub/")}">Hub</a>
      </div>
    </div>
  `;const u=document.getElementById("play-btn");u==null||u.addEventListener("click",j),document.querySelectorAll(".diff-btn").forEach(a=>{a.addEventListener("click",()=>{const s=a.dataset.diff;s&&o[s]&&(x=s,P(i,l,h))})})}P((t==null?void 0:t.uiText.title)||"Mini Quest",(t==null?void 0:t.uiText.help)||"");function Q(i){if(!e.running||!t)return;if(e.timer-=i,e.invulnerable=Math.max(0,e.invulnerable-i),e.timer<=0){T();return}const l=(g.isDown(y.right)?1:0)+(g.isDown(y.left)?-1:0),h=(g.isDown(y.down)?1:0)+(g.isDown(y.up)?-1:0);if(e.player.x+=l*t.difficultyParams.playerSpeed*(i*60),e.player.y+=h*t.difficultyParams.playerSpeed*(i*60),e.player.x=F(e.player.x,e.player.r,e.width-e.player.r),e.player.y=F(e.player.y,e.player.r,e.height-e.player.r),e.enemies.forEach(a=>{a.x+=a.vx*e.enemySpeed*(i*60),a.y+=a.vy*e.enemySpeed*(i*60),(a.x<20||a.x>e.width-20)&&(a.vx*=-1),(a.y<40||a.y>e.height-40)&&(a.vy*=-1),Math.random()<.01&&(a.vx+=n(-.2,.2),a.vy+=n(-.2,.2)),a.vx=F(a.vx,-1.4,1.4),a.vy=F(a.vy,-1.2,1.2)}),e.invulnerable<=0)for(const a of e.enemies){const s=a.x-e.player.x,d=a.y-e.player.y;if(Math.sqrt(s*s+d*d)<e.player.r+14){e.timer=Math.max(0,e.timer-e.hitPenalty),e.invulnerable=1.2,e.player.x=e.width*.15,e.player.y=e.height/2,f({type:"PLAYER_HIT",gameId:m});break}}e.items.forEach(a=>{if(a.collected)return;const s=a.x-e.player.x,d=a.y-e.player.y;Math.sqrt(s*s+d*d)<e.player.r+10&&(a.collected=!0,e.collected+=1,f({type:"ITEM_COLLECTED",gameId:m}),e.collected>=e.items.length&&(e.gate.open=!0,f({type:"GATE_UNLOCKED",gameId:m})))}),e.traps.forEach(a=>{if(!a.active)return;const s=a.x-e.player.x,d=a.y-e.player.y;Math.sqrt(s*s+d*d)<e.player.r+10&&(a.active=!1,T(),f({type:"TRAP_TRIGGERED",gameId:m}))});const v=e.gate.x-e.player.x,u=e.gate.y-e.player.y;e.gate.open&&Math.sqrt(v*v+u*u)<e.player.r+16&&(e.level+=1,D())}function V(){r.save(),r.scale(devicePixelRatio,devicePixelRatio),r.clearRect(0,0,e.width,e.height),S.complete?(r.globalAlpha=e.gate.open?1:.65,r.drawImage(S,e.gate.x-20,e.gate.y-50,40,100),r.globalAlpha=1):(r.fillStyle=e.gate.open?c.colors.accent:"rgba(255,255,255,0.1)",r.fillRect(e.gate.x-14,e.gate.y-24,28,48)),e.items.forEach(l=>{l.collected&&(r.globalAlpha=.35),C.complete?r.drawImage(C,l.x-16,l.y-16,32,32):(r.fillStyle=l.collected?"rgba(255,255,255,0.2)":c.colors.secondary,r.beginPath(),r.arc(l.x,l.y,10,0,Math.PI*2),r.fill()),r.globalAlpha=1}),e.traps.forEach(l=>{l.active&&(I.complete?r.drawImage(I,l.x-22,l.y-16,44,32):(r.fillStyle="rgba(255,95,109,0.9)",r.beginPath(),r.moveTo(l.x,l.y-10),r.lineTo(l.x-10,l.y+10),r.lineTo(l.x+10,l.y+10),r.closePath(),r.fill()))}),e.enemies.forEach(l=>{L.complete?r.drawImage(L,l.x-18,l.y-18,36,36):(r.fillStyle=c.colors.accent,r.beginPath(),r.arc(l.x,l.y,16,0,Math.PI*2),r.fill())});const i=e.player.r*2.6;E.complete?r.drawImage(E,e.player.x-i/2,e.player.y-i/2,i,i):(r.fillStyle=c.colors.primary,r.beginPath(),r.arc(e.player.x,e.player.y,e.player.r,0,Math.PI*2),r.fill()),r.restore(),Y()}function Y(){b.innerHTML="",b.appendChild(p);const i=document.createElement("div");i.className="hud",i.innerHTML=`
    <div class="pill">Temps ${e.timer.toFixed(1)}s</div>
    <div class="pill">Objets ${e.collected}/${e.items.length}</div>
    <div class="pill">Porte ${e.gate.open?"ouverte":"fermée"}</div>
    <div class="pill">Ennemis ${e.enemies.length}</div>
    <div class="pill">Difficulté ${o[x].label}</div>
    <div class="pill">Niveau ${e.level}</div>
  `,b.appendChild(i)}
