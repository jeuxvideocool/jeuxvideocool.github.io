import{m as H,e as I,f as D,l as q,p,w as A,k as f,t as W}from"./index-D6AlT0_O.js";import{c as N,a as O}from"./input-CrBvr0XE.js";import{c as _}from"./loop-24SuRqx9.js";const u="breakout",a=H(u),P=I(),n=P.find(t=>t.id===(a==null?void 0:a.themeId))||P[0];D();if(n){const t=document.documentElement.style;t.setProperty("--color-primary",n.colors.primary),t.setProperty("--color-secondary",n.colors.secondary),t.setProperty("--color-accent",n.colors.accent),t.setProperty("--color-text",n.colors.text),t.setProperty("--color-muted",n.colors.muted),t.setProperty("--color-bg",n.colors.background),document.body.style.background=n.gradient||n.colors.background}const c=document.getElementById("game-canvas"),y=document.getElementById("ui"),o=c.getContext("2d"),m=N(),b=document.createElement("div");b.className="overlay";b.style.display="none";y.appendChild(b);const h={left:(a==null?void 0:a.input.keys.left)||"ArrowLeft",right:(a==null?void 0:a.input.keys.right)||"ArrowRight",altLeft:(a==null?void 0:a.input.keys.altLeft)||"KeyQ",altRight:(a==null?void 0:a.input.keys.altRight)||"KeyD",launch:(a==null?void 0:a.input.keys.launch)||"Space"};var M,R;const j=typeof window<"u"&&(((R=(M=window.matchMedia)==null?void 0:M.call(window,"(pointer: coarse)"))==null?void 0:R.matches)||navigator.maxTouchPoints>0),x=j?O({container:document.body,input:m,mapping:{left:h.left,right:h.right,actionA:h.launch,actionALabel:"Lancer"},autoShow:!1,showPad:!0,gestureEnabled:!1,showOnDesktop:!1}):{show:()=>{},hide:()=>{},dispose:()=>{}};var B;const e={running:!1,width:0,height:0,dpr:devicePixelRatio||1,play:{x:0,y:0,w:0,h:0},paddle:{x:0,y:0,w:120,h:16,speed:640},ball:{x:0,y:0,vx:0,vy:0,r:8,stuck:!0},rows:(a==null?void 0:a.difficultyParams.rows)??6,cols:(a==null?void 0:a.difficultyParams.cols)??10,brickGap:p((a==null?void 0:a.difficultyParams.brickGap)??8,4,14),brickHeight:22,bricks:[],bricksRemaining:0,totalBricks:0,clearedRows:new Set,score:0,best:((B=q().games[u])==null?void 0:B.bestScore)??0,lives:(a==null?void 0:a.difficultyParams.lives)??3,ballSpeed:(a==null?void 0:a.difficultyParams.ballSpeed)??320,pointsPerBrick:(a==null?void 0:a.difficultyParams.pointsPerBrick)??10,launchHeld:!1,flash:0},C=_({update:t=>Q(t),render:L,fps:60});function T(){const t={...e.play};if(e.dpr=devicePixelRatio||1,c.width=window.innerWidth*e.dpr,c.height=window.innerHeight*e.dpr,c.style.width="100%",c.style.height="100%",e.width=c.width/e.dpr,e.height=c.height/e.dpr,K(),t.w>0&&t.h>0){const l=(e.paddle.x-t.x)/t.w;if(e.paddle.x=e.play.x+p(l,0,1)*e.play.w,!e.ball.stuck){const s=(e.ball.x-t.x)/t.w,r=(e.ball.y-t.y)/t.h;e.ball.x=e.play.x+s*e.play.w,e.ball.y=e.play.y+r*e.play.h}}else e.paddle.x=e.play.x+(e.play.w-e.paddle.w)/2;e.ball.stuck&&k(),V()}function K(){const t=Math.max(16,Math.min(e.width,e.height)*.05),l=Math.min(e.width-t*2,920),s=e.height-t*2;e.play.x=(e.width-l)/2,e.play.y=t,e.play.w=l,e.play.h=s,e.paddle.w=p((a==null?void 0:a.difficultyParams.paddleWidth)??l*.24,l*.16,l*.34),e.paddle.h=p(Math.floor(s*.03),10,18),e.paddle.y=e.play.y+e.play.h-e.paddle.h-Math.max(16,s*.04),e.ball.r=p(Math.floor(l*.012),6,10),e.brickGap=p((a==null?void 0:a.difficultyParams.brickGap)??8,4,14),e.brickHeight=p(Math.floor(s*.045),16,28)}function V(){if(!e.bricks.length)return;const t=(e.play.w-e.brickGap*(e.cols-1))/e.cols,l=e.play.x,s=e.play.y+Math.max(18,e.play.h*.08);e.bricks.forEach(r=>{r.w=t,r.h=e.brickHeight,r.x=l+r.col*(t+e.brickGap),r.y=s+r.row*(e.brickHeight+e.brickGap)})}function E(){const t=[n.colors.primary,n.colors.secondary,n.colors.accent,"#ffd166","#7ce7ff"],l=(e.play.w-e.brickGap*(e.cols-1))/e.cols,s=e.play.x,r=e.play.y+Math.max(18,e.play.h*.08);e.bricks=[],e.clearedRows=new Set;for(let i=0;i<e.rows;i+=1)for(let d=0;d<e.cols;d+=1)e.bricks.push({x:s+d*(l+e.brickGap),y:r+i*(e.brickHeight+e.brickGap),w:l,h:e.brickHeight,row:i,col:d,alive:!0,color:t[i%t.length]});e.totalBricks=e.rows*e.cols,e.bricksRemaining=e.totalBricks}function k(){e.ball.x=e.paddle.x+e.paddle.w/2,e.ball.y=e.paddle.y-e.ball.r-4}function g(){e.ball.stuck=!0,e.ball.vx=0,e.ball.vy=0,k()}function X(){e.ball.stuck=!1;const t=Math.PI/3,l=-Math.PI/2+(Math.random()*t-t/2);e.ball.vx=Math.cos(l)*e.ballSpeed,e.ball.vy=Math.sin(l)*e.ballSpeed}function Y(){if(!a){S("Config manquante","Ajoute configs/games/breakout.config.json",!1);return}x.show(),e.running=!0,e.score=0,e.flash=0,e.lives=(a==null?void 0:a.difficultyParams.lives)??3,e.rows=(a==null?void 0:a.difficultyParams.rows)??6,e.cols=(a==null?void 0:a.difficultyParams.cols)??10,e.ballSpeed=(a==null?void 0:a.difficultyParams.ballSpeed)??320,e.pointsPerBrick=(a==null?void 0:a.difficultyParams.pointsPerBrick)??10,e.paddle.x=e.play.x+(e.play.w-e.paddle.w)/2,g(),E(),b.style.display="none",c.style.pointerEvents="auto",y.style.pointerEvents="none",f({type:"SESSION_START",gameId:u}),C.start()}function G(t){e.running=!1,C.stop(),x.hide();const l=e.score;f({type:t?"SESSION_WIN":"SESSION_FAIL",gameId:u,payload:{score:l}}),W(u,(a==null?void 0:a.saveSchemaVersion)??1,i=>{const d=i.bestScore||0;l>d&&(i.bestScore=l);const v=e.totalBricks-e.bricksRemaining,$=i.state.bestBricks||0;v>$&&(i.state.bestBricks=v)}),e.best=Math.max(e.best,l),S(t?"Victoire":"Perdu",(a==null?void 0:a.uiText.help)||"Relance une partie pour battre ton record.",!0,l)}function z(){e.lives=Math.max(0,e.lives-1),e.flash=1,e.lives<=0?G(!1):g()}function F(t){t.alive&&(t.alive=!1,e.bricksRemaining-=1,e.score+=e.pointsPerBrick,f({type:"BRICK_BROKEN",gameId:u,payload:{score:e.score}}),e.clearedRows.has(t.row)||!e.bricks.some(s=>s.alive&&s.row===t.row)&&(e.clearedRows.add(t.row),f({type:"ROW_CLEARED",gameId:u})),e.bricksRemaining<=0&&G(!0))}function Q(t){if(!e.running)return;const l=m.isDown(h.left)||m.isDown(h.altLeft),r=(m.isDown(h.right)||m.isDown(h.altRight)?1:0)-(l?1:0);r!==0&&(e.paddle.x+=r*e.paddle.speed*t),e.paddle.x=p(e.paddle.x,e.play.x,e.play.x+e.play.w-e.paddle.w);const i=m.isDown(h.launch);if(e.ball.stuck&&i&&!e.launchHeld&&X(),e.launchHeld=i,e.ball.stuck){k();return}e.ball.x+=e.ball.vx*t,e.ball.y+=e.ball.vy*t,U(),e.flash=Math.max(0,e.flash-t*2)}function U(){const t=e.ball,l=e.play;if(t.x-t.r<=l.x&&(t.x=l.x+t.r,t.vx=Math.abs(t.vx)),t.x+t.r>=l.x+l.w&&(t.x=l.x+l.w-t.r,t.vx=-Math.abs(t.vx)),t.y-t.r<=l.y&&(t.y=l.y+t.r,t.vy=Math.abs(t.vy)),t.y-t.r>l.y+l.h){z();return}if(t.vy>0&&t.y+t.r>=e.paddle.y&&t.y-t.r<=e.paddle.y+e.paddle.h&&t.x>=e.paddle.x&&t.x<=e.paddle.x+e.paddle.w){const s=(t.x-(e.paddle.x+e.paddle.w/2))/(e.paddle.w/2),i=p(s,-1,1)*(Math.PI/3);t.vx=Math.sin(i)*e.ballSpeed,t.vy=-Math.cos(i)*e.ballSpeed,t.y=e.paddle.y-t.r-.5}for(const s of e.bricks){if(!s.alive||t.x+t.r<s.x||t.x-t.r>s.x+s.w||t.y+t.r<s.y||t.y-t.r>s.y+s.h)continue;const r=Math.min(t.x+t.r-s.x,s.x+s.w-(t.x-t.r)),i=Math.min(t.y+t.r-s.y,s.y+s.h-(t.y-t.r));r<i?t.vx*=-1:t.vy*=-1,F(s);break}}function w(t,l,s,r,i){const d=Math.min(i,s/2,r/2);o.beginPath(),o.moveTo(t+d,l),o.lineTo(t+s-d,l),o.quadraticCurveTo(t+s,l,t+s,l+d),o.lineTo(t+s,l+r-d),o.quadraticCurveTo(t+s,l+r,t+s-d,l+r),o.lineTo(t+d,l+r),o.quadraticCurveTo(t,l+r,t,l+r-d),o.lineTo(t,l+d),o.quadraticCurveTo(t,l,t+d,l),o.closePath()}function L(){o.save(),o.scale(e.dpr,e.dpr),o.clearRect(0,0,e.width,e.height);const t=o.createLinearGradient(0,0,e.width,e.height);t.addColorStop(0,"rgba(96,165,250,0.08)"),t.addColorStop(.5,"rgba(251,191,36,0.05)"),t.addColorStop(1,"rgba(244,114,182,0.08)"),o.fillStyle=t,o.fillRect(0,0,e.width,e.height),o.fillStyle="rgba(255,255,255,0.04)",w(e.play.x,e.play.y,e.play.w,e.play.h,18),o.fill(),o.strokeStyle="rgba(255,255,255,0.12)",o.lineWidth=1.2,o.stroke(),e.bricks.forEach(r=>{if(!r.alive)return;const i=o.createLinearGradient(r.x,r.y,r.x,r.y+r.h);i.addColorStop(0,r.color),i.addColorStop(1,`${r.color}cc`),o.fillStyle=i,w(r.x,r.y,r.w,r.h,8),o.fill(),o.strokeStyle="rgba(255,255,255,0.18)",o.lineWidth=1,o.stroke()});const l=o.createLinearGradient(e.paddle.x,e.paddle.y,e.paddle.x+e.paddle.w,e.paddle.y);l.addColorStop(0,n.colors.secondary),l.addColorStop(1,n.colors.primary),o.fillStyle=l,w(e.paddle.x,e.paddle.y,e.paddle.w,e.paddle.h,10),o.fill();const s=o.createRadialGradient(e.ball.x-e.ball.r*.4,e.ball.y-e.ball.r*.4,e.ball.r*.2,e.ball.x,e.ball.y,e.ball.r);s.addColorStop(0,"#ffffff"),s.addColorStop(1,n.colors.accent),o.fillStyle=s,o.beginPath(),o.arc(e.ball.x,e.ball.y,e.ball.r,0,Math.PI*2),o.fill(),o.restore(),J()}function J(){y.innerHTML="",y.appendChild(b);const t=e.totalBricks-e.bricksRemaining,l=document.createElement("div");l.className="hud",l.innerHTML=`
    <div class="chip">Score <strong>${e.score}</strong></div>
    <div class="chip">Briques <strong>${t}/${e.totalBricks}</strong></div>
    <div class="chip ghost">Vies <span>${e.lives}</span></div>
    <div class="chip ghost">Record <span>${e.best}</span></div>
  `,y.appendChild(l);const s=document.createElement("div");s.className="hud bottom",s.innerHTML=`
    <div class="pill ${e.ball.stuck?"glow":""}">${e.ball.stuck?"Pret a lancer":"Balle en jeu"}</div>
    <div class="pill ghost">${e.ball.stuck?"Espace pour lancer":"Garde le rythme"}</div>
  `,y.appendChild(s)}function S(t,l,s=!0,r){var d;x.hide(),b.style.display="grid",y.style.pointerEvents="auto",c.style.pointerEvents="none";const i=((a==null?void 0:a.uiText.controls)||[]).map(v=>`<span class="chip ghost">${v}</span>`).join("");b.innerHTML=`
    <div class="panel">
      <p class="pill">${(a==null?void 0:a.uiText.title)||"Casse-briques"}</p>
      <h2>${t}</h2>
      ${r!==void 0?`<p class="muted">Score ${r}</p>`:""}
      <p class="muted">${l}</p>
      <div class="panel-actions">
        ${s?'<button class="btn" id="start-btn">Lancer</button>':""}
        <a class="btn ghost" href="${A("/")}">Hub</a>
      </div>
      <div class="inline-metrics">
        <div><span>Record</span><strong>${e.best}</strong></div>
        <div><span>Vies</span><strong>${e.lives}</strong></div>
        <div><span>Briques</span><strong>${e.bricksRemaining}/${e.totalBricks}</strong></div>
      </div>
      <div class="controls">${i}</div>
    </div>
  `,(d=document.getElementById("start-btn"))==null||d.addEventListener("click",Y)}T();window.addEventListener("resize",T);E();e.paddle.x=e.play.x+(e.play.w-e.paddle.w)/2;g();S((a==null?void 0:a.uiText.title)||"Casse-briques",(a==null?void 0:a.uiText.help)||"");L();
